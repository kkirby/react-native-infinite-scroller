function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

import React, { Component } from 'react';
import Animated from 'react-native-reanimated';
import { PanGestureHandler } from 'react-native-gesture-handler';
import InfiniteElement from './InfiniteElement';
import InfiniteCalculator from './InfiniteCalculator';
import InfiniteItem from './InfiniteItem';
import AnimationLogic from './AnimationLogic';
export default class InfiniteScroller extends Component {
  constructor(props) {
    super(props);

    _defineProperty(this, "infiniteCalculator", void 0);

    _defineProperty(this, "infiniteElements", []);

    _defineProperty(this, "animationLogic", void 0);

    _defineProperty(this, "onItemLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        itemLayout
      } = this.state;

      if (itemLayout.width !== width || itemLayout.height !== height) {
        this.setState({
          itemLayout: {
            width,
            height
          }
        });
      }

      this.animationLogic.updateItemWidth(width);
      this.infiniteCalculator.infiniteElementWidth = width;
    });

    _defineProperty(this, "onWrapperLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        wrapperLayout
      } = this.state;

      if (wrapperLayout.width !== width || wrapperLayout.height !== height) {
        this.setState({
          wrapperLayout: {
            width,
            height
          }
        });
      }

      this.infiniteCalculator.wrapperWidth = width;
      this.animationLogic.updateWrapperWidth(width);
    });

    this.state = {
      itemLayout: {
        width: 0,
        height: 0
      },
      wrapperLayout: {
        width: 0,
        height: 0
      },
      ready: false
    };
    this.infiniteElements = [];

    for (let i = 0; i < (props.infiniteElementCount || 100); i++) {
      this.infiniteElements.push(new InfiniteElement());
    }

    this.infiniteCalculator = new InfiniteCalculator(_objectSpread({}, props, {
      infiniteLimit: Math.floor(2147483645 / 1000),
      infiniteElements: this.infiniteElements,
      cacheSize: this.infiniteElements.length * 2
    }));
    this.animationLogic = AnimationLogic();
    this.animationLogic.on('change', value => {
      this.infiniteCalculator.x = value;
    });
    this.animationLogic.on('scrollEnd', _value => {
      if (this.props.onScrollEnd) {
        this.props.onScrollEnd(this.getCurrentIndex(), this);
      }
    });

    if (props.centerInWrapper != null) {
      this.animationLogic.updateCenterScroll(props.centerInWrapper);
    }
  }

  componentDidUpdate(_prevProps, prevState) {
    if (prevState.wrapperLayout.width !== this.state.wrapperLayout.width || prevState.itemLayout.width !== this.state.itemLayout.width) {
      this.infiniteCalculator.infiniteElementWidth = this.state.itemLayout.width;
      this.infiniteCalculator.wrapperWidth = this.state.wrapperLayout.width;
    }

    if (_prevProps.centerInWrapper !== this.props.centerInWrapper) {
      const centerInWrapper = this.props.centerInWrapper;
      this.animationLogic.updateCenterScroll(centerInWrapper != null ? centerInWrapper : false);
    }

    if (this.state.wrapperLayout.width !== 0 && this.state.itemLayout.width !== 0 && this.state.ready === false) {
      if (this.props.startingPosition != null) {
        this.scrollTo(this.props.startingPosition, false);
      } // eslint-disable-next-line react/no-did-update-set-state


      this.setState({
        ready: true
      });
    }

    if (this.state.itemLayout.width && this.props.totalItemCount != null) {
      this.animationLogic.updateMaxScroll(-1 * this.state.itemLayout.width * this.props.totalItemCount);
    }
  }

  getCurrentIndex() {
    const moveXValue = this.infiniteCalculator.x;
    const itemWidth = this.state.itemLayout.width;
    const wrapperWidth = this.state.wrapperLayout.width;
    const centerInWrapper = this.props.centerInWrapper != null ? this.props.centerInWrapper : false;
    const center = centerInWrapper ? wrapperWidth / 2 - itemWidth / 2 : 0;
    /**
     * The value will be slighly off because our snap end threshhold is a
     * bit high to ensure events are triggered in a timley manner.
     **/

    return Math.round((center - moveXValue) / itemWidth);
  }

  async goNext(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollTo(index + 1, withAnimation);
  }

  async goBack(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollTo(index - 1, withAnimation);
  }

  async scrollTo(itemOffset, withAnimation = true) {
    this.animationLogic.scrollTo(-1 * itemOffset * this.state.itemLayout.width, withAnimation);
  }

  render() {
    const style = {
      opacity: this.state.ready ? 1 : 0,
      height: this.state.itemLayout.height
    };
    return <PanGestureHandler onGestureEvent={this.animationLogic.gestureHandler} onHandlerStateChange={this.animationLogic.gestureHandler}>
				<Animated.View style={[this.props.style, style]} onLayout={this.onWrapperLayout}>
					<Animated.View style={{
          transform: [{
            translateX: this.animationLogic.x
          }, {
            perspective: 1000
          } // without this line this Animation will not render on Android while working fine on iOS
          ]
        }}>
						{this.infiniteElements.map((item, i) => {
            return <InfiniteItem renderItem={this.props.renderItem} item={item} key={i} onLayout={this.onItemLayout} />;
          })}
					</Animated.View>
				</Animated.View>
			</PanGestureHandler>;
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9JbmZpbml0ZVNjcm9sbGVyLnRzeCJdLCJuYW1lcyI6WyJSZWFjdCIsIkNvbXBvbmVudCIsIkFuaW1hdGVkIiwiUGFuR2VzdHVyZUhhbmRsZXIiLCJJbmZpbml0ZUVsZW1lbnQiLCJJbmZpbml0ZUNhbGN1bGF0b3IiLCJJbmZpbml0ZUl0ZW0iLCJBbmltYXRpb25Mb2dpYyIsIkluZmluaXRlU2Nyb2xsZXIiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwibmF0aXZlRXZlbnQiLCJsYXlvdXQiLCJ3aWR0aCIsImhlaWdodCIsIml0ZW1MYXlvdXQiLCJzdGF0ZSIsInNldFN0YXRlIiwiYW5pbWF0aW9uTG9naWMiLCJ1cGRhdGVJdGVtV2lkdGgiLCJpbmZpbml0ZUNhbGN1bGF0b3IiLCJpbmZpbml0ZUVsZW1lbnRXaWR0aCIsIndyYXBwZXJMYXlvdXQiLCJ3cmFwcGVyV2lkdGgiLCJ1cGRhdGVXcmFwcGVyV2lkdGgiLCJyZWFkeSIsImluZmluaXRlRWxlbWVudHMiLCJpIiwiaW5maW5pdGVFbGVtZW50Q291bnQiLCJwdXNoIiwiaW5maW5pdGVMaW1pdCIsIk1hdGgiLCJmbG9vciIsImNhY2hlU2l6ZSIsImxlbmd0aCIsIm9uIiwidmFsdWUiLCJ4IiwiX3ZhbHVlIiwib25TY3JvbGxFbmQiLCJnZXRDdXJyZW50SW5kZXgiLCJjZW50ZXJJbldyYXBwZXIiLCJ1cGRhdGVDZW50ZXJTY3JvbGwiLCJjb21wb25lbnREaWRVcGRhdGUiLCJfcHJldlByb3BzIiwicHJldlN0YXRlIiwic3RhcnRpbmdQb3NpdGlvbiIsInNjcm9sbFRvIiwidG90YWxJdGVtQ291bnQiLCJ1cGRhdGVNYXhTY3JvbGwiLCJtb3ZlWFZhbHVlIiwiaXRlbVdpZHRoIiwiY2VudGVyIiwicm91bmQiLCJnb05leHQiLCJ3aXRoQW5pbWF0aW9uIiwiaW5kZXgiLCJnb0JhY2siLCJpdGVtT2Zmc2V0IiwicmVuZGVyIiwic3R5bGUiLCJvcGFjaXR5IiwiZ2VzdHVyZUhhbmRsZXIiLCJvbldyYXBwZXJMYXlvdXQiLCJ0cmFuc2Zvcm0iLCJ0cmFuc2xhdGVYIiwicGVyc3BlY3RpdmUiLCJtYXAiLCJpdGVtIiwicmVuZGVySXRlbSIsIm9uSXRlbUxheW91dCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBT0EsS0FBUCxJQUFlQyxTQUFmLFFBQStCLE9BQS9CO0FBR0EsT0FBT0MsUUFBUCxNQUFxQix5QkFBckI7QUFDQSxTQUFRQyxpQkFBUixRQUFnQyw4QkFBaEM7QUFDQSxPQUFPQyxlQUFQLE1BQTRCLG1CQUE1QjtBQUNBLE9BQU9DLGtCQUFQLE1BQStCLHNCQUEvQjtBQUNBLE9BQU9DLFlBQVAsTUFBeUIsZ0JBQXpCO0FBQ0EsT0FBT0MsY0FBUCxNQUEyQixrQkFBM0I7QUE0QkEsZUFBZSxNQUFNQyxnQkFBTixTQUFrQ1AsU0FBbEMsQ0FHYjtBQUtEUSxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBa0M7QUFDNUMsVUFBTUEsS0FBTjs7QUFENEM7O0FBQUEsOENBSEosRUFHSTs7QUFBQTs7QUFBQSwwQ0FrSDlCLENBQUM7QUFDZkMsTUFBQUEsV0FBVyxFQUFFO0FBQ1pDLFFBQUFBLE1BQU0sRUFBRTtBQUFDQyxVQUFBQSxLQUFEO0FBQVFDLFVBQUFBO0FBQVI7QUFESTtBQURFLEtBQUQsS0FJVTtBQUN4QixZQUFNO0FBQUNDLFFBQUFBO0FBQUQsVUFBZSxLQUFLQyxLQUExQjs7QUFDQSxVQUFJRCxVQUFVLENBQUNGLEtBQVgsS0FBcUJBLEtBQXJCLElBQThCRSxVQUFVLENBQUNELE1BQVgsS0FBc0JBLE1BQXhELEVBQWdFO0FBQy9ELGFBQUtHLFFBQUwsQ0FBYztBQUNiRixVQUFBQSxVQUFVLEVBQUU7QUFBQ0YsWUFBQUEsS0FBRDtBQUFRQyxZQUFBQTtBQUFSO0FBREMsU0FBZDtBQUdBOztBQUNELFdBQUtJLGNBQUwsQ0FBb0JDLGVBQXBCLENBQW9DTixLQUFwQztBQUNBLFdBQUtPLGtCQUFMLENBQXdCQyxvQkFBeEIsR0FBK0NSLEtBQS9DO0FBQ0EsS0EvSDRDOztBQUFBLDZDQWlJM0IsQ0FB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IHtDb21wb25lbnR9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7TGF5b3V0Q2hhbmdlRXZlbnQsIFN0eWxlUHJvcCwgVmlld1N0eWxlfSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuXG5pbXBvcnQgQW5pbWF0ZWQgZnJvbSAncmVhY3QtbmF0aXZlLXJlYW5pbWF0ZWQnO1xuaW1wb3J0IHtQYW5HZXN0dXJlSGFuZGxlcn0gZnJvbSAncmVhY3QtbmF0aXZlLWdlc3R1cmUtaGFuZGxlcic7XG5pbXBvcnQgSW5maW5pdGVFbGVtZW50IGZyb20gJy4vSW5maW5pdGVFbGVtZW50JztcbmltcG9ydCBJbmZpbml0ZUNhbGN1bGF0b3IgZnJvbSAnLi9JbmZpbml0ZUNhbGN1bGF0b3InO1xuaW1wb3J0IEluZmluaXRlSXRlbSBmcm9tICcuL0luZmluaXRlSXRlbSc7XG5pbXBvcnQgQW5pbWF0aW9uTG9naWMgZnJvbSAnLi9BbmltYXRpb25Mb2dpYyc7XG5cbmludGVyZmFjZSBJbmZpbml0ZVNjcm9sbGVyUHJvcHM8VD4ge1xuXHRkYXRhc2V0KHN0YXJ0OiBudW1iZXIsIGNvdW50OiBudW1iZXIpOiBQcm9taXNlPFRbXT47XG5cdHJlbmRlckl0ZW06IChkYXRhOiBUIHwgbnVsbCkgPT4gUmVhY3QuUmVhY3RFbGVtZW50O1xuXHRzdHlsZT86IFN0eWxlUHJvcDxWaWV3U3R5bGU+O1xuXHR0b3RhbEl0ZW1Db3VudD86IG51bWJlciB8IG51bGw7XG5cdGNlbnRlckluV3JhcHBlcj86IGJvb2xlYW4gfCBudWxsO1xuXHRzdGFydGluZ1Bvc2l0aW9uPzogbnVtYmVyIHwgbnVsbDtcblx0b25TY3JvbGxFbmQ/OiAoXG5cdFx0c2Nyb2xsUG9zaXRpb246IG51bWJlcixcblx0XHRzY3JvbGxlcjogSW5maW5pdGVTY3JvbGxlcjxUPixcblx0KSA9PiB2b2lkIHwgbnVsbDtcblx0aW5maW5pdGVFbGVtZW50Q291bnQ/OiBudW1iZXIgfCBudWxsO1xufVxuXG5pbnRlcmZhY2UgSW5maW5pdGVTY3JvbGxlclN0YXRlIHtcblx0aXRlbUxheW91dDoge1xuXHRcdHdpZHRoOiBudW1iZXI7XG5cdFx0aGVpZ2h0OiBudW1iZXI7XG5cdH07XG5cdHdyYXBwZXJMYXlvdXQ6IHtcblx0XHR3aWR0aDogbnVtYmVyO1xuXHRcdGhlaWdodDogbnVtYmVyO1xuXHR9O1xuXHRyZWFkeTogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSW5maW5pdGVTY3JvbGxlcjxUPiBleHRlbmRzIENvbXBvbmVudDxcblx0SW5maW5pdGVTY3JvbGxlclByb3BzPFQ+LFxuXHRJbmZpbml0ZVNjcm9sbGVyU3RhdGVcbj4ge1xuXHRpbmZpbml0ZUNhbGN1bGF0b3I6IEluZmluaXRlQ2FsY3VsYXRvcjxUPjtcblx0aW5maW5pdGVFbGVtZW50czogSW5maW5pdGVFbGVtZW50PFQ+W10gPSBbXTtcblx0YW5pbWF0aW9uTG9naWM6IEFuaW1hdGlvbkxvZ2ljO1xuXG5cdGNvbnN0cnVjdG9yKHByb3BzOiBJbmZpbml0ZVNjcm9sbGVyUHJvcHM8VD4pIHtcblx0XHRzdXBlcihwcm9wcyk7XG5cdFx0dGhpcy5zdGF0ZSA9IHtcblx0XHRcdGl0ZW1MYXlvdXQ6IHtcblx0XHRcdFx0d2lkdGg6IDAsXG5cdFx0XHRcdGhlaWdodDogMCxcblx0XHRcdH0sXG5cdFx0XHR3cmFwcGVyTGF5b3V0OiB7XG5cdFx0XHRcdHdpZHRoOiAwLFxuXHRcdFx0XHRoZWlnaHQ6IDAsXG5cdFx0XHR9LFxuXHRcdFx0cmVhZHk6IGZhbHNlLFxuXHRcdH07XG5cdFx0dGhpcy5pbmZpbml0ZUVsZW1lbnRzID0gW107XG5cblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IChwcm9wcy5pbmZpbml0ZUVsZW1lbnRDb3VudCB8fCAxMDApOyBpKyspIHtcblx0XHRcdHRoaXMuaW5maW5pdGVFbGVtZW50cy5wdXNoKG5ldyBJbmZpbml0ZUVsZW1lbnQ8VD4oKSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3IgPSBuZXcgSW5maW5pdGVDYWxjdWxhdG9yKHtcblx0XHRcdC4uLnByb3BzLFxuXHRcdFx0aW5maW5pdGVMaW1pdDogTWF0aC5mbG9vcigyMTQ3NDgzNjQ1IC8gMTAwMCksXG5cdFx0XHRpbmZpbml0ZUVsZW1lbnRzOiB0aGlzLmluZmluaXRlRWxlbWVudHMsXG5cdFx0XHRjYWNoZVNpemU6IHRoaXMuaW5maW5pdGVFbGVtZW50cy5sZW5ndGggKiAyLFxuXHRcdH0pO1xuXG5cdFx0dGhpcy5hbmltYXRpb25Mb2dpYyA9IEFuaW1hdGlvbkxvZ2ljKCk7XG5cdFx0dGhpcy5hbmltYXRpb25Mb2dpYy5vbignY2hhbmdlJywgdmFsdWUgPT4ge1xuXHRcdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3IueCA9IHZhbHVlO1xuXHRcdH0pO1xuXHRcdHRoaXMuYW5pbWF0aW9uTG9naWMub24oJ3Njcm9sbEVuZCcsIF92YWx1ZSA9PiB7XG5cdFx0XHRpZiAodGhpcy5wcm9wcy5vblNjcm9sbEVuZCkge1xuXHRcdFx0XHR0aGlzLnByb3BzLm9uU2Nyb2xsRW5kKHRoaXMuZ2V0Q3VycmVudEluZGV4KCksIHRoaXMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0aWYgKHByb3BzLmNlbnRlckluV3JhcHBlciAhPSBudWxsKSB7XG5cdFx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnVwZGF0ZUNlbnRlclNjcm9sbChwcm9wcy5jZW50ZXJJbldyYXBwZXIpO1xuXHRcdH1cblx0fVxuXG5cdGNvbXBvbmVudERpZFVwZGF0ZShcblx0XHRfcHJldlByb3BzOiBJbmZpbml0ZVNjcm9sbGVyUHJvcHM8VD4sXG5cdFx0cHJldlN0YXRlOiBJbmZpbml0ZVNjcm9sbGVyU3RhdGUsXG5cdCkge1xuXHRcdGlmIChcblx0XHRcdHByZXZTdGF0ZS53cmFwcGVyTGF5b3V0LndpZHRoICE9PSB0aGlzLnN0YXRlLndyYXBwZXJMYXlvdXQud2lkdGggfHxcblx0XHRcdHByZXZTdGF0ZS5pdGVtTGF5b3V0LndpZHRoICE9PSB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGhcblx0XHQpIHtcblx0XHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLmluZmluaXRlRWxlbWVudFdpZHRoID0gdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoO1xuXHRcdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3Iud3JhcHBlcldpZHRoID0gdGhpcy5zdGF0ZS53cmFwcGVyTGF5b3V0LndpZHRoO1xuXHRcdH1cblxuXHRcdGlmIChfcHJldlByb3BzLmNlbnRlckluV3JhcHBlciAhPT0gdGhpcy5wcm9wcy5jZW50ZXJJbldyYXBwZXIpIHtcblx0XHRcdGNvbnN0IGNlbnRlckluV3JhcHBlciA9IHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyO1xuXHRcdFx0dGhpcy5hbmltYXRpb25Mb2dpYy51cGRhdGVDZW50ZXJTY3JvbGwoXG5cdFx0XHRcdGNlbnRlckluV3JhcHBlciAhPSBudWxsID8gY2VudGVySW5XcmFwcGVyIDogZmFsc2UsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmIChcblx0XHRcdHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aCAhPT0gMCAmJlxuXHRcdFx0dGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoICE9PSAwICYmXG5cdFx0XHR0aGlzLnN0YXRlLnJlYWR5ID09PSBmYWxzZVxuXHRcdCkge1xuXHRcdFx0aWYgKHRoaXMucHJvcHMuc3RhcnRpbmdQb3NpdGlvbiAhPSBudWxsKSB7XG5cdFx0XHRcdHRoaXMuc2Nyb2xsVG8odGhpcy5wcm9wcy5zdGFydGluZ1Bvc2l0aW9uLCBmYWxzZSk7XG5cdFx0XHR9XG5cdFx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvbm8tZGlkLXVwZGF0ZS1zZXQtc3RhdGVcblx0XHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0XHRyZWFkeTogdHJ1ZSxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGggJiYgdGhpcy5wcm9wcy50b3RhbEl0ZW1Db3VudCAhPSBudWxsKSB7XG5cdFx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnVwZGF0ZU1heFNjcm9sbChcblx0XHRcdFx0LTEgKiB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGggKiB0aGlzLnByb3BzLnRvdGFsSXRlbUNvdW50LFxuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRnZXRDdXJyZW50SW5kZXgoKSB7XG5cdFx0Y29uc3QgbW92ZVhWYWx1ZSA9IHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLng7XG5cdFx0Y29uc3QgaXRlbVdpZHRoID0gdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoO1xuXHRcdGNvbnN0IHdyYXBwZXJXaWR0aCA9IHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aDtcblx0XHRjb25zdCBjZW50ZXJJbldyYXBwZXIgPVxuXHRcdFx0dGhpcy5wcm9wcy5jZW50ZXJJbldyYXBwZXIgIT0gbnVsbFxuXHRcdFx0XHQ/IHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyXG5cdFx0XHRcdDogZmFsc2U7XG5cdFx0Y29uc3QgY2VudGVyID0gY2VudGVySW5XcmFwcGVyID8gd3JhcHBlcldpZHRoIC8gMiAtIGl0ZW1XaWR0aCAvIDIgOiAwO1xuXHRcdC8qKlxuXHRcdCAqIFRoZSB2YWx1ZSB3aWxsIGJlIHNsaWdobHkgb2ZmIGJlY2F1c2Ugb3VyIHNuYXAgZW5kIHRocmVzaGhvbGQgaXMgYVxuXHRcdCAqIGJpdCBoaWdoIHRvIGVuc3VyZSBldmVudHMgYXJlIHRyaWdnZXJlZCBpbiBhIHRpbWxleSBtYW5uZXIuXG5cdFx0ICoqL1xuXHRcdHJldHVybiBNYXRoLnJvdW5kKChjZW50ZXIgLSBtb3ZlWFZhbHVlKSAvIGl0ZW1XaWR0aCk7XG5cdH1cblxuXHRhc3luYyBnb05leHQod2l0aEFuaW1hdGlvbjogYm9vbGVhbiA9IHRydWUpIHtcblx0XHRjb25zdCBpbmRleCA9IHRoaXMuZ2V0Q3VycmVudEluZGV4KCk7XG5cdFx0cmV0dXJuIHRoaXMuc2Nyb2xsVG8oaW5kZXggKyAxLCB3aXRoQW5pbWF0aW9uKTtcblx0fVxuXG5cdGFzeW5jIGdvQmFjayh3aXRoQW5pbWF0aW9uOiBib29sZWFuID0gdHJ1ZSkge1xuXHRcdGNvbnN0IGluZGV4ID0gdGhpcy5nZXRDdXJyZW50SW5kZXgoKTtcblx0XHRyZXR1cm4gdGhpcy5zY3JvbGxUbyhpbmRleCAtIDEsIHdpdGhBbmltYXRpb24pO1xuXHR9XG5cblx0YXN5bmMgc2Nyb2xsVG8oaXRlbU9mZnNldDogbnVtYmVyLCB3aXRoQW5pbWF0aW9uOiBib29sZWFuID0gdHJ1ZSkge1xuXHRcdHRoaXMuYW5pbWF0aW9uTG9naWMuc2Nyb2xsVG8oXG5cdFx0XHQtMSAqIGl0ZW1PZmZzZXQgKiB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGgsXG5cdFx0XHR3aXRoQW5pbWF0aW9uLFxuXHRcdCk7XG5cdH1cblxuXHRvbkl0ZW1MYXlvdXQgPSAoe1xuXHRcdG5hdGl2ZUV2ZW50OiB7XG5cdFx0XHRsYXlvdXQ6IHt3aWR0aCwgaGVpZ2h0fSxcblx0XHR9LFxuXHR9OiBMYXlvdXRDaGFuZ2VFdmVudCkgPT4ge1xuXHRcdGNvbnN0IHtpdGVtTGF5b3V0fSA9IHRoaXMuc3RhdGU7XG5cdFx0aWYgKGl0ZW1MYXlvdXQud2lkdGggIT09IHdpZHRoIHx8IGl0ZW1MYXlvdXQuaGVpZ2h0ICE9PSBoZWlnaHQpIHtcblx0XHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0XHRpdGVtTGF5b3V0OiB7d2lkdGgsIGhlaWdodH0sXG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0dGhpcy5hbmltYXRpb25Mb2dpYy51cGRhdGVJdGVtV2lkdGgod2lkdGgpO1xuXHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLmluZmluaXRlRWxlbWVudFdpZHRoID0gd2lkdGg7XG5cdH07XG5cblx0b25XcmFwcGVyTGF5b3V0ID0gKHtcblx0XHRuYXRpdmVFdmVudDoge1xuXHRcdFx0bGF5b3V0OiB7d2lkdGgsIGhlaWdodH0sXG5cdFx0fSxcblx0fTogTGF5b3V0Q2hhbmdlRXZlbnQpID0+IHtcblx0XHRjb25zdCB7d3JhcHBlckxheW91dH0gPSB0aGlzLnN0YXRlO1xuXHRcdGlmICh3cmFwcGVyTGF5b3V0LndpZHRoICE9PSB3aWR0aCB8fCB3cmFwcGVyTGF5b3V0LmhlaWdodCAhPT0gaGVpZ2h0KSB7XG5cdFx0XHR0aGlzLnNldFN0YXRlKHtcblx0XHRcdFx0d3JhcHBlckxheW91dDoge3dpZHRoLCBoZWlnaHR9LFxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLndyYXBwZXJXaWR0aCA9IHdpZHRoO1xuXHRcdHRoaXMuYW5pbWF0aW9uTG9naWMudXBkYXRlV3JhcHBlcldpZHRoKHdpZHRoKTtcblx0fTtcblxuXHRyZW5kZXIoKSB7XG5cdFx0Y29uc3Qgc3R5bGUgPSB7XG5cdFx0XHRvcGFjaXR5OiB0aGlzLnN0YXRlLnJlYWR5ID8gMSA6IDAsXG5cdFx0XHRoZWlnaHQ6IHRoaXMuc3RhdGUuaXRlbUxheW91dC5oZWlnaHQsXG5cdFx0fTtcblx0XHRyZXR1cm4gKFxuXHRcdFx0PFBhbkdlc3R1cmVIYW5kbGVyXG5cdFx0XHRcdG9uR2VzdHVyZUV2ZW50PXt0aGlzLmFuaW1hdGlvbkxvZ2ljLmdlc3R1cmVIYW5kbGVyfVxuXHRcdFx0XHRvbkhhbmRsZXJTdGF0ZUNoYW5nZT17dGhpcy5hbmltYXRpb25Mb2dpYy5nZXN0dXJlSGFuZGxlcn0+XG5cdFx0XHRcdDxBbmltYXRlZC5WaWV3XG5cdFx0XHRcdFx0c3R5bGU9e1t0aGlzLnByb3BzLnN0eWxlLCBzdHlsZV19XG5cdFx0XHRcdFx0b25MYXlvdXQ9e3RoaXMub25XcmFwcGVyTGF5b3V0fT5cblx0XHRcdFx0XHQ8QW5pbWF0ZWQuVmlld1xuXHRcdFx0XHRcdFx0c3R5bGU9e3tcblx0XHRcdFx0XHRcdFx0dHJhbnNmb3JtOiBbXG5cdFx0XHRcdFx0XHRcdFx0e3RyYW5zbGF0ZVg6IHRoaXMuYW5pbWF0aW9uTG9naWMueH0sXG5cdFx0XHRcdFx0XHRcdFx0e3BlcnNwZWN0aXZlOiAxMDAwfSwgLy8gd2l0aG91dCB0aGlzIGxpbmUgdGhpcyBBbmltYXRpb24gd2lsbCBub3QgcmVuZGVyIG9uIEFuZHJvaWQgd2hpbGUgd29ya2luZyBmaW5lIG9uIGlPU1xuXHRcdFx0XHRcdFx0XHRdLFxuXHRcdFx0XHRcdFx0fX0+XG5cdFx0XHRcdFx0XHR7dGhpcy5pbmZpbml0ZUVsZW1lbnRzLm1hcCgoaXRlbSwgaSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gKFxuXHRcdFx0XHRcdFx0XHRcdDxJbmZpbml0ZUl0ZW08VD5cblx0XHRcdFx0XHRcdFx0XHRcdHJlbmRlckl0ZW09e3RoaXMucHJvcHMucmVuZGVySXRlbX1cblx0XHRcdFx0XHRcdFx0XHRcdGl0ZW09e2l0ZW19XG5cdFx0XHRcdFx0XHRcdFx0XHRrZXk9e2l9XG5cdFx0XHRcdFx0XHRcdFx0XHRvbkxheW91dD17dGhpcy5vbkl0ZW1MYXlvdXR9XG5cdFx0XHRcdFx0XHRcdFx0Lz5cblx0XHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRcdH0pfVxuXHRcdFx0XHRcdDwvQW5pbWF0ZWQuVmlldz5cblx0XHRcdFx0PC9BbmltYXRlZC5WaWV3PlxuXHRcdFx0PC9QYW5HZXN0dXJlSGFuZGxlcj5cblx0XHQpO1xuXHR9XG59XG4iXX0=