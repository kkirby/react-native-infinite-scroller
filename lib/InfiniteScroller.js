function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

import React, { Component } from 'react';
import Animated from 'react-native-reanimated';
import { PanGestureHandler } from 'react-native-gesture-handler';
import InfiniteElement from './InfiniteElement';
import InfiniteCalculator from './InfiniteCalculator';
import InfiniteItem from './InfiniteItem';
import AnimationLogic from './AnimationLogic';
export default class InfiniteScroller extends Component {
  constructor(props) {
    super(props);

    _defineProperty(this, "infiniteCalculator", void 0);

    _defineProperty(this, "infiniteElements", []);

    _defineProperty(this, "animationLogic", void 0);

    _defineProperty(this, "currentElement", void 0);

    _defineProperty(this, "panHandlerRef", void 0);

    _defineProperty(this, "onItemLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        itemLayout
      } = this.state;

      if (itemLayout.width !== width || itemLayout.height !== height) {
        this.setState({
          itemLayout: {
            width,
            height
          }
        });
      }

      this.animationLogic.updateItemWidth(width);
      this.infiniteCalculator.infiniteElementWidth = width;
    });

    _defineProperty(this, "onWrapperLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        wrapperLayout
      } = this.state;

      if (wrapperLayout.width !== width || wrapperLayout.height !== height) {
        this.setState({
          wrapperLayout: {
            width,
            height
          }
        });
      }

      this.infiniteCalculator.wrapperWidth = width;
      this.animationLogic.updateWrapperWidth(width);
    });

    this.state = {
      itemLayout: {
        width: 0,
        height: 0
      },
      wrapperLayout: {
        width: 0,
        height: 0
      },
      ready: false
    };
    this.infiniteElements = [];

    for (let i = 0; i < (props.infiniteElementCount || 100); i++) {
      this.infiniteElements.push(new InfiniteElement());
    }

    this.infiniteCalculator = new InfiniteCalculator(_objectSpread({}, props, {
      infiniteLimit: Math.floor(2147483645 / 1000),
      infiniteElements: this.infiniteElements,
      cacheSize: this.infiniteElements.length * 2
    }));
    this.animationLogic = AnimationLogic({
      springConfig: props.springConfig || {},
      decayConfig: props.decayConfig || {}
    });
    this.animationLogic.on('change', value => {
      this.infiniteCalculator.x = value;
    });
    this.animationLogic.on('scrollEnd', ({
      x
    }) => {
      if (this.props.onScrollEnd) {
        x *= -1;
        this.currentElement = this.infiniteElements.find(element => element.left === x);

        if (this.currentElement != null) {
          this.props.onScrollEnd(this.currentElement.phase, this.currentElement.data, this);
        } else {
          console.warn('InfiniteScroller is unable to determine the current item after the scroll ended.');
        }
      }
    });

    if (props.centerInWrapper != null) {
      this.animationLogic.updateCenterScroll(props.centerInWrapper);
    }

    this.panHandlerRef = React.createRef();
  }

  componentDidUpdate(_prevProps, prevState) {
    if (prevState.wrapperLayout.width !== this.state.wrapperLayout.width || prevState.itemLayout.width !== this.state.itemLayout.width) {
      this.infiniteCalculator.infiniteElementWidth = this.state.itemLayout.width;
      this.infiniteCalculator.wrapperWidth = this.state.wrapperLayout.width;
    }

    if (_prevProps.centerInWrapper !== this.props.centerInWrapper) {
      const centerInWrapper = this.props.centerInWrapper;
      this.animationLogic.updateCenterScroll(centerInWrapper != null ? centerInWrapper : false);
    }

    if (this.state.wrapperLayout.width !== 0 && this.state.itemLayout.width !== 0 && this.state.ready === false) {
      if (this.props.startingPosition != null) {
        this.scrollToIndex(this.props.startingPosition, false);
      } // eslint-disable-next-line react/no-did-update-set-state


      this.setState({
        ready: true
      });
    }

    if (this.state.itemLayout.width && this.props.totalItemCount != null) {
      this.animationLogic.updateMaxScroll(-1 * this.state.itemLayout.width * this.props.totalItemCount);
    }
  }

  componentWillUnmount() {
    this.infiniteCalculator.dispose();
  }

  calculateCurrentIndex(moveXValue) {
    const itemWidth = this.state.itemLayout.width;
    const wrapperWidth = this.state.wrapperLayout.width;
    const centerInWrapper = this.props.centerInWrapper != null ? this.props.centerInWrapper : false;
    const center = centerInWrapper ? wrapperWidth / 2 - itemWidth / 2 : 0;
    /**
     * The value will be slighly off because our snap end threshhold is a
     * bit high to ensure events are triggered in a timley manner.
     **/

    return Math.round((center - moveXValue) / itemWidth);
  }

  getCurrentIndex() {
    return this.calculateCurrentIndex(this.infiniteCalculator.x);
  }

  async goNext(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollToIndex(index + 1, withAnimation);
  }

  async goBack(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollToIndex(index - 1, withAnimation);
  }

  scrollToIndex(itemOffset, withAnimation = true) {
    this.animationLogic.scrollTo(-1 * itemOffset * this.state.itemLayout.width, withAnimation);
  }

  scrollToElement(element, withAnimation) {
    return this.scrollToIndex(element.phase, withAnimation);
  }

  findNearestInfiniteElement(comparator) {
    const x = -1 * this.infiniteCalculator.x;
    let elements = this.infiniteElements.sort((a, b) => {
      const aDelta = Math.abs(x - a.left);
      const bDelta = Math.abs(x - b.left);
      return aDelta - bDelta;
    });
    return elements.find(item => comparator(item));
  }

  scrollToItem(comparator, withAnimation) {
    const element = this.findNearestInfiniteElement(elm => elm.data != null ? comparator(elm.data) : false);

    if (element) {
      return this.scrollToElement(element, withAnimation);
    }
  }

  render() {
    const style = {
      opacity: this.state.ready ? 1 : 0,
      height: this.state.itemLayout.height
    };
    return <PanGestureHandler ref={this.panHandlerRef} simultaneousHandlers={this.props.simultaneousHandlers} waitFor={this.props.waitFor} onGestureEvent={this.animationLogic.gestureHandler} onHandlerStateChange={this.animationLogic.gestureHandler}>
				<Animated.View style={[this.props.style, style]} onLayout={this.onWrapperLayout}>
					<Animated.View style={{
          transform: [{
            translateX: this.animationLogic.x
          }, {
            perspective: 1000
          } // without this line this Animation will not render on Android while working fine on iOS
          ]
        }}>
						{this.infiniteElements.map((item, i) => {
            return <InfiniteItem elementIndex={i} renderItem={this.props.renderItem} item={item} key={i} onLayout={i === 0 ? this.onItemLayout : null} />;
          })}
					</Animated.View>
				</Animated.View>
			</PanGestureHandler>;
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9JbmZpbml0ZVNjcm9sbGVyLnRzeCJdLCJuYW1lcyI6WyJSZWFjdCIsIkNvbXBvbmVudCIsIkFuaW1hdGVkIiwiUGFuR2VzdHVyZUhhbmRsZXIiLCJJbmZpbml0ZUVsZW1lbnQiLCJJbmZpbml0ZUNhbGN1bGF0b3IiLCJJbmZpbml0ZUl0ZW0iLCJBbmltYXRpb25Mb2dpYyIsIkluZmluaXRlU2Nyb2xsZXIiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwibmF0aXZlRXZlbnQiLCJsYXlvdXQiLCJ3aWR0aCIsImhlaWdodCIsIml0ZW1MYXlvdXQiLCJzdGF0ZSIsInNldFN0YXRlIiwiYW5pbWF0aW9uTG9naWMiLCJ1cGRhdGVJdGVtV2lkdGgiLCJpbmZpbml0ZUNhbGN1bGF0b3IiLCJpbmZpbml0ZUVsZW1lbnRXaWR0aCIsIndyYXBwZXJMYXlvdXQiLCJ3cmFwcGVyV2lkdGgiLCJ1cGRhdGVXcmFwcGVyV2lkdGgiLCJyZWFkeSIsImluZmluaXRlRWxlbWVudHMiLCJpIiwiaW5maW5pdGVFbGVtZW50Q291bnQiLCJwdXNoIiwiaW5maW5pdGVMaW1pdCIsIk1hdGgiLCJmbG9vciIsImNhY2hlU2l6ZSIsImxlbmd0aCIsInNwcmluZ0NvbmZpZyIsImRlY2F5Q29uZmlnIiwib24iLCJ2YWx1ZSIsIngiLCJvblNjcm9sbEVuZCIsImN1cnJlbnRFbGVtZW50IiwiZmluZCIsImVsZW1lbnQiLCJsZWZ0IiwicGhhc2UiLCJkYXRhIiwiY29uc29sZSIsIndhcm4iLCJjZW50ZXJJbldyYXBwZXIiLCJ1cGRhdGVDZW50ZXJTY3JvbGwiLCJwYW5IYW5kbGVyUmVmIiwiY3JlYXRlUmVmIiwiY29tcG9uZW50RGlkVXBkYXRlIiwiX3ByZXZQcm9wcyIsInByZXZTdGF0ZSIsInN0YXJ0aW5nUG9zaXRpb24iLCJzY3JvbGxUb0luZGV4IiwidG90YWxJdGVtQ291bnQiLCJ1cGRhdGVNYXhTY3JvbGwiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImRpc3Bvc2UiLCJjYWxjdWxhdGVDdXJyZW50SW5kZXgiLCJtb3ZlWFZhbHVlIiwiaXRlbVdpZHRoIiwiY2VudGVyIiwicm91bmQiLCJnZXRDdXJyZW50SW5kZXgiLCJnb05leHQiLCJ3aXRoQW5pbWF0aW9uIiwiaW5kZXgiLCJnb0JhY2siLCJpdGVtT2Zmc2V0Iiwic2Nyb2xsVG8iLCJzY3JvbGxUb0VsZW1lbnQiLCJmaW5kTmVhcmVzdEluZmluaXRlRWxlbWVudCIsImNvbXBhcmF0b3IiLCJlbGVtZW50cyIsInNvcnQiLCJhIiwiYiIsImFEZWx0YSIsImFicyIsImJEZWx0YSIsIml0ZW0iLCJzY3JvbGxUb0l0ZW0iLCJlbG0iLCJyZW5kZXIiLCJzdHlsZSIsIm9wYWNpdHkiLCJzaW11bHRhbmVvdXNIYW5kbGVycyIsIndhaXRGb3IiLCJnZXN0dXJlSGFuZGxlciIsIm9uV3JhcHBlckxheW91dCIsInRyYW5zZm9ybSIsInRyYW5zbGF0ZVgiLCJwZXJzcGVjdGl2ZSIsIm1hcCIsInJlbmRlckl0ZW0iLCJvbkl0ZW1MYXlvdXQiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU9BLEtBQVAsSUFBZUMsU0FBZixRQUErQixPQUEvQjtBQUdBLE9BQU9DLFFBQVAsTUFBcUIseUJBQXJCO0FBQ0EsU0FBUUMsaUJBQVIsUUFBZ0MsOEJBQWhDO0FBQ0EsT0FBT0MsZUFBUCxNQUE0QixtQkFBNUI7QUFDQSxPQUFPQyxrQkFBUCxNQUErQixzQkFBL0I7QUFDQSxPQUFPQyxZQUFQLE1BQXlCLGdCQUF6QjtBQUNBLE9BQU9DLGNBQVAsTUFBMkIsa0JBQTNCO0FBaUNBLGVBQWUsTUFBTUMsZ0JBQU4sU0FBa0NQLFNBQWxDLENBR2I7QUFPRFEsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWtDO0FBQzVDLFVBQU1BLEtBQU47O0FBRDRDOztBQUFBLDhDQUxKLEVBS0k7O0FBQUE7O0FBQUE7O0FBQUE7O0FBQUEsMENBeUs5QixDQUFDO0FBQ2ZDLE1BQUFBLFdBQVcsRUFBRTtBQUNaQyxRQUFBQSxNQUFNLEVBQUU7QUFBQ0MsVUFBQUEsS0FBRDtBQUFRQyxVQUFBQTtBQUFSO0FBREk7QUFERSxLQUFELEtBSVU7QUFDeEIsWUFBTTtBQUFDQyxRQUFBQTtBQUFELFVBQWUsS0FBS0MsS0FBMUI7O0FBQ0EsVUFBSUQsVUFBVSxDQUFDRixLQUFYLEtBQXFCQSxLQUFyQixJQUE4QkUsVUFBVSxDQUFDRCxNQUFYLEtBQXNCQSxNQUF4RCxFQUFnRTtBQUMvRCxhQUFLRyxRQUFMLENBQWM7QUFDYkYsVUFBQUEsVUFBVSxFQUFFO0FBQUNGLFlBQUFBLEtBQUQ7QUFBUUMsWUFBQUE7QUFBUjtBQURDLFNBQWQ7QUFHQTs7QUFDRCxXQUFLSSxjQUFMLENBQW9CQyxlQUFwQixDQUFvQ04sS0FBcEM7QUFDQSxXQUFLTyxrQkFBTCxDQUF3QkMsb0JBQXhCLEdBQStDUixLQUEvQztBQUNBLEtBdEw0Qzs7QUFBQSw2Q0F3TDNCLENBQUM7QUFDbEJGLE1BQUFBLFdBQVcsRUFBRTtBQUNaQyxRQUFBQSxNQUFNLEVBQUU7QUFBQ0MsVUFBQUEsS0FBRDtBQUFRQyxVQUFBQTtBQUFSO0FBREk7QUFESyxLQUFELEtBSU87QUFDeEIsWUFBTTtBQUFDUSxRQUFBQTtBQUFELFVBQWtCLEtBQUtOLEtBQTdCOztBQUNBLFVBQUlNLGFBQWEsQ0FBQ1QsS0FBZCxLQUF3QkEsS0FBeEIsSUFBaUNTLGFBQWEsQ0FBQ1IsTUFBZCxLQUF5QkEsTUFBOUQsRUFBc0U7QUFDckUsYUFBS0csUUFBTCxDQUFjO0FBQ2JLLFVBQUFBLGFBQWEsRUFBRTtBQUFDVCxZQUFBQSxLQUFEO0FBQVFDLFlBQUFBO0FBQVI7QUFERixTQUFkO0FBR0E7O0FBQ0QsV0FBS00sa0JBQUwsQ0FBd0JHLFlBQXhCLEdBQXVDVixLQUF2QztBQUNBLFdBQUtLLGNBQUwsQ0FBb0JNLGtCQUFwQixDQUF1Q1gsS0FBdkM7QUFDQSxLQXJNNEM7O0FBRTVDLFNBQUtHLEtBQUwsR0FBYTtBQUNaRCxNQUFBQSxVQUFVLEVBQUU7QUFDWEYsUUFBQUEsS0FBSyxFQUFFLENBREk7QUFFWEMsUUFBQUEsTUFBTSxFQUFFO0FBRkcsT0FEQTtBQUtaUSxNQUFBQSxhQUFhLEVBQUU7QUFDZFQsUUFBQUEsS0FBSyxFQUFFLENBRE87QUFFZEMsUUFBQUEsTUFBTSxFQUFFO0FBRk0sT0FMSDtBQVNaVyxNQUFBQSxLQUFLLEVBQUU7QUFUSyxLQUFiO0FBV0EsU0FBS0MsZ0JBQUwsR0FBd0IsRUFBeEI7O0FBRUEsU0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxJQUFJakIsS0FBSyxDQUFDa0Isb0JBQU4sSUFBOEIsR0FBbEMsQ0FBakIsRUFBeURELENBQUMsRUFBMUQsRUFBOEQ7QUFDN0QsV0FBS0QsZ0JBQUwsQ0FBc0JHLElBQXRCLENBQTJCLElBQUl6QixlQUFKLEVBQTNCO0FBQ0E7O0FBRUQsU0FBS2dCLGtCQUFMLEdBQTBCLElBQUlmLGtCQUFKLG1CQUN0QkssS0FEc0I7QUFFekJvQixNQUFBQSxhQUFhLEVBQUVDLElBQUksQ0FBQ0MsS0FBTCxDQUFXLGFBQWEsSUFBeEIsQ0FGVTtBQUd6Qk4sTUFBQUEsZ0JBQWdCLEVBQUUsS0FBS0EsZ0JBSEU7QUFJekJPLE1BQUFBLFNBQVMsRUFBRSxLQUFLUCxnQkFBTCxDQUFzQlEsTUFBdEIsR0FBK0I7QUFKakIsT0FBMUI7QUFPQSxTQUFLaEIsY0FBTCxHQUFzQlgsY0FBYyxDQUFDO0FBQ3BDNEIsTUFBQUEsWUFBWSxFQUFFekIsS0FBSyxDQUFDeUIsWUFBTixJQUFzQixFQURBO0FBRXBDQyxNQUFBQSxXQUFXLEVBQUUxQixLQUFLLENBQUMwQixXQUFOLElBQXFCO0FBRkUsS0FBRCxDQUFwQztBQUlBLFNBQUtsQixjQUFMLENBQW9CbUIsRUFBcEIsQ0FBdUIsUUFBdkIsRUFBaUNDLEtBQUssSUFBSTtBQUN6QyxXQUFLbEIsa0JBQUwsQ0FBd0JtQixDQUF4QixHQUE0QkQsS0FBNUI7QUFDQSxLQUZEO0FBR0EsU0FBS3BCLGNBQUwsQ0FBb0JtQixFQUFwQixDQUF1QixXQUF2QixFQUFvQyxDQUFDO0FBQUNFLE1BQUFBO0FBQUQsS0FBRCxLQUFTO0FBQzVDLFVBQUksS0FBSzdCLEtBQUwsQ0FBVzhCLFdBQWYsRUFBNEI7QUFDM0JELFFBQUFBLENBQUMsSUFBSSxDQUFDLENBQU47QUFDQSxhQUFLRSxjQUFMLEdBQXNCLEtBQUtmLGdCQUFMLENBQXNCZ0IsSUFBdEIsQ0FDckJDLE9BQU8sSUFBSUEsT0FBTyxDQUFDQyxJQUFSLEtBQWlCTCxDQURQLENBQXRCOztBQUdBLFlBQUksS0FBS0UsY0FBTCxJQUF1QixJQUEzQixFQUFpQztBQUNoQyxlQUFLL0IsS0FBTCxDQUFXOEIsV0FBWCxDQUNDLEtBQUtDLGNBQUwsQ0FBb0JJLEtBRHJCLEVBRUMsS0FBS0osY0FBTCxDQUFvQkssSUFGckIsRUFHQyxJQUhEO0FBS0EsU0FORCxNQU1PO0FBQ05DLFVBQUFBLE9BQU8sQ0FBQ0MsSUFBUixDQUNDLGtGQUREO0FBR0E7QUFDRDtBQUNELEtBbEJEOztBQW9CQSxRQUFJdEMsS0FBSyxDQUFDdUMsZUFBTixJQUF5QixJQUE3QixFQUFtQztBQUNsQyxXQUFLL0IsY0FBTCxDQUFvQmdDLGtCQUFwQixDQUF1Q3hDLEtBQUssQ0FBQ3VDLGVBQTdDO0FBQ0E7O0FBRUQsU0FBS0UsYUFBTCxHQUFxQm5ELEtBQUssQ0FBQ29ELFNBQU4sRUFBckI7QUFDQTs7QUFFREMsRUFBQUEsa0JBQWtCLENBQ2pCQyxVQURpQixFQUVqQkMsU0FGaUIsRUFHaEI7QUFDRCxRQUNDQSxTQUFTLENBQUNqQyxhQUFWLENBQXdCVCxLQUF4QixLQUFrQyxLQUFLRyxLQUFMLENBQVdNLGFBQVgsQ0FBeUJULEtBQTNELElBQ0EwQyxTQUFTLENBQUN4QyxVQUFWLENBQXFCRixLQUFyQixLQUErQixLQUFLRyxLQUFMLENBQVdELFVBQVgsQ0FBc0JGLEtBRnRELEVBR0U7QUFDRCxXQUFLTyxrQkFBTCxDQUF3QkMsb0JBQXhCLEdBQStDLEtBQUtMLEtBQUwsQ0FBV0QsVUFBWCxDQUFzQkYsS0FBckU7QUFDQSxXQUFLTyxrQkFBTCxDQUF3QkcsWUFBeEIsR0FBdUMsS0FBS1AsS0FBTCxDQUFXTSxhQUFYLENBQXlCVCxLQUFoRTtBQUNBOztBQUVELFFBQUl5QyxVQUFVLENBQUNMLGVBQVgsS0FBK0IsS0FBS3ZDLEtBQUwsQ0FBV3VDLGVBQTlDLEVBQStEO0FBQzlELFlBQU1BLGVBQWUsR0FBRyxLQUFLdkMsS0FBTCxDQUFXdUMsZUFBbkM7QUFDQSxXQUFLL0IsY0FBTCxDQUFvQmdDLGtCQUFwQixDQUNDRCxlQUFlLElBQUksSUFBbkIsR0FBMEJBLGVBQTFCLEdBQTRDLEtBRDdDO0FBR0E7O0FBRUQsUUFDQyxLQUFLakMsS0FBTCxDQUFXTSxhQUFYLENBQXlCVCxLQUF6QixLQUFtQyxDQUFuQyxJQUNBLEtBQUtHLEtBQUwsQ0FBV0QsVUFBWCxDQUFzQkYsS0FBdEIsS0FBZ0MsQ0FEaEMsSUFFQSxLQUFLRyxLQUFMLENBQVdTLEtBQVgsS0FBcUIsS0FIdEIsRUFJRTtBQUNELFVBQUksS0FBS2YsS0FBTCxDQUFXOEMsZ0JBQVgsSUFBK0IsSUFBbkMsRUFBeUM7QUFDeEMsYUFBS0MsYUFBTCxDQUFtQixLQUFLL0MsS0FBTCxDQUFXOEMsZ0JBQTlCLEVBQWdELEtBQWhEO0FBQ0EsT0FIQSxDQUlEOzs7QUFDQSxXQUFLdkMsUUFBTCxDQUFjO0FBQ2JRLFFBQUFBLEtBQUssRUFBRTtBQURNLE9BQWQ7QUFHQTs7QUFFRCxRQUFJLEtBQUtULEtBQUwsQ0FBV0QsVUFBWCxDQUFzQkYsS0FBdEIsSUFBK0IsS0FBS0gsS0FBTCxDQUFXZ0QsY0FBWCxJQUE2QixJQUFoRSxFQUFzRTtBQUNyRSxXQUFLeEMsY0FBTCxDQUFvQnlDLGVBQXBCLENBQ0MsQ0FBQyxDQUFELEdBQUssS0FBSzNDLEtBQUwsQ0FBV0QsVUFBWCxDQUFzQkYsS0FBM0IsR0FBbUMsS0FBS0gsS0FBTCxDQUFXZ0QsY0FEL0M7QUFHQTtBQUNEOztBQUVERSxFQUFBQSxvQkFBb0IsR0FBRztBQUN0QixTQUFLeEMsa0JBQUwsQ0FBd0J5QyxPQUF4QjtBQUNBOztBQUVEQyxFQUFBQSxxQkFBcUIsQ0FBQ0MsVUFBRCxFQUFxQjtBQUN6QyxVQUFNQyxTQUFTLEdBQUcsS0FBS2hELEtBQUwsQ0FBV0QsVUFBWCxDQUFzQkYsS0FBeEM7QUFDQSxVQUFNVSxZQUFZLEdBQUcsS0FBS1AsS0FBTCxDQUFXTSxhQUFYLENBQXlCVCxLQUE5QztBQUNBLFVBQU1vQyxlQUFlLEdBQ3BCLEtBQUt2QyxLQUFMLENBQVd1QyxlQUFYLElBQThCLElBQTlCLEdBQ0csS0FBS3ZDLEtBQUwsQ0FBV3VDLGVBRGQsR0FFRyxLQUhKO0FBSUEsVUFBTWdCLE1BQU0sR0FBR2hCLGVBQWUsR0FBRzFCLFlBQVksR0FBRyxDQUFmLEdBQW1CeUMsU0FBUyxHQUFHLENBQWxDLEdBQXNDLENBQXBFO0FBQ0E7Ozs7O0FBSUEsV0FBT2pDLElBQUksQ0FBQ21DLEtBQUwsQ0FBVyxDQUFDRCxNQUFNLEdBQUdGLFVBQVYsSUFBd0JDLFNBQW5DLENBQVA7QUFDQTs7QUFFREcsRUFBQUEsZUFBZSxHQUFHO0FBQ2pCLFdBQU8sS0FBS0wscUJBQUwsQ0FBMkIsS0FBSzFDLGtCQUFMLENBQXdCbUIsQ0FBbkQsQ0FBUDtBQUNBOztBQUVELFFBQU02QixNQUFOLENBQWFDLGFBQXNCLEdBQUcsSUFBdEMsRUFBNEM7QUFDM0MsVUFBTUMsS0FBSyxHQUFHLEtBQUtILGVBQUwsRUFBZDtBQUNBLFdBQU8sS0FBS1YsYUFBTCxDQUFtQmEsS0FBSyxHQUFHLENBQTNCLEVBQThCRCxhQUE5QixDQUFQO0FBQ0E7O0FBRUQsUUFBTUUsTUFBTixDQUFhRixhQUFzQixHQUFHLElBQXRDLEVBQTRDO0FBQzNDLFVBQU1DLEtBQUssR0FBRyxLQUFLSCxlQUFMLEVBQWQ7QUFDQSxXQUFPLEtBQUtWLGFBQUwsQ0FBbUJhLEtBQUssR0FBRyxDQUEzQixFQUE4QkQsYUFBOUIsQ0FBUDtBQUNBOztBQUVEWixFQUFBQSxhQUFhLENBQUNlLFVBQUQsRUFBcUJILGFBQXNCLEdBQUcsSUFBOUMsRUFBb0Q7QUFDaEUsU0FBS25ELGNBQUwsQ0FBb0J1RCxRQUFwQixDQUNDLENBQUMsQ0FBRCxHQUFLRCxVQUFMLEdBQWtCLEtBQUt4RCxLQUFMLENBQVdELFVBQVgsQ0FBc0JGLEtBRHpDLEVBRUN3RCxhQUZEO0FBSUE7O0FBRURLLEVBQUFBLGVBQWUsQ0FBQy9CLE9BQUQsRUFBOEIwQixhQUE5QixFQUF1RDtBQUNyRSxXQUFPLEtBQUtaLGFBQUwsQ0FBbUJkLE9BQU8sQ0FBQ0UsS0FBM0IsRUFBa0N3QixhQUFsQyxDQUFQO0FBQ0E7O0FBRURNLEVBQUFBLDBCQUEwQixDQUN6QkMsVUFEeUIsRUFFUTtBQUNqQyxVQUFNckMsQ0FBQyxHQUFHLENBQUMsQ0FBRCxHQUFLLEtBQUtuQixrQkFBTCxDQUF3Qm1CLENBQXZDO0FBQ0EsUUFBSXNDLFFBQVEsR0FBRyxLQUFLbkQsZ0JBQUwsQ0FBc0JvRCxJQUF0QixDQUEyQixDQUFDQyxDQUFELEVBQUlDLENBQUosS0FBVTtBQUNuRCxZQUFNQyxNQUFNLEdBQUdsRCxJQUFJLENBQUNtRCxHQUFMLENBQVMzQyxDQUFDLEdBQUd3QyxDQUFDLENBQUNuQyxJQUFmLENBQWY7QUFDQSxZQUFNdUMsTUFBTSxHQUFHcEQsSUFBSSxDQUFDbUQsR0FBTCxDQUFTM0MsQ0FBQyxHQUFHeUMsQ0FBQyxDQUFDcEMsSUFBZixDQUFmO0FBQ0EsYUFBT3FDLE1BQU0sR0FBR0UsTUFBaEI7QUFDQSxLQUpjLENBQWY7QUFLQSxXQUFPTixRQUFRLENBQUNuQyxJQUFULENBQWMwQyxJQUFJLElBQUlSLFVBQVUsQ0FBQ1EsSUFBRCxDQUFoQyxDQUFQO0FBQ0E7O0FBRURDLEVBQUFBLFlBQVksQ0FDWFQsVUFEVyxFQUVYUCxhQUZXLEVBR1Y7QUFDRCxVQUFNMUIsT0FBTyxHQUFHLEtBQUtnQywwQkFBTCxDQUFnQ1csR0FBRyxJQUNsREEsR0FBRyxDQUFDeEMsSUFBSixJQUFZLElBQVosR0FBbUI4QixVQUFVLENBQUNVLEdBQUcsQ0FBQ3hDLElBQUwsQ0FBN0IsR0FBMEMsS0FEM0IsQ0FBaEI7O0FBSUEsUUFBSUgsT0FBSixFQUFhO0FBQ1osYUFBTyxLQUFLK0IsZUFBTCxDQUFxQi9CLE9BQXJCLEVBQThCMEIsYUFBOUIsQ0FBUDtBQUNBO0FBQ0Q7O0FBZ0NEa0IsRUFBQUEsTUFBTSxHQUFHO0FBQ1IsVUFBTUMsS0FBSyxHQUFHO0FBQ2JDLE1BQUFBLE9BQU8sRUFBRSxLQUFLekUsS0FBTCxDQUFXUyxLQUFYLEdBQW1CLENBQW5CLEdBQXVCLENBRG5CO0FBRWJYLE1BQUFBLE1BQU0sRUFBRSxLQUFLRSxLQUFMLENBQVdELFVBQVgsQ0FBc0JEO0FBRmpCLEtBQWQ7QUFJQSxXQUNDLENBQUMsaUJBQUQsQ0FDQyxJQUFJLENBQUMsS0FBS3FDLGFBQU4sQ0FETCxDQUVDLHFCQUFxQixDQUFDLEtBQUt6QyxLQUFMLENBQVdnRixvQkFBWixDQUZ0QixDQUdDLFFBQVEsQ0FBQyxLQUFLaEYsS0FBTCxDQUFXaUYsT0FBWixDQUhULENBSUMsZUFBZSxDQUFDLEtBQUt6RSxjQUFMLENBQW9CMEUsY0FBckIsQ0FKaEIsQ0FLQyxxQkFBcUIsQ0FBQyxLQUFLMUUsY0FBTCxDQUFvQjBFLGNBQXJCLENBTHRCO0lBTUMsQ0FBQyxTQUFTLElBQVYsQ0FDQyxNQUFNLENBQUMsQ0FBQyxLQUFLbEYsS0FBTCxDQUFXOEUsS0FBWixFQUFtQkEsS0FBbkIsQ0FBRCxDQURQLENBRUMsU0FBUyxDQUFDLEtBQUtLLGVBQU4sQ0FGVjtLQUdDLENBQUMsU0FBUyxJQUFWLENBQ0MsTUFBTSxDQUFDO0FBQ05DLFVBQUFBLFNBQVMsRUFBRSxDQUNWO0FBQUNDLFlBQUFBLFVBQVUsRUFBRSxLQUFLN0UsY0FBTCxDQUFvQnFCO0FBQWpDLFdBRFUsRUFFVjtBQUFDeUQsWUFBQUEsV0FBVyxFQUFFO0FBQWQsV0FGVSxDQUVXO0FBRlg7QUFETCxTQUFELENBRFA7TUFPQyxDQUFDLEtBQUt0RSxnQkFBTCxDQUFzQnVFLEdBQXRCLENBQTBCLENBQUNiLElBQUQsRUFBT3pELENBQVAsS0FBYTtBQUN2QyxtQkFDQyxDQUFDLFlBQUQsQ0FDQyxhQUFhLENBQUNBLENBQUQsQ0FEZCxDQUVDLFdBQVcsQ0FBQyxLQUFLakIsS0FBTCxDQUFXd0YsVUFBWixDQUZaLENBR0MsS0FBSyxDQUFDZCxJQUFELENBSE4sQ0FJQyxJQUFJLENBQUN6RCxDQUFELENBSkwsQ0FLQyxTQUFTLENBQ1JBLENBQUMsS0FBSyxDQUFOLEdBQVUsS0FBS3dFLFlBQWYsR0FBOEIsSUFEdEIsQ0FMVixHQUREO0FBV0EsV0FaQSxDQUFEO0tBYUQsRUFBRSxTQUFTLElBQVg7SUFDRCxFQUFFLFNBQVMsSUFBWDtHQUNELEVBQUUsaUJBQUYsQ0FoQ0Q7QUFrQ0E7O0FBclBBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7Q29tcG9uZW50fSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge0xheW91dENoYW5nZUV2ZW50LCBTdHlsZVByb3AsIFZpZXdTdHlsZX0gZnJvbSAncmVhY3QtbmF0aXZlJztcblxuaW1wb3J0IEFuaW1hdGVkIGZyb20gJ3JlYWN0LW5hdGl2ZS1yZWFuaW1hdGVkJztcbmltcG9ydCB7UGFuR2VzdHVyZUhhbmRsZXJ9IGZyb20gJ3JlYWN0LW5hdGl2ZS1nZXN0dXJlLWhhbmRsZXInO1xuaW1wb3J0IEluZmluaXRlRWxlbWVudCBmcm9tICcuL0luZmluaXRlRWxlbWVudCc7XG5pbXBvcnQgSW5maW5pdGVDYWxjdWxhdG9yIGZyb20gJy4vSW5maW5pdGVDYWxjdWxhdG9yJztcbmltcG9ydCBJbmZpbml0ZUl0ZW0gZnJvbSAnLi9JbmZpbml0ZUl0ZW0nO1xuaW1wb3J0IEFuaW1hdGlvbkxvZ2ljIGZyb20gJy4vQW5pbWF0aW9uTG9naWMnO1xuXG5pbnRlcmZhY2UgSW5maW5pdGVTY3JvbGxlclByb3BzPFQ+IHtcblx0ZGF0YXNldChzdGFydDogbnVtYmVyLCBjb3VudDogbnVtYmVyKTogUHJvbWlzZTxUW10+O1xuXHRyZW5kZXJJdGVtOiAoZGF0YTogVCB8IG51bGwpID0+IFJlYWN0LlJlYWN0RWxlbWVudDtcblx0c3R5bGU/OiBTdHlsZVByb3A8Vmlld1N0eWxlPjtcblx0dG90YWxJdGVtQ291bnQ/OiBudW1iZXIgfCBudWxsO1xuXHRjZW50ZXJJbldyYXBwZXI/OiBib29sZWFuIHwgbnVsbDtcblx0c3RhcnRpbmdQb3NpdGlvbj86IG51bWJlciB8IG51bGw7XG5cdG9uU2Nyb2xsRW5kPzogKFxuXHRcdHNjcm9sbFBvc2l0aW9uOiBudW1iZXIsXG5cdFx0ZGF0YTogVCB8IG51bGwsXG5cdFx0c2Nyb2xsZXI6IEluZmluaXRlU2Nyb2xsZXI8VD4sXG5cdCkgPT4gdm9pZCB8IG51bGw7XG5cdGluZmluaXRlRWxlbWVudENvdW50PzogbnVtYmVyIHwgbnVsbDtcblx0d2FpdEZvcj86IFJlYWN0LlJlZk9iamVjdDxhbnk+W107XG5cdHNpbXVsdGFuZW91c0hhbmRsZXJzPzogUmVhY3QuUmVmT2JqZWN0PGFueT5bXTtcblx0c3ByaW5nQ29uZmlnPzogT2JqZWN0O1xuXHRkZWNheUNvbmZpZz86IE9iamVjdDtcbn1cblxuaW50ZXJmYWNlIEluZmluaXRlU2Nyb2xsZXJTdGF0ZSB7XG5cdGl0ZW1MYXlvdXQ6IHtcblx0XHR3aWR0aDogbnVtYmVyO1xuXHRcdGhlaWdodDogbnVtYmVyO1xuXHR9O1xuXHR3cmFwcGVyTGF5b3V0OiB7XG5cdFx0d2lkdGg6IG51bWJlcjtcblx0XHRoZWlnaHQ6IG51bWJlcjtcblx0fTtcblx0cmVhZHk6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEluZmluaXRlU2Nyb2xsZXI8VD4gZXh0ZW5kcyBDb21wb25lbnQ8XG5cdEluZmluaXRlU2Nyb2xsZXJQcm9wczxUPixcblx0SW5maW5pdGVTY3JvbGxlclN0YXRlXG4+IHtcblx0aW5maW5pdGVDYWxjdWxhdG9yOiBJbmZpbml0ZUNhbGN1bGF0b3I8VD47XG5cdGluZmluaXRlRWxlbWVudHM6IEluZmluaXRlRWxlbWVudDxUPltdID0gW107XG5cdGFuaW1hdGlvbkxvZ2ljOiBBbmltYXRpb25Mb2dpYztcblx0Y3VycmVudEVsZW1lbnQ/OiBJbmZpbml0ZUVsZW1lbnQ8VD4gfCBudWxsO1xuXHRwYW5IYW5kbGVyUmVmOiBSZWFjdC5SZWZPYmplY3Q8UGFuR2VzdHVyZUhhbmRsZXI+O1xuXG5cdGNvbnN0cnVjdG9yKHByb3BzOiBJbmZpbml0ZVNjcm9sbGVyUHJvcHM8VD4pIHtcblx0XHRzdXBlcihwcm9wcyk7XG5cdFx0dGhpcy5zdGF0ZSA9IHtcblx0XHRcdGl0ZW1MYXlvdXQ6IHtcblx0XHRcdFx0d2lkdGg6IDAsXG5cdFx0XHRcdGhlaWdodDogMCxcblx0XHRcdH0sXG5cdFx0XHR3cmFwcGVyTGF5b3V0OiB7XG5cdFx0XHRcdHdpZHRoOiAwLFxuXHRcdFx0XHRoZWlnaHQ6IDAsXG5cdFx0XHR9LFxuXHRcdFx0cmVhZHk6IGZhbHNlLFxuXHRcdH07XG5cdFx0dGhpcy5pbmZpbml0ZUVsZW1lbnRzID0gW107XG5cblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IChwcm9wcy5pbmZpbml0ZUVsZW1lbnRDb3VudCB8fCAxMDApOyBpKyspIHtcblx0XHRcdHRoaXMuaW5maW5pdGVFbGVtZW50cy5wdXNoKG5ldyBJbmZpbml0ZUVsZW1lbnQ8VD4oKSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3IgPSBuZXcgSW5maW5pdGVDYWxjdWxhdG9yKHtcblx0XHRcdC4uLnByb3BzLFxuXHRcdFx0aW5maW5pdGVMaW1pdDogTWF0aC5mbG9vcigyMTQ3NDgzNjQ1IC8gMTAwMCksXG5cdFx0XHRpbmZpbml0ZUVsZW1lbnRzOiB0aGlzLmluZmluaXRlRWxlbWVudHMsXG5cdFx0XHRjYWNoZVNpemU6IHRoaXMuaW5maW5pdGVFbGVtZW50cy5sZW5ndGggKiAyLFxuXHRcdH0pO1xuXG5cdFx0dGhpcy5hbmltYXRpb25Mb2dpYyA9IEFuaW1hdGlvbkxvZ2ljKHtcblx0XHRcdHNwcmluZ0NvbmZpZzogcHJvcHMuc3ByaW5nQ29uZmlnIHx8IHt9LFxuXHRcdFx0ZGVjYXlDb25maWc6IHByb3BzLmRlY2F5Q29uZmlnIHx8IHt9XG5cdFx0fSk7XG5cdFx0dGhpcy5hbmltYXRpb25Mb2dpYy5vbignY2hhbmdlJywgdmFsdWUgPT4ge1xuXHRcdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3IueCA9IHZhbHVlO1xuXHRcdH0pO1xuXHRcdHRoaXMuYW5pbWF0aW9uTG9naWMub24oJ3Njcm9sbEVuZCcsICh7eH0pID0+IHtcblx0XHRcdGlmICh0aGlzLnByb3BzLm9uU2Nyb2xsRW5kKSB7XG5cdFx0XHRcdHggKj0gLTE7XG5cdFx0XHRcdHRoaXMuY3VycmVudEVsZW1lbnQgPSB0aGlzLmluZmluaXRlRWxlbWVudHMuZmluZChcblx0XHRcdFx0XHRlbGVtZW50ID0+IGVsZW1lbnQubGVmdCA9PT0geCxcblx0XHRcdFx0KTtcblx0XHRcdFx0aWYgKHRoaXMuY3VycmVudEVsZW1lbnQgIT0gbnVsbCkge1xuXHRcdFx0XHRcdHRoaXMucHJvcHMub25TY3JvbGxFbmQoXG5cdFx0XHRcdFx0XHR0aGlzLmN1cnJlbnRFbGVtZW50LnBoYXNlLFxuXHRcdFx0XHRcdFx0dGhpcy5jdXJyZW50RWxlbWVudC5kYXRhLFxuXHRcdFx0XHRcdFx0dGhpcyxcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnNvbGUud2Fybihcblx0XHRcdFx0XHRcdCdJbmZpbml0ZVNjcm9sbGVyIGlzIHVuYWJsZSB0byBkZXRlcm1pbmUgdGhlIGN1cnJlbnQgaXRlbSBhZnRlciB0aGUgc2Nyb2xsIGVuZGVkLicsXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0aWYgKHByb3BzLmNlbnRlckluV3JhcHBlciAhPSBudWxsKSB7XG5cdFx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnVwZGF0ZUNlbnRlclNjcm9sbChwcm9wcy5jZW50ZXJJbldyYXBwZXIpO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLnBhbkhhbmRsZXJSZWYgPSBSZWFjdC5jcmVhdGVSZWYoKTtcblx0fVxuXG5cdGNvbXBvbmVudERpZFVwZGF0ZShcblx0XHRfcHJldlByb3BzOiBJbmZpbml0ZVNjcm9sbGVyUHJvcHM8VD4sXG5cdFx0cHJldlN0YXRlOiBJbmZpbml0ZVNjcm9sbGVyU3RhdGUsXG5cdCkge1xuXHRcdGlmIChcblx0XHRcdHByZXZTdGF0ZS53cmFwcGVyTGF5b3V0LndpZHRoICE9PSB0aGlzLnN0YXRlLndyYXBwZXJMYXlvdXQud2lkdGggfHxcblx0XHRcdHByZXZTdGF0ZS5pdGVtTGF5b3V0LndpZHRoICE9PSB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGhcblx0XHQpIHtcblx0XHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLmluZmluaXRlRWxlbWVudFdpZHRoID0gdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoO1xuXHRcdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3Iud3JhcHBlcldpZHRoID0gdGhpcy5zdGF0ZS53cmFwcGVyTGF5b3V0LndpZHRoO1xuXHRcdH1cblxuXHRcdGlmIChfcHJldlByb3BzLmNlbnRlckluV3JhcHBlciAhPT0gdGhpcy5wcm9wcy5jZW50ZXJJbldyYXBwZXIpIHtcblx0XHRcdGNvbnN0IGNlbnRlckluV3JhcHBlciA9IHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyO1xuXHRcdFx0dGhpcy5hbmltYXRpb25Mb2dpYy51cGRhdGVDZW50ZXJTY3JvbGwoXG5cdFx0XHRcdGNlbnRlckluV3JhcHBlciAhPSBudWxsID8gY2VudGVySW5XcmFwcGVyIDogZmFsc2UsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmIChcblx0XHRcdHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aCAhPT0gMCAmJlxuXHRcdFx0dGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoICE9PSAwICYmXG5cdFx0XHR0aGlzLnN0YXRlLnJlYWR5ID09PSBmYWxzZVxuXHRcdCkge1xuXHRcdFx0aWYgKHRoaXMucHJvcHMuc3RhcnRpbmdQb3NpdGlvbiAhPSBudWxsKSB7XG5cdFx0XHRcdHRoaXMuc2Nyb2xsVG9JbmRleCh0aGlzLnByb3BzLnN0YXJ0aW5nUG9zaXRpb24sIGZhbHNlKTtcblx0XHRcdH1cblx0XHRcdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9uby1kaWQtdXBkYXRlLXNldC1zdGF0ZVxuXHRcdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdHJlYWR5OiB0cnVlLFxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aCAmJiB0aGlzLnByb3BzLnRvdGFsSXRlbUNvdW50ICE9IG51bGwpIHtcblx0XHRcdHRoaXMuYW5pbWF0aW9uTG9naWMudXBkYXRlTWF4U2Nyb2xsKFxuXHRcdFx0XHQtMSAqIHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aCAqIHRoaXMucHJvcHMudG90YWxJdGVtQ291bnQsXG5cdFx0XHQpO1xuXHRcdH1cblx0fVxuXG5cdGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuXHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLmRpc3Bvc2UoKTtcblx0fVxuXG5cdGNhbGN1bGF0ZUN1cnJlbnRJbmRleChtb3ZlWFZhbHVlOiBudW1iZXIpIHtcblx0XHRjb25zdCBpdGVtV2lkdGggPSB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGg7XG5cdFx0Y29uc3Qgd3JhcHBlcldpZHRoID0gdGhpcy5zdGF0ZS53cmFwcGVyTGF5b3V0LndpZHRoO1xuXHRcdGNvbnN0IGNlbnRlckluV3JhcHBlciA9XG5cdFx0XHR0aGlzLnByb3BzLmNlbnRlckluV3JhcHBlciAhPSBudWxsXG5cdFx0XHRcdD8gdGhpcy5wcm9wcy5jZW50ZXJJbldyYXBwZXJcblx0XHRcdFx0OiBmYWxzZTtcblx0XHRjb25zdCBjZW50ZXIgPSBjZW50ZXJJbldyYXBwZXIgPyB3cmFwcGVyV2lkdGggLyAyIC0gaXRlbVdpZHRoIC8gMiA6IDA7XG5cdFx0LyoqXG5cdFx0ICogVGhlIHZhbHVlIHdpbGwgYmUgc2xpZ2hseSBvZmYgYmVjYXVzZSBvdXIgc25hcCBlbmQgdGhyZXNoaG9sZCBpcyBhXG5cdFx0ICogYml0IGhpZ2ggdG8gZW5zdXJlIGV2ZW50cyBhcmUgdHJpZ2dlcmVkIGluIGEgdGltbGV5IG1hbm5lci5cblx0XHQgKiovXG5cdFx0cmV0dXJuIE1hdGgucm91bmQoKGNlbnRlciAtIG1vdmVYVmFsdWUpIC8gaXRlbVdpZHRoKTtcblx0fVxuXG5cdGdldEN1cnJlbnRJbmRleCgpIHtcblx0XHRyZXR1cm4gdGhpcy5jYWxjdWxhdGVDdXJyZW50SW5kZXgodGhpcy5pbmZpbml0ZUNhbGN1bGF0b3IueCk7XG5cdH1cblxuXHRhc3luYyBnb05leHQod2l0aEFuaW1hdGlvbjogYm9vbGVhbiA9IHRydWUpIHtcblx0XHRjb25zdCBpbmRleCA9IHRoaXMuZ2V0Q3VycmVudEluZGV4KCk7XG5cdFx0cmV0dXJuIHRoaXMuc2Nyb2xsVG9JbmRleChpbmRleCArIDEsIHdpdGhBbmltYXRpb24pO1xuXHR9XG5cblx0YXN5bmMgZ29CYWNrKHdpdGhBbmltYXRpb246IGJvb2xlYW4gPSB0cnVlKSB7XG5cdFx0Y29uc3QgaW5kZXggPSB0aGlzLmdldEN1cnJlbnRJbmRleCgpO1xuXHRcdHJldHVybiB0aGlzLnNjcm9sbFRvSW5kZXgoaW5kZXggLSAxLCB3aXRoQW5pbWF0aW9uKTtcblx0fVxuXG5cdHNjcm9sbFRvSW5kZXgoaXRlbU9mZnNldDogbnVtYmVyLCB3aXRoQW5pbWF0aW9uOiBib29sZWFuID0gdHJ1ZSkge1xuXHRcdHRoaXMuYW5pbWF0aW9uTG9naWMuc2Nyb2xsVG8oXG5cdFx0XHQtMSAqIGl0ZW1PZmZzZXQgKiB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGgsXG5cdFx0XHR3aXRoQW5pbWF0aW9uLFxuXHRcdCk7XG5cdH1cblxuXHRzY3JvbGxUb0VsZW1lbnQoZWxlbWVudDogSW5maW5pdGVFbGVtZW50PFQ+LCB3aXRoQW5pbWF0aW9uPzogYm9vbGVhbikge1xuXHRcdHJldHVybiB0aGlzLnNjcm9sbFRvSW5kZXgoZWxlbWVudC5waGFzZSwgd2l0aEFuaW1hdGlvbik7XG5cdH1cblxuXHRmaW5kTmVhcmVzdEluZmluaXRlRWxlbWVudChcblx0XHRjb21wYXJhdG9yOiAoaXRlbTogSW5maW5pdGVFbGVtZW50PFQ+KSA9PiBib29sZWFuLFxuXHQpOiBJbmZpbml0ZUVsZW1lbnQ8VD4gfCB1bmRlZmluZWQge1xuXHRcdGNvbnN0IHggPSAtMSAqIHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLng7XG5cdFx0bGV0IGVsZW1lbnRzID0gdGhpcy5pbmZpbml0ZUVsZW1lbnRzLnNvcnQoKGEsIGIpID0+IHtcblx0XHRcdGNvbnN0IGFEZWx0YSA9IE1hdGguYWJzKHggLSBhLmxlZnQpO1xuXHRcdFx0Y29uc3QgYkRlbHRhID0gTWF0aC5hYnMoeCAtIGIubGVmdCk7XG5cdFx0XHRyZXR1cm4gYURlbHRhIC0gYkRlbHRhO1xuXHRcdH0pO1xuXHRcdHJldHVybiBlbGVtZW50cy5maW5kKGl0ZW0gPT4gY29tcGFyYXRvcihpdGVtKSk7XG5cdH1cblxuXHRzY3JvbGxUb0l0ZW0oXG5cdFx0Y29tcGFyYXRvcjogKGl0ZW06IFQgfCBudWxsKSA9PiBib29sZWFuLFxuXHRcdHdpdGhBbmltYXRpb24/OiBib29sZWFuLFxuXHQpIHtcblx0XHRjb25zdCBlbGVtZW50ID0gdGhpcy5maW5kTmVhcmVzdEluZmluaXRlRWxlbWVudChlbG0gPT5cblx0XHRcdGVsbS5kYXRhICE9IG51bGwgPyBjb21wYXJhdG9yKGVsbS5kYXRhKSA6IGZhbHNlLFxuXHRcdCk7XG5cblx0XHRpZiAoZWxlbWVudCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuc2Nyb2xsVG9FbGVtZW50KGVsZW1lbnQsIHdpdGhBbmltYXRpb24pO1xuXHRcdH1cblx0fVxuXG5cdG9uSXRlbUxheW91dCA9ICh7XG5cdFx0bmF0aXZlRXZlbnQ6IHtcblx0XHRcdGxheW91dDoge3dpZHRoLCBoZWlnaHR9LFxuXHRcdH0sXG5cdH06IExheW91dENoYW5nZUV2ZW50KSA9PiB7XG5cdFx0Y29uc3Qge2l0ZW1MYXlvdXR9ID0gdGhpcy5zdGF0ZTtcblx0XHRpZiAoaXRlbUxheW91dC53aWR0aCAhPT0gd2lkdGggfHwgaXRlbUxheW91dC5oZWlnaHQgIT09IGhlaWdodCkge1xuXHRcdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdGl0ZW1MYXlvdXQ6IHt3aWR0aCwgaGVpZ2h0fSxcblx0XHRcdH0pO1xuXHRcdH1cblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnVwZGF0ZUl0ZW1XaWR0aCh3aWR0aCk7XG5cdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3IuaW5maW5pdGVFbGVtZW50V2lkdGggPSB3aWR0aDtcblx0fTtcblxuXHRvbldyYXBwZXJMYXlvdXQgPSAoe1xuXHRcdG5hdGl2ZUV2ZW50OiB7XG5cdFx0XHRsYXlvdXQ6IHt3aWR0aCwgaGVpZ2h0fSxcblx0XHR9LFxuXHR9OiBMYXlvdXRDaGFuZ2VFdmVudCkgPT4ge1xuXHRcdGNvbnN0IHt3cmFwcGVyTGF5b3V0fSA9IHRoaXMuc3RhdGU7XG5cdFx0aWYgKHdyYXBwZXJMYXlvdXQud2lkdGggIT09IHdpZHRoIHx8IHdyYXBwZXJMYXlvdXQuaGVpZ2h0ICE9PSBoZWlnaHQpIHtcblx0XHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0XHR3cmFwcGVyTGF5b3V0OiB7d2lkdGgsIGhlaWdodH0sXG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3Iud3JhcHBlcldpZHRoID0gd2lkdGg7XG5cdFx0dGhpcy5hbmltYXRpb25Mb2dpYy51cGRhdGVXcmFwcGVyV2lkdGgod2lkdGgpO1xuXHR9O1xuXG5cdHJlbmRlcigpIHtcblx0XHRjb25zdCBzdHlsZSA9IHtcblx0XHRcdG9wYWNpdHk6IHRoaXMuc3RhdGUucmVhZHkgPyAxIDogMCxcblx0XHRcdGhlaWdodDogdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LmhlaWdodCxcblx0XHR9O1xuXHRcdHJldHVybiAoXG5cdFx0XHQ8UGFuR2VzdHVyZUhhbmRsZXJcblx0XHRcdFx0cmVmPXt0aGlzLnBhbkhhbmRsZXJSZWZ9XG5cdFx0XHRcdHNpbXVsdGFuZW91c0hhbmRsZXJzPXt0aGlzLnByb3BzLnNpbXVsdGFuZW91c0hhbmRsZXJzfVxuXHRcdFx0XHR3YWl0Rm9yPXt0aGlzLnByb3BzLndhaXRGb3J9XG5cdFx0XHRcdG9uR2VzdHVyZUV2ZW50PXt0aGlzLmFuaW1hdGlvbkxvZ2ljLmdlc3R1cmVIYW5kbGVyfVxuXHRcdFx0XHRvbkhhbmRsZXJTdGF0ZUNoYW5nZT17dGhpcy5hbmltYXRpb25Mb2dpYy5nZXN0dXJlSGFuZGxlcn0+XG5cdFx0XHRcdDxBbmltYXRlZC5WaWV3XG5cdFx0XHRcdFx0c3R5bGU9e1t0aGlzLnByb3BzLnN0eWxlLCBzdHlsZV19XG5cdFx0XHRcdFx0b25MYXlvdXQ9e3RoaXMub25XcmFwcGVyTGF5b3V0fT5cblx0XHRcdFx0XHQ8QW5pbWF0ZWQuVmlld1xuXHRcdFx0XHRcdFx0c3R5bGU9e3tcblx0XHRcdFx0XHRcdFx0dHJhbnNmb3JtOiBbXG5cdFx0XHRcdFx0XHRcdFx0e3RyYW5zbGF0ZVg6IHRoaXMuYW5pbWF0aW9uTG9naWMueH0sXG5cdFx0XHRcdFx0XHRcdFx0e3BlcnNwZWN0aXZlOiAxMDAwfSwgLy8gd2l0aG91dCB0aGlzIGxpbmUgdGhpcyBBbmltYXRpb24gd2lsbCBub3QgcmVuZGVyIG9uIEFuZHJvaWQgd2hpbGUgd29ya2luZyBmaW5lIG9uIGlPU1xuXHRcdFx0XHRcdFx0XHRdLFxuXHRcdFx0XHRcdFx0fX0+XG5cdFx0XHRcdFx0XHR7dGhpcy5pbmZpbml0ZUVsZW1lbnRzLm1hcCgoaXRlbSwgaSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gKFxuXHRcdFx0XHRcdFx0XHRcdDxJbmZpbml0ZUl0ZW08VD5cblx0XHRcdFx0XHRcdFx0XHRcdGVsZW1lbnRJbmRleD17aX1cblx0XHRcdFx0XHRcdFx0XHRcdHJlbmRlckl0ZW09e3RoaXMucHJvcHMucmVuZGVySXRlbX1cblx0XHRcdFx0XHRcdFx0XHRcdGl0ZW09e2l0ZW19XG5cdFx0XHRcdFx0XHRcdFx0XHRrZXk9e2l9XG5cdFx0XHRcdFx0XHRcdFx0XHRvbkxheW91dD17XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGkgPT09IDAgPyB0aGlzLm9uSXRlbUxheW91dCA6IG51bGxcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHQvPlxuXHRcdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0fSl9XG5cdFx0XHRcdFx0PC9BbmltYXRlZC5WaWV3PlxuXHRcdFx0XHQ8L0FuaW1hdGVkLlZpZXc+XG5cdFx0XHQ8L1Bhbkdlc3R1cmVIYW5kbGVyPlxuXHRcdCk7XG5cdH1cbn1cbiJdfQ==