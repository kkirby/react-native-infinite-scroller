function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

import React, { Component } from 'react';
import Animated from 'react-native-reanimated';
import { PanGestureHandler } from 'react-native-gesture-handler';
import InfiniteElement from './InfiniteElement';
import InfiniteCalculator from './InfiniteCalculator';
import InfiniteItem from './InfiniteItem';
import AnimationLogic from './AnimationLogic';
export default class InfiniteScroller extends Component {
  constructor(props) {
    super(props);

    _defineProperty(this, "infiniteCalculator", void 0);

    _defineProperty(this, "infiniteElements", []);

    _defineProperty(this, "animationLogic", void 0);

    _defineProperty(this, "currentElement", void 0);

    _defineProperty(this, "panHandlerRef", void 0);

    _defineProperty(this, "onItemLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        itemLayout
      } = this.state;

      if (itemLayout.width !== width || itemLayout.height !== height) {
        this.setState({
          itemLayout: {
            width,
            height
          }
        });
      }

      this.animationLogic.updateItemWidth(width);
      this.infiniteCalculator.infiniteElementWidth = width;
    });

    _defineProperty(this, "onWrapperLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        wrapperLayout
      } = this.state;

      if (wrapperLayout.width !== width || wrapperLayout.height !== height) {
        this.setState({
          wrapperLayout: {
            width,
            height
          }
        });
      }

      this.infiniteCalculator.wrapperWidth = width;
      this.animationLogic.updateWrapperWidth(width);
    });

    this.state = {
      itemLayout: {
        width: 0,
        height: 0
      },
      wrapperLayout: {
        width: 0,
        height: 0
      },
      ready: false
    };
    this.infiniteElements = [];

    for (let i = 0; i < (props.infiniteElementCount || 100); i++) {
      this.infiniteElements.push(new InfiniteElement());
    }

    this.infiniteCalculator = new InfiniteCalculator(_objectSpread({}, props, {
      infiniteLimit: Math.floor(2147483645 / 1000),
      infiniteElements: this.infiniteElements,
      cacheSize: this.infiniteElements.length * 2
    }));
    this.animationLogic = AnimationLogic();
    this.animationLogic.on('change', value => {
      this.infiniteCalculator.x = value;
    });
    this.animationLogic.on('scrollEnd', ({
      x
    }) => {
      if (this.props.onScrollEnd) {
        x *= -1;
        this.currentElement = this.infiniteElements.find(element => element.left === x);

        if (this.currentElement != null) {
          this.props.onScrollEnd(this.currentElement.phase, this.currentElement.data, this);
        } else {
          console.warn('InfiniteScroller is unable to determine the current item after the scroll ended.');
        }
      }
    });

    if (props.centerInWrapper != null) {
      this.animationLogic.updateCenterScroll(props.centerInWrapper);
    }

    this.panHandlerRef = React.createRef();
  }

  componentDidUpdate(_prevProps, prevState) {
    if (prevState.wrapperLayout.width !== this.state.wrapperLayout.width || prevState.itemLayout.width !== this.state.itemLayout.width) {
      this.infiniteCalculator.infiniteElementWidth = this.state.itemLayout.width;
      this.infiniteCalculator.wrapperWidth = this.state.wrapperLayout.width;
    }

    if (_prevProps.centerInWrapper !== this.props.centerInWrapper) {
      const centerInWrapper = this.props.centerInWrapper;
      this.animationLogic.updateCenterScroll(centerInWrapper != null ? centerInWrapper : false);
    }

    if (this.state.wrapperLayout.width !== 0 && this.state.itemLayout.width !== 0 && this.state.ready === false) {
      if (this.props.startingPosition != null) {
        this.scrollToIndex(this.props.startingPosition, false);
      } // eslint-disable-next-line react/no-did-update-set-state


      this.setState({
        ready: true
      });
    }

    if (this.state.itemLayout.width && this.props.totalItemCount != null) {
      this.animationLogic.updateMaxScroll(-1 * this.state.itemLayout.width * this.props.totalItemCount);
    }
  }

  componentWillUnmount() {
    this.infiniteCalculator.dispose();
  }

  calculateCurrentIndex(moveXValue) {
    const itemWidth = this.state.itemLayout.width;
    const wrapperWidth = this.state.wrapperLayout.width;
    const centerInWrapper = this.props.centerInWrapper != null ? this.props.centerInWrapper : false;
    const center = centerInWrapper ? wrapperWidth / 2 - itemWidth / 2 : 0;
    /**
     * The value will be slighly off because our snap end threshhold is a
     * bit high to ensure events are triggered in a timley manner.
     **/

    return Math.round((center - moveXValue) / itemWidth);
  }

  getCurrentIndex() {
    return this.calculateCurrentIndex(this.infiniteCalculator.x);
  }

  async goNext(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollToIndex(index + 1, withAnimation);
  }

  async goBack(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollToIndex(index - 1, withAnimation);
  }

  scrollToIndex(itemOffset, withAnimation = true) {
    this.animationLogic.scrollTo(-1 * itemOffset * this.state.itemLayout.width, withAnimation);
  }

  scrollToElement(element, withAnimation) {
    return this.scrollToIndex(element.phase, withAnimation);
  }

  findNearestInfiniteElement(comparator) {
    const x = -1 * this.infiniteCalculator.x;
    let elements = this.infiniteElements.sort((a, b) => {
      const aDelta = Math.abs(x - a.left);
      const bDelta = Math.abs(x - b.left);
      return aDelta - bDelta;
    });
    return elements.find(item => comparator(item));
  }

  scrollToItem(comparator, withAnimation) {
    const element = this.findNearestInfiniteElement(elm => elm.data != null ? comparator(elm.data) : false);

    if (element) {
      return this.scrollToElement(element, withAnimation);
    }
  }

  render() {
    const style = {
      opacity: this.state.ready ? 1 : 0,
      height: this.state.itemLayout.height
    };
    return <PanGestureHandler ref={this.panHandlerRef} simultaneousHandlers={this.props.simultaneousHandlers} waitFor={this.props.waitFor} onGestureEvent={this.animationLogic.gestureHandler} onHandlerStateChange={this.animationLogic.gestureHandler}>
				<Animated.View style={[this.props.style, style]} onLayout={this.onWrapperLayout}>
					<Animated.View style={{
          transform: [{
            translateX: this.animationLogic.x
          }, {
            perspective: 1000
          } // without this line this Animation will not render on Android while working fine on iOS
          ]
        }}>
						{this.infiniteElements.map((item, i) => {
            return <InfiniteItem elementIndex={i} renderItem={this.props.renderItem} item={item} key={i} onLayout={i === 0 ? this.onItemLayout : null} />;
          })}
					</Animated.View>
				</Animated.View>
			</PanGestureHandler>;
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9JbmZpbml0ZVNjcm9sbGVyLnRzeCJdLCJuYW1lcyI6WyJSZWFjdCIsIkNvbXBvbmVudCIsIkFuaW1hdGVkIiwiUGFuR2VzdHVyZUhhbmRsZXIiLCJJbmZpbml0ZUVsZW1lbnQiLCJJbmZpbml0ZUNhbGN1bGF0b3IiLCJJbmZpbml0ZUl0ZW0iLCJBbmltYXRpb25Mb2dpYyIsIkluZmluaXRlU2Nyb2xsZXIiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwibmF0aXZlRXZlbnQiLCJsYXlvdXQiLCJ3aWR0aCIsImhlaWdodCIsIml0ZW1MYXlvdXQiLCJzdGF0ZSIsInNldFN0YXRlIiwiYW5pbWF0aW9uTG9naWMiLCJ1cGRhdGVJdGVtV2lkdGgiLCJpbmZpbml0ZUNhbGN1bGF0b3IiLCJpbmZpbml0ZUVsZW1lbnRXaWR0aCIsIndyYXBwZXJMYXlvdXQiLCJ3cmFwcGVyV2lkdGgiLCJ1cGRhdGVXcmFwcGVyV2lkdGgiLCJyZWFkeSIsImluZmluaXRlRWxlbWVudHMiLCJpIiwiaW5maW5pdGVFbGVtZW50Q291bnQiLCJwdXNoIiwiaW5maW5pdGVMaW1pdCIsIk1hdGgiLCJmbG9vciIsImNhY2hlU2l6ZSIsImxlbmd0aCIsIm9uIiwidmFsdWUiLCJ4Iiwib25TY3JvbGxFbmQiLCJjdXJyZW50RWxlbWVudCIsImZpbmQiLCJlbGVtZW50IiwibGVmdCIsInBoYXNlIiwiZGF0YSIsImNvbnNvbGUiLCJ3YXJuIiwiY2VudGVySW5XcmFwcGVyIiwidXBkYXRlQ2VudGVyU2Nyb2xsIiwicGFuSGFuZGxlclJlZiIsImNyZWF0ZVJlZiIsImNvbXBvbmVudERpZFVwZGF0ZSIsIl9wcmV2UHJvcHMiLCJwcmV2U3RhdGUiLCJzdGFydGluZ1Bvc2l0aW9uIiwic2Nyb2xsVG9JbmRleCIsInRvdGFsSXRlbUNvdW50IiwidXBkYXRlTWF4U2Nyb2xsIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJkaXNwb3NlIiwiY2FsY3VsYXRlQ3VycmVudEluZGV4IiwibW92ZVhWYWx1ZSIsIml0ZW1XaWR0aCIsImNlbnRlciIsInJvdW5kIiwiZ2V0Q3VycmVudEluZGV4IiwiZ29OZXh0Iiwid2l0aEFuaW1hdGlvbiIsImluZGV4IiwiZ29CYWNrIiwiaXRlbU9mZnNldCIsInNjcm9sbFRvIiwic2Nyb2xsVG9FbGVtZW50IiwiZmluZE5lYXJlc3RJbmZpbml0ZUVsZW1lbnQiLCJjb21wYXJhdG9yIiwiZWxlbWVudHMiLCJzb3J0IiwiYSIsImIiLCJhRGVsdGEiLCJhYnMiLCJiRGVsdGEiLCJpdGVtIiwic2Nyb2xsVG9JdGVtIiwiZWxtIiwicmVuZGVyIiwic3R5bGUiLCJvcGFjaXR5Iiwic2ltdWx0YW5lb3VzSGFuZGxlcnMiLCJ3YWl0Rm9yIiwiZ2VzdHVyZUhhbmRsZXIiLCJvbldyYXBwZXJMYXlvdXQiLCJ0cmFuc2Zvcm0iLCJ0cmFuc2xhdGVYIiwicGVyc3BlY3RpdmUiLCJtYXAiLCJyZW5kZXJJdGVtIiwib25JdGVtTGF5b3V0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPQSxLQUFQLElBQWVDLFNBQWYsUUFBK0IsT0FBL0I7QUFHQSxPQUFPQyxRQUFQLE1BQXFCLHlCQUFyQjtBQUNBLFNBQVFDLGlCQUFSLFFBQWdDLDhCQUFoQztBQUNBLE9BQU9DLGVBQVAsTUFBNEIsbUJBQTVCO0FBQ0EsT0FBT0Msa0JBQVAsTUFBK0Isc0JBQS9CO0FBQ0EsT0FBT0MsWUFBUCxNQUF5QixnQkFBekI7QUFDQSxPQUFPQyxjQUFQLE1BQTJCLGtCQUEzQjtBQStCQSxlQUFlLE1BQU1DLGdCQUFOLFNBQWtDUCxTQUFsQyxDQUdiO0FBT0RRLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFrQztBQUM1QyxVQUFNQSxLQUFOOztBQUQ0Qzs7QUFBQSw4Q0FMSixFQUtJOztBQUFBOztBQUFBOztBQUFBOztBQUFBLDBDQXNLOUIsQ0FBQztBQUNmQyxNQUFBQSxXQUFXLEVBQUU7QUFDWkMsUUFBQUEsTUFBTSxFQUFFO0FBQUNDLFVBQUFBLEtBQUQ7QUFBUUMsVUFBQUE7QUFBUjtBQURJO0FBREUsS0FBRCxL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RDtBQWtDQTs7QUFsUEEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtDb21wb25lbnR9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7TGF5b3V0Q2hhbmdlRXZlbnQsIFN0eWxlUHJvcCwgVmlld1N0eWxlfSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuXG5pbXBvcnQgQW5pbWF0ZWQgZnJvbSAncmVhY3QtbmF0aXZlLXJlYW5pbWF0ZWQnO1xuaW1wb3J0IHtQYW5HZXN0dXJlSGFuZGxlcn0gZnJvbSAncmVhY3QtbmF0aXZlLWdlc3R1cmUtaGFuZGxlcic7XG5pbXBvcnQgSW5maW5pdGVFbGVtZW50IGZyb20gJy4vSW5maW5pdGVFbGVtZW50JztcbmltcG9ydCBJbmZpbml0ZUNhbGN1bGF0b3IgZnJvbSAnLi9JbmZpbml0ZUNhbGN1bGF0b3InO1xuaW1wb3J0IEluZmluaXRlSXRlbSBmcm9tICcuL0luZmluaXRlSXRlbSc7XG5pbXBvcnQgQW5pbWF0aW9uTG9naWMgZnJvbSAnLi9BbmltYXRpb25Mb2dpYyc7XG5cbmludGVyZmFjZSBJbmZpbml0ZVNjcm9sbGVyUHJvcHM8VD4ge1xuXHRkYXRhc2V0KHN0YXJ0OiBudW1iZXIsIGNvdW50OiBudW1iZXIpOiBQcm9taXNlPFRbXT47XG5cdHJlbmRlckl0ZW06IChkYXRhOiBUIHwgbnVsbCkgPT4gUmVhY3QuUmVhY3RFbGVtZW50O1xuXHRzdHlsZT86IFN0eWxlUHJvcDxWaWV3U3R5bGU+O1xuXHR0b3RhbEl0ZW1Db3VudD86IG51bWJlciB8IG51bGw7XG5cdGNlbnRlckluV3JhcHBlcj86IGJvb2xlYW4gfCBudWxsO1xuXHRzdGFydGluZ1Bvc2l0aW9uPzogbnVtYmVyIHwgbnVsbDtcblx0b25TY3JvbGxFbmQ/OiAoXG5cdFx0c2Nyb2xsUG9zaXRpb246IG51bWJlcixcblx0XHRkYXRhOiBUIHwgbnVsbCxcblx0XHRzY3JvbGxlcjogSW5maW5pdGVTY3JvbGxlcjxUPixcblx0KSA9PiB2b2lkIHwgbnVsbDtcblx0aW5maW5pdGVFbGVtZW50Q291bnQ/OiBudW1iZXIgfCBudWxsO1xuXHR3YWl0Rm9yPzogUmVhY3QuUmVmT2JqZWN0PGFueT5bXSxcblx0c2ltdWx0YW5lb3VzSGFuZGxlcnM/OiBSZWFjdC5SZWZPYmplY3Q8YW55PltdXG59XG5cbmludGVyZmFjZSBJbmZpbml0ZVNjcm9sbGVyU3RhdGUge1xuXHRpdGVtTGF5b3V0OiB7XG5cdFx0d2lkdGg6IG51bWJlcjtcblx0XHRoZWlnaHQ6IG51bWJlcjtcblx0fTtcblx0d3JhcHBlckxheW91dDoge1xuXHRcdHdpZHRoOiBudW1iZXI7XG5cdFx0aGVpZ2h0OiBudW1iZXI7XG5cdH07XG5cdHJlYWR5OiBib29sZWFuO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJbmZpbml0ZVNjcm9sbGVyPFQ+IGV4dGVuZHMgQ29tcG9uZW50PFxuXHRJbmZpbml0ZVNjcm9sbGVyUHJvcHM8VD4sXG5cdEluZmluaXRlU2Nyb2xsZXJTdGF0ZVxuPiB7XG5cdGluZmluaXRlQ2FsY3VsYXRvcjogSW5maW5pdGVDYWxjdWxhdG9yPFQ+O1xuXHRpbmZpbml0ZUVsZW1lbnRzOiBJbmZpbml0ZUVsZW1lbnQ8VD5bXSA9IFtdO1xuXHRhbmltYXRpb25Mb2dpYzogQW5pbWF0aW9uTG9naWM7XG5cdGN1cnJlbnRFbGVtZW50PzogSW5maW5pdGVFbGVtZW50PFQ+IHwgbnVsbDtcblx0cGFuSGFuZGxlclJlZjogUmVhY3QuUmVmT2JqZWN0PFBhbkdlc3R1cmVIYW5kbGVyPjtcblxuXHRjb25zdHJ1Y3Rvcihwcm9wczogSW5maW5pdGVTY3JvbGxlclByb3BzPFQ+KSB7XG5cdFx0c3VwZXIocHJvcHMpO1xuXHRcdHRoaXMuc3RhdGUgPSB7XG5cdFx0XHRpdGVtTGF5b3V0OiB7XG5cdFx0XHRcdHdpZHRoOiAwLFxuXHRcdFx0XHRoZWlnaHQ6IDAsXG5cdFx0XHR9LFxuXHRcdFx0d3JhcHBlckxheW91dDoge1xuXHRcdFx0XHR3aWR0aDogMCxcblx0XHRcdFx0aGVpZ2h0OiAwLFxuXHRcdFx0fSxcblx0XHRcdHJlYWR5OiBmYWxzZSxcblx0XHR9O1xuXHRcdHRoaXMuaW5maW5pdGVFbGVtZW50cyA9IFtdO1xuXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCAocHJvcHMuaW5maW5pdGVFbGVtZW50Q291bnQgfHwgMTAwKTsgaSsrKSB7XG5cdFx0XHR0aGlzLmluZmluaXRlRWxlbWVudHMucHVzaChuZXcgSW5maW5pdGVFbGVtZW50PFQ+KCkpO1xuXHRcdH1cblxuXHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yID0gbmV3IEluZmluaXRlQ2FsY3VsYXRvcih7XG5cdFx0XHQuLi5wcm9wcyxcblx0XHRcdGluZmluaXRlTGltaXQ6IE1hdGguZmxvb3IoMjE0NzQ4MzY0NSAvIDEwMDApLFxuXHRcdFx0aW5maW5pdGVFbGVtZW50czogdGhpcy5pbmZpbml0ZUVsZW1lbnRzLFxuXHRcdFx0Y2FjaGVTaXplOiB0aGlzLmluZmluaXRlRWxlbWVudHMubGVuZ3RoICogMixcblx0XHR9KTtcblxuXHRcdHRoaXMuYW5pbWF0aW9uTG9naWMgPSBBbmltYXRpb25Mb2dpYygpO1xuXHRcdHRoaXMuYW5pbWF0aW9uTG9naWMub24oJ2NoYW5nZScsIHZhbHVlID0+IHtcblx0XHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLnggPSB2YWx1ZTtcblx0XHR9KTtcblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLm9uKCdzY3JvbGxFbmQnLCAoe3h9KSA9PiB7XG5cdFx0XHRpZiAodGhpcy5wcm9wcy5vblNjcm9sbEVuZCkge1xuXHRcdFx0XHR4ICo9IC0xO1xuXHRcdFx0XHR0aGlzLmN1cnJlbnRFbGVtZW50ID0gdGhpcy5pbmZpbml0ZUVsZW1lbnRzLmZpbmQoXG5cdFx0XHRcdFx0ZWxlbWVudCA9PiBlbGVtZW50LmxlZnQgPT09IHgsXG5cdFx0XHRcdCk7XG5cdFx0XHRcdGlmICh0aGlzLmN1cnJlbnRFbGVtZW50ICE9IG51bGwpIHtcblx0XHRcdFx0XHR0aGlzLnByb3BzLm9uU2Nyb2xsRW5kKFxuXHRcdFx0XHRcdFx0dGhpcy5jdXJyZW50RWxlbWVudC5waGFzZSxcblx0XHRcdFx0XHRcdHRoaXMuY3VycmVudEVsZW1lbnQuZGF0YSxcblx0XHRcdFx0XHRcdHRoaXMsXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXG5cdFx0XHRcdFx0XHQnSW5maW5pdGVTY3JvbGxlciBpcyB1bmFibGUgdG8gZGV0ZXJtaW5lIHRoZSBjdXJyZW50IGl0ZW0gYWZ0ZXIgdGhlIHNjcm9sbCBlbmRlZC4nLFxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmIChwcm9wcy5jZW50ZXJJbldyYXBwZXIgIT0gbnVsbCkge1xuXHRcdFx0dGhpcy5hbmltYXRpb25Mb2dpYy51cGRhdGVDZW50ZXJTY3JvbGwocHJvcHMuY2VudGVySW5XcmFwcGVyKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5wYW5IYW5kbGVyUmVmID0gUmVhY3QuY3JlYXRlUmVmKCk7XG5cdH1cblxuXHRjb21wb25lbnREaWRVcGRhdGUoXG5cdFx0X3ByZXZQcm9wczogSW5maW5pdGVTY3JvbGxlclByb3BzPFQ+LFxuXHRcdHByZXZTdGF0ZTogSW5maW5pdGVTY3JvbGxlclN0YXRlLFxuXHQpIHtcblx0XHRpZiAoXG5cdFx0XHRwcmV2U3RhdGUud3JhcHBlckxheW91dC53aWR0aCAhPT0gdGhpcy5zdGF0ZS53cmFwcGVyTGF5b3V0LndpZHRoIHx8XG5cdFx0XHRwcmV2U3RhdGUuaXRlbUxheW91dC53aWR0aCAhPT0gdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoXG5cdFx0KSB7XG5cdFx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvci5pbmZpbml0ZUVsZW1lbnRXaWR0aCA9IHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aDtcblx0XHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLndyYXBwZXJXaWR0aCA9IHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aDtcblx0XHR9XG5cblx0XHRpZiAoX3ByZXZQcm9wcy5jZW50ZXJJbldyYXBwZXIgIT09IHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyKSB7XG5cdFx0XHRjb25zdCBjZW50ZXJJbldyYXBwZXIgPSB0aGlzLnByb3BzLmNlbnRlckluV3JhcHBlcjtcblx0XHRcdHRoaXMuYW5pbWF0aW9uTG9naWMudXBkYXRlQ2VudGVyU2Nyb2xsKFxuXHRcdFx0XHRjZW50ZXJJbldyYXBwZXIgIT0gbnVsbCA/IGNlbnRlckluV3JhcHBlciA6IGZhbHNlLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAoXG5cdFx0XHR0aGlzLnN0YXRlLndyYXBwZXJMYXlvdXQud2lkdGggIT09IDAgJiZcblx0XHRcdHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aCAhPT0gMCAmJlxuXHRcdFx0dGhpcy5zdGF0ZS5yZWFkeSA9PT0gZmFsc2Vcblx0XHQpIHtcblx0XHRcdGlmICh0aGlzLnByb3BzLnN0YXJ0aW5nUG9zaXRpb24gIT0gbnVsbCkge1xuXHRcdFx0XHR0aGlzLnNjcm9sbFRvSW5kZXgodGhpcy5wcm9wcy5zdGFydGluZ1Bvc2l0aW9uLCBmYWxzZSk7XG5cdFx0XHR9XG5cdFx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvbm8tZGlkLXVwZGF0ZS1zZXQtc3RhdGVcblx0XHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0XHRyZWFkeTogdHJ1ZSxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGggJiYgdGhpcy5wcm9wcy50b3RhbEl0ZW1Db3VudCAhPSBudWxsKSB7XG5cdFx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnVwZGF0ZU1heFNjcm9sbChcblx0XHRcdFx0LTEgKiB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGggKiB0aGlzLnByb3BzLnRvdGFsSXRlbUNvdW50LFxuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcblx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvci5kaXNwb3NlKCk7XG5cdH1cblxuXHRjYWxjdWxhdGVDdXJyZW50SW5kZXgobW92ZVhWYWx1ZTogbnVtYmVyKSB7XG5cdFx0Y29uc3QgaXRlbVdpZHRoID0gdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoO1xuXHRcdGNvbnN0IHdyYXBwZXJXaWR0aCA9IHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aDtcblx0XHRjb25zdCBjZW50ZXJJbldyYXBwZXIgPVxuXHRcdFx0dGhpcy5wcm9wcy5jZW50ZXJJbldyYXBwZXIgIT0gbnVsbFxuXHRcdFx0XHQ/IHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyXG5cdFx0XHRcdDogZmFsc2U7XG5cdFx0Y29uc3QgY2VudGVyID0gY2VudGVySW5XcmFwcGVyID8gd3JhcHBlcldpZHRoIC8gMiAtIGl0ZW1XaWR0aCAvIDIgOiAwO1xuXHRcdC8qKlxuXHRcdCAqIFRoZSB2YWx1ZSB3aWxsIGJlIHNsaWdobHkgb2ZmIGJlY2F1c2Ugb3VyIHNuYXAgZW5kIHRocmVzaGhvbGQgaXMgYVxuXHRcdCAqIGJpdCBoaWdoIHRvIGVuc3VyZSBldmVudHMgYXJlIHRyaWdnZXJlZCBpbiBhIHRpbWxleSBtYW5uZXIuXG5cdFx0ICoqL1xuXHRcdHJldHVybiBNYXRoLnJvdW5kKChjZW50ZXIgLSBtb3ZlWFZhbHVlKSAvIGl0ZW1XaWR0aCk7XG5cdH1cblxuXHRnZXRDdXJyZW50SW5kZXgoKSB7XG5cdFx0cmV0dXJuIHRoaXMuY2FsY3VsYXRlQ3VycmVudEluZGV4KHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLngpO1xuXHR9XG5cblx0YXN5bmMgZ29OZXh0KHdpdGhBbmltYXRpb246IGJvb2xlYW4gPSB0cnVlKSB7XG5cdFx0Y29uc3QgaW5kZXggPSB0aGlzLmdldEN1cnJlbnRJbmRleCgpO1xuXHRcdHJldHVybiB0aGlzLnNjcm9sbFRvSW5kZXgoaW5kZXggKyAxLCB3aXRoQW5pbWF0aW9uKTtcblx0fVxuXG5cdGFzeW5jIGdvQmFjayh3aXRoQW5pbWF0aW9uOiBib29sZWFuID0gdHJ1ZSkge1xuXHRcdGNvbnN0IGluZGV4ID0gdGhpcy5nZXRDdXJyZW50SW5kZXgoKTtcblx0XHRyZXR1cm4gdGhpcy5zY3JvbGxUb0luZGV4KGluZGV4IC0gMSwgd2l0aEFuaW1hdGlvbik7XG5cdH1cblxuXHRzY3JvbGxUb0luZGV4KGl0ZW1PZmZzZXQ6IG51bWJlciwgd2l0aEFuaW1hdGlvbjogYm9vbGVhbiA9IHRydWUpIHtcblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnNjcm9sbFRvKFxuXHRcdFx0LTEgKiBpdGVtT2Zmc2V0ICogdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoLFxuXHRcdFx0d2l0aEFuaW1hdGlvbixcblx0XHQpO1xuXHR9XG5cblx0c2Nyb2xsVG9FbGVtZW50KGVsZW1lbnQ6IEluZmluaXRlRWxlbWVudDxUPiwgd2l0aEFuaW1hdGlvbj86IGJvb2xlYW4pIHtcblx0XHRyZXR1cm4gdGhpcy5zY3JvbGxUb0luZGV4KGVsZW1lbnQucGhhc2UsIHdpdGhBbmltYXRpb24pO1xuXHR9XG5cblx0ZmluZE5lYXJlc3RJbmZpbml0ZUVsZW1lbnQoXG5cdFx0Y29tcGFyYXRvcjogKGl0ZW06IEluZmluaXRlRWxlbWVudDxUPikgPT4gYm9vbGVhbixcblx0KTogSW5maW5pdGVFbGVtZW50PFQ+IHwgdW5kZWZpbmVkIHtcblx0XHRjb25zdCB4ID0gLTEgKiB0aGlzLmluZmluaXRlQ2FsY3VsYXRvci54O1xuXHRcdGxldCBlbGVtZW50cyA9IHRoaXMuaW5maW5pdGVFbGVtZW50cy5zb3J0KChhLCBiKSA9PiB7XG5cdFx0XHRjb25zdCBhRGVsdGEgPSBNYXRoLmFicyh4IC0gYS5sZWZ0KTtcblx0XHRcdGNvbnN0IGJEZWx0YSA9IE1hdGguYWJzKHggLSBiLmxlZnQpO1xuXHRcdFx0cmV0dXJuIGFEZWx0YSAtIGJEZWx0YTtcblx0XHR9KTtcblx0XHRyZXR1cm4gZWxlbWVudHMuZmluZChpdGVtID0+IGNvbXBhcmF0b3IoaXRlbSkpO1xuXHR9XG5cblx0c2Nyb2xsVG9JdGVtKFxuXHRcdGNvbXBhcmF0b3I6IChpdGVtOiBUIHwgbnVsbCkgPT4gYm9vbGVhbixcblx0XHR3aXRoQW5pbWF0aW9uPzogYm9vbGVhbixcblx0KSB7XG5cdFx0Y29uc3QgZWxlbWVudCA9IHRoaXMuZmluZE5lYXJlc3RJbmZpbml0ZUVsZW1lbnQoZWxtID0+XG5cdFx0XHRlbG0uZGF0YSAhPSBudWxsID8gY29tcGFyYXRvcihlbG0uZGF0YSkgOiBmYWxzZSxcblx0XHQpO1xuXG5cdFx0aWYgKGVsZW1lbnQpIHtcblx0XHRcdHJldHVybiB0aGlzLnNjcm9sbFRvRWxlbWVudChlbGVtZW50LCB3aXRoQW5pbWF0aW9uKTtcblx0XHR9XG5cdH1cblxuXHRvbkl0ZW1MYXlvdXQgPSAoe1xuXHRcdG5hdGl2ZUV2ZW50OiB7XG5cdFx0XHRsYXlvdXQ6IHt3aWR0aCwgaGVpZ2h0fSxcblx0XHR9LFxuXHR9OiBMYXlvdXRDaGFuZ2VFdmVudCkgPT4ge1xuXHRcdGNvbnN0IHtpdGVtTGF5b3V0fSA9IHRoaXMuc3RhdGU7XG5cdFx0aWYgKGl0ZW1MYXlvdXQud2lkdGggIT09IHdpZHRoIHx8IGl0ZW1MYXlvdXQuaGVpZ2h0ICE9PSBoZWlnaHQpIHtcblx0XHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0XHRpdGVtTGF5b3V0OiB7d2lkdGgsIGhlaWdodH0sXG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0dGhpcy5hbmltYXRpb25Mb2dpYy51cGRhdGVJdGVtV2lkdGgod2lkdGgpO1xuXHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLmluZmluaXRlRWxlbWVudFdpZHRoID0gd2lkdGg7XG5cdH07XG5cblx0b25XcmFwcGVyTGF5b3V0ID0gKHtcblx0XHRuYXRpdmVFdmVudDoge1xuXHRcdFx0bGF5b3V0OiB7d2lkdGgsIGhlaWdodH0sXG5cdFx0fSxcblx0fTogTGF5b3V0Q2hhbmdlRXZlbnQpID0+IHtcblx0XHRjb25zdCB7d3JhcHBlckxheW91dH0gPSB0aGlzLnN0YXRlO1xuXHRcdGlmICh3cmFwcGVyTGF5b3V0LndpZHRoICE9PSB3aWR0aCB8fCB3cmFwcGVyTGF5b3V0LmhlaWdodCAhPT0gaGVpZ2h0KSB7XG5cdFx0XHR0aGlzLnNldFN0YXRlKHtcblx0XHRcdFx0d3JhcHBlckxheW91dDoge3dpZHRoLCBoZWlnaHR9LFxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLndyYXBwZXJXaWR0aCA9IHdpZHRoO1xuXHRcdHRoaXMuYW5pbWF0aW9uTG9naWMudXBkYXRlV3JhcHBlcldpZHRoKHdpZHRoKTtcblx0fTtcblxuXHRyZW5kZXIoKSB7XG5cdFx0Y29uc3Qgc3R5bGUgPSB7XG5cdFx0XHRvcGFjaXR5OiB0aGlzLnN0YXRlLnJlYWR5ID8gMSA6IDAsXG5cdFx0XHRoZWlnaHQ6IHRoaXMuc3RhdGUuaXRlbUxheW91dC5oZWlnaHQsXG5cdFx0fTtcblx0XHRyZXR1cm4gKFxuXHRcdFx0PFBhbkdlc3R1cmVIYW5kbGVyXG5cdFx0XHRcdHJlZj17dGhpcy5wYW5IYW5kbGVyUmVmfVxuXHRcdFx0XHRzaW11bHRhbmVvdXNIYW5kbGVycz17dGhpcy5wcm9wcy5zaW11bHRhbmVvdXNIYW5kbGVyc31cblx0XHRcdFx0d2FpdEZvcj17dGhpcy5wcm9wcy53YWl0Rm9yfVxuXHRcdFx0XHRvbkdlc3R1cmVFdmVudD17dGhpcy5hbmltYXRpb25Mb2dpYy5nZXN0dXJlSGFuZGxlcn1cblx0XHRcdFx0b25IYW5kbGVyU3RhdGVDaGFuZ2U9e3RoaXMuYW5pbWF0aW9uTG9naWMuZ2VzdHVyZUhhbmRsZXJ9PlxuXHRcdFx0XHQ8QW5pbWF0ZWQuVmlld1xuXHRcdFx0XHRcdHN0eWxlPXtbdGhpcy5wcm9wcy5zdHlsZSwgc3R5bGVdfVxuXHRcdFx0XHRcdG9uTGF5b3V0PXt0aGlzLm9uV3JhcHBlckxheW91dH0+XG5cdFx0XHRcdFx0PEFuaW1hdGVkLlZpZXdcblx0XHRcdFx0XHRcdHN0eWxlPXt7XG5cdFx0XHRcdFx0XHRcdHRyYW5zZm9ybTogW1xuXHRcdFx0XHRcdFx0XHRcdHt0cmFuc2xhdGVYOiB0aGlzLmFuaW1hdGlvbkxvZ2ljLnh9LFxuXHRcdFx0XHRcdFx0XHRcdHtwZXJzcGVjdGl2ZTogMTAwMH0sIC8vIHdpdGhvdXQgdGhpcyBsaW5lIHRoaXMgQW5pbWF0aW9uIHdpbGwgbm90IHJlbmRlciBvbiBBbmRyb2lkIHdoaWxlIHdvcmtpbmcgZmluZSBvbiBpT1Ncblx0XHRcdFx0XHRcdFx0XSxcblx0XHRcdFx0XHRcdH19PlxuXHRcdFx0XHRcdFx0e3RoaXMuaW5maW5pdGVFbGVtZW50cy5tYXAoKGl0ZW0sIGkpID0+IHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIChcblx0XHRcdFx0XHRcdFx0XHQ8SW5maW5pdGVJdGVtPFQ+XG5cdFx0XHRcdFx0XHRcdFx0XHRlbGVtZW50SW5kZXg9e2l9XG5cdFx0XHRcdFx0XHRcdFx0XHRyZW5kZXJJdGVtPXt0aGlzLnByb3BzLnJlbmRlckl0ZW19XG5cdFx0XHRcdFx0XHRcdFx0XHRpdGVtPXtpdGVtfVxuXHRcdFx0XHRcdFx0XHRcdFx0a2V5PXtpfVxuXHRcdFx0XHRcdFx0XHRcdFx0b25MYXlvdXQ9e1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRpID09PSAwID8gdGhpcy5vbkl0ZW1MYXlvdXQgOiBudWxsXG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0Lz5cblx0XHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRcdH0pfVxuXHRcdFx0XHRcdDwvQW5pbWF0ZWQuVmlldz5cblx0XHRcdFx0PC9BbmltYXRlZC5WaWV3PlxuXHRcdFx0PC9QYW5HZXN0dXJlSGFuZGxlcj5cblx0XHQpO1xuXHR9XG59XG4iXX0=