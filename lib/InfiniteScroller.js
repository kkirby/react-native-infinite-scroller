function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

import React, { Component } from 'react';
import Animated from 'react-native-reanimated';
import { PanGestureHandler } from 'react-native-gesture-handler';
import InfiniteElement from './InfiniteElement';
import InfiniteCalculator from './InfiniteCalculator';
import InfiniteItem from './InfiniteItem';
import AnimationLogic from './AnimationLogic';
export default class InfiniteScroller extends Component {
  constructor(props) {
    super(props);

    _defineProperty(this, "infiniteCalculator", void 0);

    _defineProperty(this, "infiniteElements", []);

    _defineProperty(this, "animationLogic", void 0);

    _defineProperty(this, "onItemLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        itemLayout
      } = this.state;

      if (itemLayout.width !== width || itemLayout.height !== height) {
        this.setState({
          itemLayout: {
            width,
            height
          }
        });
      }

      this.animationLogic.updateItemWidth(width);
      this.infiniteCalculator.infiniteElementWidth = width;
    });

    _defineProperty(this, "onWrapperLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        wrapperLayout
      } = this.state;

      if (wrapperLayout.width !== width || wrapperLayout.height !== height) {
        this.setState({
          wrapperLayout: {
            width,
            height
          }
        });
      }

      this.infiniteCalculator.wrapperWidth = width;
      this.animationLogic.updateWrapperWidth(width);
    });

    this.state = {
      itemLayout: {
        width: 0,
        height: 0
      },
      wrapperLayout: {
        width: 0,
        height: 0
      },
      ready: false
    };
    this.infiniteElements = [];

    for (let i = 0; i < (props.infiniteElementCount || 100); i++) {
      this.infiniteElements.push(new InfiniteElement());
    }

    this.infiniteCalculator = new InfiniteCalculator(_objectSpread({}, props, {
      infiniteLimit: Math.floor(2147483645 / 1000),
      infiniteElements: this.infiniteElements,
      cacheSize: this.infiniteElements.length * 2
    }));
    this.animationLogic = AnimationLogic();
    this.animationLogic.on('change', value => {
      this.infiniteCalculator.x = value;
    });
    this.animationLogic.on('scrollEnd', value => {
      if (this.props.onScrollEnd) {
        this.props.onScrollEnd(this.calculateCurrentIndex(value), this);
      }
    });

    if (props.centerInWrapper != null) {
      this.animationLogic.updateCenterScroll(props.centerInWrapper);
    }
  }

  componentDidUpdate(_prevProps, prevState) {
    if (prevState.wrapperLayout.width !== this.state.wrapperLayout.width || prevState.itemLayout.width !== this.state.itemLayout.width) {
      this.infiniteCalculator.infiniteElementWidth = this.state.itemLayout.width;
      this.infiniteCalculator.wrapperWidth = this.state.wrapperLayout.width;
    }

    if (_prevProps.centerInWrapper !== this.props.centerInWrapper) {
      const centerInWrapper = this.props.centerInWrapper;
      this.animationLogic.updateCenterScroll(centerInWrapper != null ? centerInWrapper : false);
    }

    if (this.state.wrapperLayout.width !== 0 && this.state.itemLayout.width !== 0 && this.state.ready === false) {
      if (this.props.startingPosition != null) {
        this.scrollTo(this.props.startingPosition, false);
      } // eslint-disable-next-line react/no-did-update-set-state


      this.setState({
        ready: true
      });
    }

    if (this.state.itemLayout.width && this.props.totalItemCount != null) {
      this.animationLogic.updateMaxScroll(-1 * this.state.itemLayout.width * this.props.totalItemCount);
    }
  }

  calculateCurrentIndex(moveXValue) {
    const itemWidth = this.state.itemLayout.width;
    const wrapperWidth = this.state.wrapperLayout.width;
    const centerInWrapper = this.props.centerInWrapper != null ? this.props.centerInWrapper : false;
    const center = centerInWrapper ? wrapperWidth / 2 - itemWidth / 2 : 0;
    /**
     * The value will be slighly off because our snap end threshhold is a
     * bit high to ensure events are triggered in a timley manner.
     **/

    return Math.round((center - moveXValue) / itemWidth);
  }

  getCurrentIndex() {
    return this.calculateCurrentIndex(this.infiniteCalculator.x);
  }

  async goNext(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollTo(index + 1, withAnimation);
  }

  async goBack(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollTo(index - 1, withAnimation);
  }

  async scrollTo(itemOffset, withAnimation = true) {
    this.animationLogic.scrollTo(-1 * itemOffset * this.state.itemLayout.width, withAnimation);
  }

  render() {
    const style = {
      opacity: this.state.ready ? 1 : 0,
      height: this.state.itemLayout.height
    };
    return <PanGestureHandler onGestureEvent={this.animationLogic.gestureHandler} onHandlerStateChange={this.animationLogic.gestureHandler}>
				<Animated.View style={[this.props.style, style]} onLayout={this.onWrapperLayout}>
					<Animated.View style={{
          transform: [{
            translateX: this.animationLogic.x
          }, {
            perspective: 1000
          } // without this line this Animation will not render on Android while working fine on iOS
          ]
        }}>
						{this.infiniteElements.map((item, i) => {
            return <InfiniteItem renderItem={this.props.renderItem} item={item} key={i} onLayout={this.onItemLayout} />;
          })}
					</Animated.View>
				</Animated.View>
			</PanGestureHandler>;
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9JbmZpbml0ZVNjcm9sbGVyLnRzeCJdLCJuYW1lcyI6WyJSZWFjdCIsIkNvbXBvbmVudCIsIkFuaW1hdGVkIiwiUGFuR2VzdHVyZUhhbmRsZXIiLCJJbmZpbml0ZUVsZW1lbnQiLCJJbmZpbml0ZUNhbGN1bGF0b3IiLCJJbmZpbml0ZUl0ZW0iLCJBbmltYXRpb25Mb2dpYyIsIkluZmluaXRlU2Nyb2xsZXIiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwibmF0aXZlRXZlbnQiLCJsYXlvdXQiLCJ3aWR0aCIsImhlaWdodCIsIml0ZW1MYXlvdXQiLCJzdGF0ZSIsInNldFN0YXRlIiwiYW5pbWF0aW9uTG9naWMiLCJ1cGRhdGVJdGVtV2lkdGgiLCJpbmZpbml0ZUNhbGN1bGF0b3IiLCJpbmZpbml0ZUVsZW1lbnRXaWR0aCIsIndyYXBwZXJMYXlvdXQiLCJ3cmFwcGVyV2lkdGgiLCJ1cGRhdGVXcmFwcGVyV2lkdGgiLCJyZWFkeSIsImluZmluaXRlRWxlbWVudHMiLCJpIiwiaW5maW5pdGVFbGVtZW50Q291bnQiLCJwdXNoIiwiaW5maW5pdGVMaW1pdCIsIk1hdGgiLCJmbG9vciIsImNhY2hlU2l6ZSIsImxlbmd0aCIsIm9uIiwidmFsdWUiLCJ4Iiwib25TY3JvbGxFbmQiLCJjYWxjdWxhdGVDdXJyZW50SW5kZXgiLCJjZW50ZXJJbldyYXBwZXIiLCJ1cGRhdGVDZW50ZXJTY3JvbGwiLCJjb21wb25lbnREaWRVcGRhdGUiLCJfcHJldlByb3BzIiwicHJldlN0YXRlIiwic3RhcnRpbmdQb3NpdGlvbiIsInNjcm9sbFRvIiwidG90YWxJdGVtQ291bnQiLCJ1cGRhdGVNYXhTY3JvbGwiLCJtb3ZlWFZhbHVlIiwiaXRlbVdpZHRoIiwiY2VudGVyIiwicm91bmQiLCJnZXRDdXJyZW50SW5kZXgiLCJnb05leHQiLCJ3aXRoQW5pbWF0aW9uIiwiaW5kZXgiLCJnb0JhY2siLCJpdGVtT2Zmc2V0IiwicmVuZGVyIiwic3R5bGUiLCJvcGFjaXR5IiwiZ2VzdHVyZUhhbmRsZXIiLCJvbldyYXBwZXJMYXlvdXQiLCJ0cmFuc2Zvcm0iLCJ0cmFuc2xhdGVYIiwicGVyc3BlY3RpdmUiLCJtYXAiLCJpdGVtIiwicmVuZGVySXRlbSIsIm9uSXRlbUxheW91dCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBT0EsS0FBUCxJQUFlQyxTQUFmLFFBQStCLE9BQS9CO0FBR0EsT0FBT0MsUUFBUCxNQUFxQix5QkFBckI7QUFDQSxTQUFRQyxpQkFBUixRQUFnQyw4QkFBaEM7QUFDQSxPQUFPQyxlQUFQLE1BQTRCLG1CQUE1QjtBQUNBLE9BQU9DLGtCQUFQLE1BQStCLHNCQUEvQjtBQUNBLE9BQU9DLFlBQVAsTUFBeUIsZ0JBQXpCO0FBQ0EsT0FBT0MsY0FBUCxNQUEyQixrQkFBM0I7QUE0QkEsZUFBZSxNQUFNQyxnQkFBTixTQUFrQ1AsU0FBbEMsQ0FHYjtBQUtEUSxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBa0M7QUFDNUMsVUFBTUEsS0FBTjs7QUFENEM7O0FBQUEsOENBSEosRUFHSTs7QUFBQTs7QUFBQSwwQ0FxSDlCLENBQUM7QUFDZkMsTUFBQUEsV0FBVyxFQUFFO0FBQ1pDLFFBQUFBLE1BQU0sRUFBRTtBQUFDQyxVQUFBQSxLQUFEO0FBQVFDLFVBQUFBO0FBQVI7QUFESTtBQURFLEtBQUQsS0FJVTtBQUN4QixZQUFNO0FBQUNDLFFBQUFBO0FBQUQsVUFBZSxLQUFLQyxLQUExQjs7QUFDQSxVQUFJRCxVQUFVLENBQUNGLEtBQVgsS0FBcUJBLEtBQXJCLElBQThCRSxVQUFVLENBQUNELE1BQVgsS0FBc0JBLE1BQXhELEVBQWdFO0FBQy9ELGFBQUtHLFFBQUwsQ0FBYztBQUNiRixVQUFBQSxVQUFVLEVBQUU7QUFBQ0YsWUFBQUEsS0FBRDtBQUFRQyxZQUFBQTtBQUFSO0FBREMsU0FBZDtBQUdBOztBQUNELFdBQUtJLGNBQUwsQ0FBb0JDLGVBQXBCLENBQW9DTixLQUFwQztBQUNBLFdBQUtPLGtCQUFMLENBQXdCQyxvQkFBeEIsR0FBK0NSLEtBQS9DO0FBQ0EsS0FsSTRDOztB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RUFBRSxTQUFTLElBQVg7R0FDRCxFQUFFLGlCQUFGLENBMUJEO0FBNEJBOztBQXpMQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwge0NvbXBvbmVudH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtMYXlvdXRDaGFuZ2VFdmVudCwgU3R5bGVQcm9wLCBWaWV3U3R5bGV9IGZyb20gJ3JlYWN0LW5hdGl2ZSc7XG5cbmltcG9ydCBBbmltYXRlZCBmcm9tICdyZWFjdC1uYXRpdmUtcmVhbmltYXRlZCc7XG5pbXBvcnQge1Bhbkdlc3R1cmVIYW5kbGVyfSBmcm9tICdyZWFjdC1uYXRpdmUtZ2VzdHVyZS1oYW5kbGVyJztcbmltcG9ydCBJbmZpbml0ZUVsZW1lbnQgZnJvbSAnLi9JbmZpbml0ZUVsZW1lbnQnO1xuaW1wb3J0IEluZmluaXRlQ2FsY3VsYXRvciBmcm9tICcuL0luZmluaXRlQ2FsY3VsYXRvcic7XG5pbXBvcnQgSW5maW5pdGVJdGVtIGZyb20gJy4vSW5maW5pdGVJdGVtJztcbmltcG9ydCBBbmltYXRpb25Mb2dpYyBmcm9tICcuL0FuaW1hdGlvbkxvZ2ljJztcblxuaW50ZXJmYWNlIEluZmluaXRlU2Nyb2xsZXJQcm9wczxUPiB7XG5cdGRhdGFzZXQoc3RhcnQ6IG51bWJlciwgY291bnQ6IG51bWJlcik6IFByb21pc2U8VFtdPjtcblx0cmVuZGVySXRlbTogKGRhdGE6IFQgfCBudWxsKSA9PiBSZWFjdC5SZWFjdEVsZW1lbnQ7XG5cdHN0eWxlPzogU3R5bGVQcm9wPFZpZXdTdHlsZT47XG5cdHRvdGFsSXRlbUNvdW50PzogbnVtYmVyIHwgbnVsbDtcblx0Y2VudGVySW5XcmFwcGVyPzogYm9vbGVhbiB8IG51bGw7XG5cdHN0YXJ0aW5nUG9zaXRpb24/OiBudW1iZXIgfCBudWxsO1xuXHRvblNjcm9sbEVuZD86IChcblx0XHRzY3JvbGxQb3NpdGlvbjogbnVtYmVyLFxuXHRcdHNjcm9sbGVyOiBJbmZpbml0ZVNjcm9sbGVyPFQ+LFxuXHQpID0+IHZvaWQgfCBudWxsO1xuXHRpbmZpbml0ZUVsZW1lbnRDb3VudD86IG51bWJlciB8IG51bGw7XG59XG5cbmludGVyZmFjZSBJbmZpbml0ZVNjcm9sbGVyU3RhdGUge1xuXHRpdGVtTGF5b3V0OiB7XG5cdFx0d2lkdGg6IG51bWJlcjtcblx0XHRoZWlnaHQ6IG51bWJlcjtcblx0fTtcblx0d3JhcHBlckxheW91dDoge1xuXHRcdHdpZHRoOiBudW1iZXI7XG5cdFx0aGVpZ2h0OiBudW1iZXI7XG5cdH07XG5cdHJlYWR5OiBib29sZWFuO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJbmZpbml0ZVNjcm9sbGVyPFQ+IGV4dGVuZHMgQ29tcG9uZW50PFxuXHRJbmZpbml0ZVNjcm9sbGVyUHJvcHM8VD4sXG5cdEluZmluaXRlU2Nyb2xsZXJTdGF0ZVxuPiB7XG5cdGluZmluaXRlQ2FsY3VsYXRvcjogSW5maW5pdGVDYWxjdWxhdG9yPFQ+O1xuXHRpbmZpbml0ZUVsZW1lbnRzOiBJbmZpbml0ZUVsZW1lbnQ8VD5bXSA9IFtdO1xuXHRhbmltYXRpb25Mb2dpYzogQW5pbWF0aW9uTG9naWM7XG5cblx0Y29uc3RydWN0b3IocHJvcHM6IEluZmluaXRlU2Nyb2xsZXJQcm9wczxUPikge1xuXHRcdHN1cGVyKHByb3BzKTtcblx0XHR0aGlzLnN0YXRlID0ge1xuXHRcdFx0aXRlbUxheW91dDoge1xuXHRcdFx0XHR3aWR0aDogMCxcblx0XHRcdFx0aGVpZ2h0OiAwLFxuXHRcdFx0fSxcblx0XHRcdHdyYXBwZXJMYXlvdXQ6IHtcblx0XHRcdFx0d2lkdGg6IDAsXG5cdFx0XHRcdGhlaWdodDogMCxcblx0XHRcdH0sXG5cdFx0XHRyZWFkeTogZmFsc2UsXG5cdFx0fTtcblx0XHR0aGlzLmluZmluaXRlRWxlbWVudHMgPSBbXTtcblxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgKHByb3BzLmluZmluaXRlRWxlbWVudENvdW50IHx8IDEwMCk7IGkrKykge1xuXHRcdFx0dGhpcy5pbmZpbml0ZUVsZW1lbnRzLnB1c2gobmV3IEluZmluaXRlRWxlbWVudDxUPigpKTtcblx0XHR9XG5cblx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvciA9IG5ldyBJbmZpbml0ZUNhbGN1bGF0b3Ioe1xuXHRcdFx0Li4ucHJvcHMsXG5cdFx0XHRpbmZpbml0ZUxpbWl0OiBNYXRoLmZsb29yKDIxNDc0ODM2NDUgLyAxMDAwKSxcblx0XHRcdGluZmluaXRlRWxlbWVudHM6IHRoaXMuaW5maW5pdGVFbGVtZW50cyxcblx0XHRcdGNhY2hlU2l6ZTogdGhpcy5pbmZpbml0ZUVsZW1lbnRzLmxlbmd0aCAqIDIsXG5cdFx0fSk7XG5cblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljID0gQW5pbWF0aW9uTG9naWMoKTtcblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLm9uKCdjaGFuZ2UnLCB2YWx1ZSA9PiB7XG5cdFx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvci54ID0gdmFsdWU7XG5cdFx0fSk7XG5cdFx0dGhpcy5hbmltYXRpb25Mb2dpYy5vbignc2Nyb2xsRW5kJywgdmFsdWUgPT4ge1xuXHRcdFx0aWYgKHRoaXMucHJvcHMub25TY3JvbGxFbmQpIHtcblx0XHRcdFx0dGhpcy5wcm9wcy5vblNjcm9sbEVuZCh0aGlzLmNhbGN1bGF0ZUN1cnJlbnRJbmRleCh2YWx1ZSksIHRoaXMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0aWYgKHByb3BzLmNlbnRlckluV3JhcHBlciAhPSBudWxsKSB7XG5cdFx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnVwZGF0ZUNlbnRlclNjcm9sbChwcm9wcy5jZW50ZXJJbldyYXBwZXIpO1xuXHRcdH1cblx0fVxuXG5cdGNvbXBvbmVudERpZFVwZGF0ZShcblx0XHRfcHJldlByb3BzOiBJbmZpbml0ZVNjcm9sbGVyUHJvcHM8VD4sXG5cdFx0cHJldlN0YXRlOiBJbmZpbml0ZVNjcm9sbGVyU3RhdGUsXG5cdCkge1xuXHRcdGlmIChcblx0XHRcdHByZXZTdGF0ZS53cmFwcGVyTGF5b3V0LndpZHRoICE9PSB0aGlzLnN0YXRlLndyYXBwZXJMYXlvdXQud2lkdGggfHxcblx0XHRcdHByZXZTdGF0ZS5pdGVtTGF5b3V0LndpZHRoICE9PSB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGhcblx0XHQpIHtcblx0XHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLmluZmluaXRlRWxlbWVudFdpZHRoID0gdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoO1xuXHRcdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3Iud3JhcHBlcldpZHRoID0gdGhpcy5zdGF0ZS53cmFwcGVyTGF5b3V0LndpZHRoO1xuXHRcdH1cblxuXHRcdGlmIChfcHJldlByb3BzLmNlbnRlckluV3JhcHBlciAhPT0gdGhpcy5wcm9wcy5jZW50ZXJJbldyYXBwZXIpIHtcblx0XHRcdGNvbnN0IGNlbnRlckluV3JhcHBlciA9IHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyO1xuXHRcdFx0dGhpcy5hbmltYXRpb25Mb2dpYy51cGRhdGVDZW50ZXJTY3JvbGwoXG5cdFx0XHRcdGNlbnRlckluV3JhcHBlciAhPSBudWxsID8gY2VudGVySW5XcmFwcGVyIDogZmFsc2UsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmIChcblx0XHRcdHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aCAhPT0gMCAmJlxuXHRcdFx0dGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoICE9PSAwICYmXG5cdFx0XHR0aGlzLnN0YXRlLnJlYWR5ID09PSBmYWxzZVxuXHRcdCkge1xuXHRcdFx0aWYgKHRoaXMucHJvcHMuc3RhcnRpbmdQb3NpdGlvbiAhPSBudWxsKSB7XG5cdFx0XHRcdHRoaXMuc2Nyb2xsVG8odGhpcy5wcm9wcy5zdGFydGluZ1Bvc2l0aW9uLCBmYWxzZSk7XG5cdFx0XHR9XG5cdFx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvbm8tZGlkLXVwZGF0ZS1zZXQtc3RhdGVcblx0XHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0XHRyZWFkeTogdHJ1ZSxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGggJiYgdGhpcy5wcm9wcy50b3RhbEl0ZW1Db3VudCAhPSBudWxsKSB7XG5cdFx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnVwZGF0ZU1heFNjcm9sbChcblx0XHRcdFx0LTEgKiB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGggKiB0aGlzLnByb3BzLnRvdGFsSXRlbUNvdW50LFxuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRjYWxjdWxhdGVDdXJyZW50SW5kZXgobW92ZVhWYWx1ZTogbnVtYmVyKSB7XG5cdFx0Y29uc3QgaXRlbVdpZHRoID0gdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoO1xuXHRcdGNvbnN0IHdyYXBwZXJXaWR0aCA9IHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aDtcblx0XHRjb25zdCBjZW50ZXJJbldyYXBwZXIgPVxuXHRcdFx0dGhpcy5wcm9wcy5jZW50ZXJJbldyYXBwZXIgIT0gbnVsbFxuXHRcdFx0XHQ/IHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyXG5cdFx0XHRcdDogZmFsc2U7XG5cdFx0Y29uc3QgY2VudGVyID0gY2VudGVySW5XcmFwcGVyID8gd3JhcHBlcldpZHRoIC8gMiAtIGl0ZW1XaWR0aCAvIDIgOiAwO1xuXHRcdC8qKlxuXHRcdCAqIFRoZSB2YWx1ZSB3aWxsIGJlIHNsaWdobHkgb2ZmIGJlY2F1c2Ugb3VyIHNuYXAgZW5kIHRocmVzaGhvbGQgaXMgYVxuXHRcdCAqIGJpdCBoaWdoIHRvIGVuc3VyZSBldmVudHMgYXJlIHRyaWdnZXJlZCBpbiBhIHRpbWxleSBtYW5uZXIuXG5cdFx0ICoqL1xuXHRcdHJldHVybiBNYXRoLnJvdW5kKChjZW50ZXIgLSBtb3ZlWFZhbHVlKSAvIGl0ZW1XaWR0aCk7XG5cdH1cblxuXHRnZXRDdXJyZW50SW5kZXgoKSB7XG5cdFx0cmV0dXJuIHRoaXMuY2FsY3VsYXRlQ3VycmVudEluZGV4KHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLngpO1xuXHR9XG5cblx0YXN5bmMgZ29OZXh0KHdpdGhBbmltYXRpb246IGJvb2xlYW4gPSB0cnVlKSB7XG5cdFx0Y29uc3QgaW5kZXggPSB0aGlzLmdldEN1cnJlbnRJbmRleCgpO1xuXHRcdHJldHVybiB0aGlzLnNjcm9sbFRvKGluZGV4ICsgMSwgd2l0aEFuaW1hdGlvbik7XG5cdH1cblxuXHRhc3luYyBnb0JhY2sod2l0aEFuaW1hdGlvbjogYm9vbGVhbiA9IHRydWUpIHtcblx0XHRjb25zdCBpbmRleCA9IHRoaXMuZ2V0Q3VycmVudEluZGV4KCk7XG5cdFx0cmV0dXJuIHRoaXMuc2Nyb2xsVG8oaW5kZXggLSAxLCB3aXRoQW5pbWF0aW9uKTtcblx0fVxuXG5cdGFzeW5jIHNjcm9sbFRvKGl0ZW1PZmZzZXQ6IG51bWJlciwgd2l0aEFuaW1hdGlvbjogYm9vbGVhbiA9IHRydWUpIHtcblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnNjcm9sbFRvKFxuXHRcdFx0LTEgKiBpdGVtT2Zmc2V0ICogdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoLFxuXHRcdFx0d2l0aEFuaW1hdGlvbixcblx0XHQpO1xuXHR9XG5cblx0b25JdGVtTGF5b3V0ID0gKHtcblx0XHRuYXRpdmVFdmVudDoge1xuXHRcdFx0bGF5b3V0OiB7d2lkdGgsIGhlaWdodH0sXG5cdFx0fSxcblx0fTogTGF5b3V0Q2hhbmdlRXZlbnQpID0+IHtcblx0XHRjb25zdCB7aXRlbUxheW91dH0gPSB0aGlzLnN0YXRlO1xuXHRcdGlmIChpdGVtTGF5b3V0LndpZHRoICE9PSB3aWR0aCB8fCBpdGVtTGF5b3V0LmhlaWdodCAhPT0gaGVpZ2h0KSB7XG5cdFx0XHR0aGlzLnNldFN0YXRlKHtcblx0XHRcdFx0aXRlbUxheW91dDoge3dpZHRoLCBoZWlnaHR9LFxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdHRoaXMuYW5pbWF0aW9uTG9naWMudXBkYXRlSXRlbVdpZHRoKHdpZHRoKTtcblx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvci5pbmZpbml0ZUVsZW1lbnRXaWR0aCA9IHdpZHRoO1xuXHR9O1xuXG5cdG9uV3JhcHBlckxheW91dCA9ICh7XG5cdFx0bmF0aXZlRXZlbnQ6IHtcblx0XHRcdGxheW91dDoge3dpZHRoLCBoZWlnaHR9LFxuXHRcdH0sXG5cdH06IExheW91dENoYW5nZUV2ZW50KSA9PiB7XG5cdFx0Y29uc3Qge3dyYXBwZXJMYXlvdXR9ID0gdGhpcy5zdGF0ZTtcblx0XHRpZiAod3JhcHBlckxheW91dC53aWR0aCAhPT0gd2lkdGggfHwgd3JhcHBlckxheW91dC5oZWlnaHQgIT09IGhlaWdodCkge1xuXHRcdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdHdyYXBwZXJMYXlvdXQ6IHt3aWR0aCwgaGVpZ2h0fSxcblx0XHRcdH0pO1xuXHRcdH1cblx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvci53cmFwcGVyV2lkdGggPSB3aWR0aDtcblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnVwZGF0ZVdyYXBwZXJXaWR0aCh3aWR0aCk7XG5cdH07XG5cblx0cmVuZGVyKCkge1xuXHRcdGNvbnN0IHN0eWxlID0ge1xuXHRcdFx0b3BhY2l0eTogdGhpcy5zdGF0ZS5yZWFkeSA/IDEgOiAwLFxuXHRcdFx0aGVpZ2h0OiB0aGlzLnN0YXRlLml0ZW1MYXlvdXQuaGVpZ2h0LFxuXHRcdH07XG5cdFx0cmV0dXJuIChcblx0XHRcdDxQYW5HZXN0dXJlSGFuZGxlclxuXHRcdFx0XHRvbkdlc3R1cmVFdmVudD17dGhpcy5hbmltYXRpb25Mb2dpYy5nZXN0dXJlSGFuZGxlcn1cblx0XHRcdFx0b25IYW5kbGVyU3RhdGVDaGFuZ2U9e3RoaXMuYW5pbWF0aW9uTG9naWMuZ2VzdHVyZUhhbmRsZXJ9PlxuXHRcdFx0XHQ8QW5pbWF0ZWQuVmlld1xuXHRcdFx0XHRcdHN0eWxlPXtbdGhpcy5wcm9wcy5zdHlsZSwgc3R5bGVdfVxuXHRcdFx0XHRcdG9uTGF5b3V0PXt0aGlzLm9uV3JhcHBlckxheW91dH0+XG5cdFx0XHRcdFx0PEFuaW1hdGVkLlZpZXdcblx0XHRcdFx0XHRcdHN0eWxlPXt7XG5cdFx0XHRcdFx0XHRcdHRyYW5zZm9ybTogW1xuXHRcdFx0XHRcdFx0XHRcdHt0cmFuc2xhdGVYOiB0aGlzLmFuaW1hdGlvbkxvZ2ljLnh9LFxuXHRcdFx0XHRcdFx0XHRcdHtwZXJzcGVjdGl2ZTogMTAwMH0sIC8vIHdpdGhvdXQgdGhpcyBsaW5lIHRoaXMgQW5pbWF0aW9uIHdpbGwgbm90IHJlbmRlciBvbiBBbmRyb2lkIHdoaWxlIHdvcmtpbmcgZmluZSBvbiBpT1Ncblx0XHRcdFx0XHRcdFx0XSxcblx0XHRcdFx0XHRcdH19PlxuXHRcdFx0XHRcdFx0e3RoaXMuaW5maW5pdGVFbGVtZW50cy5tYXAoKGl0ZW0sIGkpID0+IHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIChcblx0XHRcdFx0XHRcdFx0XHQ8SW5maW5pdGVJdGVtPFQ+XG5cdFx0XHRcdFx0XHRcdFx0XHRyZW5kZXJJdGVtPXt0aGlzLnByb3BzLnJlbmRlckl0ZW19XG5cdFx0XHRcdFx0XHRcdFx0XHRpdGVtPXtpdGVtfVxuXHRcdFx0XHRcdFx0XHRcdFx0a2V5PXtpfVxuXHRcdFx0XHRcdFx0XHRcdFx0b25MYXlvdXQ9e3RoaXMub25JdGVtTGF5b3V0fVxuXHRcdFx0XHRcdFx0XHRcdC8+XG5cdFx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0XHR9KX1cblx0XHRcdFx0XHQ8L0FuaW1hdGVkLlZpZXc+XG5cdFx0XHRcdDwvQW5pbWF0ZWQuVmlldz5cblx0XHRcdDwvUGFuR2VzdHVyZUhhbmRsZXI+XG5cdFx0KTtcblx0fVxufVxuIl19