function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

import React, { Component } from 'react';
import Animated from 'react-native-reanimated';
import { PanGestureHandler } from 'react-native-gesture-handler';
import InfiniteElement from './InfiniteElement';
import InfiniteCalculator from './InfiniteCalculator';
import InfiniteItem from './InfiniteItem';
import AnimationLogic from './AnimationLogic';
export default class InfiniteScroller extends Component {
  constructor(props) {
    super(props);

    _defineProperty(this, "infiniteCalculator", void 0);

    _defineProperty(this, "infiniteElements", []);

    _defineProperty(this, "animationLogic", void 0);

    _defineProperty(this, "onItemLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        itemLayout
      } = this.state;

      if (itemLayout.width !== width || itemLayout.height !== height) {
        this.setState({
          itemLayout: {
            width,
            height
          }
        });
      }

      this.animationLogic.updateItemWidth(width);
      this.infiniteCalculator.infiniteElementWidth = width;
    });

    _defineProperty(this, "onWrapperLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        wrapperLayout
      } = this.state;

      if (wrapperLayout.width !== width || wrapperLayout.height !== height) {
        this.setState({
          wrapperLayout: {
            width,
            height
          }
        });
      }

      this.infiniteCalculator.wrapperWidth = width;
      this.animationLogic.updateWrapperWidth(width);
    });

    this.state = {
      itemLayout: {
        width: 0,
        height: 0
      },
      wrapperLayout: {
        width: 0,
        height: 0
      },
      ready: false
    };
    this.infiniteElements = [];

    for (let i = 0; i < (props.infiniteElementCount || 100); i++) {
      this.infiniteElements.push(new InfiniteElement());
    }

    this.infiniteCalculator = new InfiniteCalculator(_objectSpread({}, props, {
      infiniteLimit: Math.floor(2147483645 / 1000),
      infiniteElements: this.infiniteElements,
      cacheSize: this.infiniteElements.length * 2
    }));
    this.animationLogic = AnimationLogic();
    this.animationLogic.on('change', value => {
      this.infiniteCalculator.x = value;
    });
    this.animationLogic.on('scrollEnd', _value => {
      if (this.props.onScrollEnd) {
        this.props.onScrollEnd(this.getCurrentIndex(), this);
      }
    });

    if (props.centerInWrapper != null) {
      this.animationLogic.updateCenterScroll(props.centerInWrapper);
    }
  }

  componentDidUpdate(_prevProps, prevState) {
    if (prevState.wrapperLayout.width !== this.state.wrapperLayout.width || prevState.itemLayout.width !== this.state.itemLayout.width) {
      this.infiniteCalculator.infiniteElementWidth = this.state.itemLayout.width;
      this.infiniteCalculator.wrapperWidth = this.state.wrapperLayout.width;
    }

    if (_prevProps.centerInWrapper !== this.props.centerInWrapper) {
      const centerInWrapper = this.props.centerInWrapper;
      this.animationLogic.updateCenterScroll(centerInWrapper != null ? centerInWrapper : false);
    }

    if (this.state.wrapperLayout.width !== 0 && this.state.itemLayout.width !== 0 && this.state.ready === false) {
      if (this.props.startingPosition != null) {
        this.scrollTo(this.props.startingPosition, false);
      } // eslint-disable-next-line react/no-did-update-set-state


      this.setState({
        ready: true
      });
    }

    if (this.state.itemLayout.width && this.props.totalItemCount != null) {
      this.animationLogic.updateMaxScroll(-1 * this.state.itemLayout.width * this.props.totalItemCount);
    }
  }

  getCurrentIndex() {
    const moveXValue = this.infiniteCalculator.x;
    const itemWidth = this.state.itemLayout.width;
    const wrapperWidth = this.state.wrapperLayout.width;
    const centerInWrapper = this.props.centerInWrapper != null ? this.props.centerInWrapper : false;
    const center = centerInWrapper ? wrapperWidth / 2 - itemWidth / 2 : 0;
    /**
     * The value will be slighly off because our snap end threshhold is a
     * bit high to ensure events are triggered in a timley manner.
     **/

    return Math.round((center - moveXValue) / itemWidth);
  }

  async goNext(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollTo(index + 1, withAnimation);
  }

  async goBack(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollTo(index - 1, withAnimation);
  }

  async scrollTo(itemOffset, withAnimation = true) {
    this.animationLogic.scrollTo(-1 * itemOffset * this.state.itemLayout.width, withAnimation);
  }

  render() {
    const style = {
      opacity: this.state.ready ? 1 : 0,
      height: this.state.itemLayout.height
    };
    return <PanGestureHandler onGestureEvent={this.animationLogic.gestureHandler} onHandlerStateChange={this.animationLogic.gestureHandler}>
				<Animated.View style={[this.props.style, style]} onLayout={this.onWrapperLayout}>
					<Animated.View style={{
          transform: [{
            translateX: this.animationLogic.x
          }, {
            perspective: 1000
          } // without this line this Animation will not render on Android while working fine on iOS
          ]
        }}>
						{this.infiniteElements.map((item, i) => {
            return <InfiniteItem renderItem={this.props.renderItem} item={item} key={i} onLayout={this.onItemLayout} />;
          })}
					</Animated.View>
				</Animated.View>
			</PanGestureHandler>;
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9JbmZpbml0ZVNjcm9sbGVyLnRzeCJdLCJuYW1lcyI6WyJSZWFjdCIsIkNvbXBvbmVudCIsIkFuaW1hdGVkIiwiUGFuR2VzdHVyZUhhbmRsZXIiLCJJbmZpbml0ZUVsZW1lbnQiLCJJbmZpbml0ZUNhbGN1bGF0b3IiLCJJbmZpbml0ZUl0ZW0iLCJBbmltYXRpb25Mb2dpYyIsIkluZmluaXRlU2Nyb2xsZXIiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwibmF0aXZlRXZlbnQiLCJsYXlvdXQiLCJ3aWR0aCIsImhlaWdodCIsIml0ZW1MYXlvdXQiLCJzdGF0ZSIsInNldFN0YXRlIiwiYW5pbWF0aW9uTG9naWMiLCJ1cGRhdGVJdGVtV2lkdGgiLCJpbmZpbml0ZUNhbGN1bGF0b3IiLCJpbmZpbml0ZUVsZW1lbnRXaWR0aCIsIndyYXBwZXJMYXlvdXQiLCJ3cmFwcGVyV2lkdGgiLCJ1cGRhdGVXcmFwcGVyV2lkdGgiLCJyZWFkeSIsImluZmluaXRlRWxlbWVudHMiLCJpIiwiaW5maW5pdGVFbGVtZW50Q291bnQiLCJwdXNoIiwiaW5maW5pdGVMaW1pdCIsIk1hdGgiLCJmbG9vciIsImNhY2hlU2l6ZSIsImxlbmd0aCIsIm9uIiwidmFsdWUiLCJ4IiwiX3ZhbHVlIiwib25TY3JvbGxFbmQiLCJnZXRDdXJyZW50SW5kZXgiLCJjZW50ZXJJbldyYXBwZXIiLCJ1cGRhdGVDZW50ZXJTY3JvbGwiLCJjb21wb25lbnREaWRVcGRhdGUiLCJfcHJldlByb3BzIiwicHJldlN0YXRlIiwic3RhcnRpbmdQb3NpdGlvbiIsInNjcm9sbFRvIiwidG90YWxJdGVtQ291bnQiLCJ1cGRhdGVNYXhTY3JvbGwiLCJtb3ZlWFZhbHVlIiwiaXRlbVdpZHRoIiwiY2VudGVyIiwicm91bmQiLCJnb05leHQiLCJ3aXRoQW5pbWF0aW9uIiwiaW5kZXgiLCJnb0JhY2siLCJpdGVtT2Zmc2V0IiwicmVuZGVyIiwic3R5bGUiLCJvcGFjaXR5IiwiZ2VzdHVyZUhhbmRsZXIiLCJvbldyYXBwZXJMYXlvdXQiLCJ0cmFuc2Zvcm0iLCJ0cmFuc2xhdGVYIiwicGVyc3BlY3RpdmUiLCJtYXAiLCJpdGVtIiwicmVuZGVySXRlbSIsIm9uSXRlbUxheW91dCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBT0EsS0FBUCxJQUFlQyxTQUFmLFFBQStCLE9BQS9CO0FBR0EsT0FBT0MsUUFBUCxNQUFxQix5QkFBckI7QUFDQSxTQUFRQyxpQkFBUixRQUFnQyw4QkFBaEM7QUFDQSxPQUFPQyxlQUFQLE1BQTRCLG1CQUE1QjtBQUNBLE9BQU9DLGtCQUFQLE1BQStCLHNCQUEvQjtBQUNBLE9BQU9DLFlBQVAsTUFBeUIsZ0JBQXpCO0FBQ0EsT0FBT0MsY0FBUCxNQUEyQixrQkFBM0I7QUE0QkEsZUFBZSxNQUFNQyxnQkFBTixTQUFrQ1AsU0FBbEMsQ0FHYjtBQUtEUSxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBa0M7QUFDNUMsVUFBTUEsS0FBTjs7QUFENEM7O0FBQUEsOENBSEosRUFHSTs7QUFBQTs7QUFBQSwwQ0FnSDlCLENBQUM7QUFDZkMsTUFBQUEsV0FBVyxFQUFFO0FBQ1pDLFFBQUFBLE1BQU0sRUFBRTtBQUFDQyxVQUFBQSxLQUFEO0FBQVFDLFVBQUFBO0FBQVI7QUFESTtBQURFLEtBQUQsS0FJVTtBQUN4QixZQUFNO0FBQUNDLFFBQUFBO0FBQUQsVUFBZSxLQUFLQyxLQUExQjs7QUFDQSxVQUFJRCxVQUFVLENBQUNGLEtBQVgsS0FBcUJBLEtBQXJCLElBQThCRSxVQUFVLENBQUNELE1BQVgsS0FBc0JBLE1BQXhELEVBQWdFO0FBQy9ELGFBQUtHLFFBQUwsQ0FBYztBQUNiRixVQUFBQSxVQUFVLEVBQUU7QUFBQ0YsWUFBQUEsS0FBRDtBQUFRQyxZQUFBQTtBQUFSO0FBREMsU0FBZDtBQUdBOztBQUNELFdBQUtJLGNBQUwsQ0FBb0JDLGVBQXBCLENBQW9DTixLQUFwQztBQUNBLFdBQUtPLGtCQUFMLENBQXdCQyxvQkFBeEIsR0FBK0NSLEtBQS9DO0FBQ0EsS0E3SDRDOztBQUFBLDZDQStIM0IsQ0FB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YWN0LCB7Q29tcG9uZW50fSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge0xheW91dENoYW5nZUV2ZW50LCBTdHlsZVByb3AsIFZpZXdTdHlsZX0gZnJvbSAncmVhY3QtbmF0aXZlJztcblxuaW1wb3J0IEFuaW1hdGVkIGZyb20gJ3JlYWN0LW5hdGl2ZS1yZWFuaW1hdGVkJztcbmltcG9ydCB7UGFuR2VzdHVyZUhhbmRsZXJ9IGZyb20gJ3JlYWN0LW5hdGl2ZS1nZXN0dXJlLWhhbmRsZXInO1xuaW1wb3J0IEluZmluaXRlRWxlbWVudCBmcm9tICcuL0luZmluaXRlRWxlbWVudCc7XG5pbXBvcnQgSW5maW5pdGVDYWxjdWxhdG9yIGZyb20gJy4vSW5maW5pdGVDYWxjdWxhdG9yJztcbmltcG9ydCBJbmZpbml0ZUl0ZW0gZnJvbSAnLi9JbmZpbml0ZUl0ZW0nO1xuaW1wb3J0IEFuaW1hdGlvbkxvZ2ljIGZyb20gJy4vQW5pbWF0aW9uTG9naWMnO1xuXG5pbnRlcmZhY2UgSW5maW5pdGVTY3JvbGxlclByb3BzPFQ+IHtcblx0ZGF0YXNldChzdGFydDogbnVtYmVyLCBjb3VudDogbnVtYmVyKTogUHJvbWlzZTxUW10+O1xuXHRyZW5kZXJJdGVtOiAoZGF0YTogVCB8IG51bGwpID0+IFJlYWN0LlJlYWN0RWxlbWVudDtcblx0c3R5bGU/OiBTdHlsZVByb3A8Vmlld1N0eWxlPjtcblx0dG90YWxJdGVtQ291bnQ/OiBudW1iZXIgfCBudWxsO1xuXHRjZW50ZXJJbldyYXBwZXI/OiBib29sZWFuIHwgbnVsbDtcblx0c3RhcnRpbmdQb3NpdGlvbj86IG51bWJlciB8IG51bGw7XG5cdG9uU2Nyb2xsRW5kPzogKFxuXHRcdHNjcm9sbFBvc2l0aW9uOiBudW1iZXIsXG5cdFx0c2Nyb2xsZXI6IEluZmluaXRlU2Nyb2xsZXI8VD4sXG5cdCkgPT4gdm9pZCB8IG51bGw7XG5cdGluZmluaXRlRWxlbWVudENvdW50PzogbnVtYmVyIHwgbnVsbDtcbn1cblxuaW50ZXJmYWNlIEluZmluaXRlU2Nyb2xsZXJTdGF0ZSB7XG5cdGl0ZW1MYXlvdXQ6IHtcblx0XHR3aWR0aDogbnVtYmVyO1xuXHRcdGhlaWdodDogbnVtYmVyO1xuXHR9O1xuXHR3cmFwcGVyTGF5b3V0OiB7XG5cdFx0d2lkdGg6IG51bWJlcjtcblx0XHRoZWlnaHQ6IG51bWJlcjtcblx0fTtcblx0cmVhZHk6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEluZmluaXRlU2Nyb2xsZXI8VD4gZXh0ZW5kcyBDb21wb25lbnQ8XG5cdEluZmluaXRlU2Nyb2xsZXJQcm9wczxUPixcblx0SW5maW5pdGVTY3JvbGxlclN0YXRlXG4+IHtcblx0aW5maW5pdGVDYWxjdWxhdG9yOiBJbmZpbml0ZUNhbGN1bGF0b3I8VD47XG5cdGluZmluaXRlRWxlbWVudHM6IEluZmluaXRlRWxlbWVudDxUPltdID0gW107XG5cdGFuaW1hdGlvbkxvZ2ljOiBBbmltYXRpb25Mb2dpYztcblxuXHRjb25zdHJ1Y3Rvcihwcm9wczogSW5maW5pdGVTY3JvbGxlclByb3BzPFQ+KSB7XG5cdFx0c3VwZXIocHJvcHMpO1xuXHRcdHRoaXMuc3RhdGUgPSB7XG5cdFx0XHRpdGVtTGF5b3V0OiB7XG5cdFx0XHRcdHdpZHRoOiAwLFxuXHRcdFx0XHRoZWlnaHQ6IDAsXG5cdFx0XHR9LFxuXHRcdFx0d3JhcHBlckxheW91dDoge1xuXHRcdFx0XHR3aWR0aDogMCxcblx0XHRcdFx0aGVpZ2h0OiAwLFxuXHRcdFx0fSxcblx0XHRcdHJlYWR5OiBmYWxzZSxcblx0XHR9O1xuXHRcdHRoaXMuaW5maW5pdGVFbGVtZW50cyA9IFtdO1xuXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCAocHJvcHMuaW5maW5pdGVFbGVtZW50Q291bnQgfHwgMTAwKTsgaSsrKSB7XG5cdFx0XHR0aGlzLmluZmluaXRlRWxlbWVudHMucHVzaChuZXcgSW5maW5pdGVFbGVtZW50PFQ+KCkpO1xuXHRcdH1cblxuXHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yID0gbmV3IEluZmluaXRlQ2FsY3VsYXRvcih7XG5cdFx0XHQuLi5wcm9wcyxcblx0XHRcdGluZmluaXRlTGltaXQ6IE1hdGguZmxvb3IoMjE0NzQ4MzY0NSAvIDEwMDApLFxuXHRcdFx0aW5maW5pdGVFbGVtZW50czogdGhpcy5pbmZpbml0ZUVsZW1lbnRzLFxuXHRcdFx0Y2FjaGVTaXplOiB0aGlzLmluZmluaXRlRWxlbWVudHMubGVuZ3RoICogMixcblx0XHR9KTtcblxuXHRcdHRoaXMuYW5pbWF0aW9uTG9naWMgPSBBbmltYXRpb25Mb2dpYygpO1xuXHRcdHRoaXMuYW5pbWF0aW9uTG9naWMub24oJ2NoYW5nZScsIHZhbHVlID0+IHtcblx0XHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLnggPSB2YWx1ZTtcblx0XHR9KTtcblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLm9uKCdzY3JvbGxFbmQnLCBfdmFsdWUgPT4ge1xuXHRcdFx0aWYgKHRoaXMucHJvcHMub25TY3JvbGxFbmQpIHtcblx0XHRcdFx0dGhpcy5wcm9wcy5vblNjcm9sbEVuZCh0aGlzLmdldEN1cnJlbnRJbmRleCgpLCB0aGlzKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmIChwcm9wcy5jZW50ZXJJbldyYXBwZXIgIT0gbnVsbCkge1xuXHRcdFx0dGhpcy5hbmltYXRpb25Mb2dpYy51cGRhdGVDZW50ZXJTY3JvbGwocHJvcHMuY2VudGVySW5XcmFwcGVyKTtcblx0XHR9XG5cdH1cblxuXHRjb21wb25lbnREaWRVcGRhdGUoXG5cdFx0X3ByZXZQcm9wczogSW5maW5pdGVTY3JvbGxlclByb3BzPFQ+LFxuXHRcdHByZXZTdGF0ZTogSW5maW5pdGVTY3JvbGxlclN0YXRlLFxuXHQpIHtcblx0XHRpZiAoXG5cdFx0XHRwcmV2U3RhdGUud3JhcHBlckxheW91dC53aWR0aCAhPT0gdGhpcy5zdGF0ZS53cmFwcGVyTGF5b3V0LndpZHRoIHx8XG5cdFx0XHRwcmV2U3RhdGUuaXRlbUxheW91dC53aWR0aCAhPT0gdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoXG5cdFx0KSB7XG5cdFx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvci5pbmZpbml0ZUVsZW1lbnRXaWR0aCA9IHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aDtcblx0XHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLndyYXBwZXJXaWR0aCA9IHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aDtcblx0XHR9XG5cblx0XHRpZiAoX3ByZXZQcm9wcy5jZW50ZXJJbldyYXBwZXIgIT09IHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyKSB7XG5cdFx0XHRjb25zdCBjZW50ZXJJbldyYXBwZXIgPSB0aGlzLnByb3BzLmNlbnRlckluV3JhcHBlcjtcblx0XHRcdHRoaXMuYW5pbWF0aW9uTG9naWMudXBkYXRlQ2VudGVyU2Nyb2xsKFxuXHRcdFx0XHRjZW50ZXJJbldyYXBwZXIgIT0gbnVsbCA/IGNlbnRlckluV3JhcHBlciA6IGZhbHNlLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAoXG5cdFx0XHR0aGlzLnN0YXRlLndyYXBwZXJMYXlvdXQud2lkdGggIT09IDAgJiZcblx0XHRcdHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aCAhPT0gMCAmJlxuXHRcdFx0dGhpcy5zdGF0ZS5yZWFkeSA9PT0gZmFsc2Vcblx0XHQpIHtcblx0XHRcdGlmICh0aGlzLnByb3BzLnN0YXJ0aW5nUG9zaXRpb24gIT0gbnVsbCkge1xuXHRcdFx0XHR0aGlzLnNjcm9sbFRvKHRoaXMucHJvcHMuc3RhcnRpbmdQb3NpdGlvbiwgZmFsc2UpO1xuXHRcdFx0fVxuXHRcdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L25vLWRpZC11cGRhdGUtc2V0LXN0YXRlXG5cdFx0XHR0aGlzLnNldFN0YXRlKHtcblx0XHRcdFx0cmVhZHk6IHRydWUsXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoICYmIHRoaXMucHJvcHMudG90YWxJdGVtQ291bnQgIT0gbnVsbCkge1xuXHRcdFx0dGhpcy5hbmltYXRpb25Mb2dpYy51cGRhdGVNYXhTY3JvbGwoXG5cdFx0XHRcdC0xICogdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoICogdGhpcy5wcm9wcy50b3RhbEl0ZW1Db3VudCxcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0Z2V0Q3VycmVudEluZGV4KCkge1xuXHRcdGNvbnN0IG1vdmVYVmFsdWUgPSB0aGlzLmluZmluaXRlQ2FsY3VsYXRvci54O1xuXHRcdGNvbnN0IGl0ZW1XaWR0aCA9IHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aDtcblx0XHRjb25zdCB3cmFwcGVyV2lkdGggPSB0aGlzLnN0YXRlLndyYXBwZXJMYXlvdXQud2lkdGg7XG5cdFx0Y29uc3QgY2VudGVySW5XcmFwcGVyID1cblx0XHRcdHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyICE9IG51bGwgPyB0aGlzLnByb3BzLmNlbnRlckluV3JhcHBlciA6IGZhbHNlO1xuXHRcdGNvbnN0IGNlbnRlciA9IGNlbnRlckluV3JhcHBlciA/IHdyYXBwZXJXaWR0aCAvIDIgLSBpdGVtV2lkdGggLyAyIDogMDtcblx0XHQvKipcblx0XHQgKiBUaGUgdmFsdWUgd2lsbCBiZSBzbGlnaGx5IG9mZiBiZWNhdXNlIG91ciBzbmFwIGVuZCB0aHJlc2hob2xkIGlzIGFcblx0XHQgKiBiaXQgaGlnaCB0byBlbnN1cmUgZXZlbnRzIGFyZSB0cmlnZ2VyZWQgaW4gYSB0aW1sZXkgbWFubmVyLlxuXHRcdCAqKi9cblx0XHRyZXR1cm4gTWF0aC5yb3VuZCgoY2VudGVyIC0gbW92ZVhWYWx1ZSkgLyBpdGVtV2lkdGgpO1xuXHR9XG5cblx0YXN5bmMgZ29OZXh0KHdpdGhBbmltYXRpb246IGJvb2xlYW4gPSB0cnVlKSB7XG5cdFx0Y29uc3QgaW5kZXggPSB0aGlzLmdldEN1cnJlbnRJbmRleCgpO1xuXHRcdHJldHVybiB0aGlzLnNjcm9sbFRvKGluZGV4ICsgMSwgd2l0aEFuaW1hdGlvbik7XG5cdH1cblxuXHRhc3luYyBnb0JhY2sod2l0aEFuaW1hdGlvbjogYm9vbGVhbiA9IHRydWUpIHtcblx0XHRjb25zdCBpbmRleCA9IHRoaXMuZ2V0Q3VycmVudEluZGV4KCk7XG5cdFx0cmV0dXJuIHRoaXMuc2Nyb2xsVG8oaW5kZXggLSAxLCB3aXRoQW5pbWF0aW9uKTtcblx0fVxuXG5cdGFzeW5jIHNjcm9sbFRvKGl0ZW1PZmZzZXQ6IG51bWJlciwgd2l0aEFuaW1hdGlvbjogYm9vbGVhbiA9IHRydWUpIHtcblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnNjcm9sbFRvKFxuXHRcdFx0LTEgKiBpdGVtT2Zmc2V0ICogdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoLFxuXHRcdFx0d2l0aEFuaW1hdGlvbixcblx0XHQpO1xuXHR9XG5cblx0b25JdGVtTGF5b3V0ID0gKHtcblx0XHRuYXRpdmVFdmVudDoge1xuXHRcdFx0bGF5b3V0OiB7d2lkdGgsIGhlaWdodH0sXG5cdFx0fSxcblx0fTogTGF5b3V0Q2hhbmdlRXZlbnQpID0+IHtcblx0XHRjb25zdCB7aXRlbUxheW91dH0gPSB0aGlzLnN0YXRlO1xuXHRcdGlmIChpdGVtTGF5b3V0LndpZHRoICE9PSB3aWR0aCB8fCBpdGVtTGF5b3V0LmhlaWdodCAhPT0gaGVpZ2h0KSB7XG5cdFx0XHR0aGlzLnNldFN0YXRlKHtcblx0XHRcdFx0aXRlbUxheW91dDoge3dpZHRoLCBoZWlnaHR9LFxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdHRoaXMuYW5pbWF0aW9uTG9naWMudXBkYXRlSXRlbVdpZHRoKHdpZHRoKTtcblx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvci5pbmZpbml0ZUVsZW1lbnRXaWR0aCA9IHdpZHRoO1xuXHR9O1xuXG5cdG9uV3JhcHBlckxheW91dCA9ICh7XG5cdFx0bmF0aXZlRXZlbnQ6IHtcblx0XHRcdGxheW91dDoge3dpZHRoLCBoZWlnaHR9LFxuXHRcdH0sXG5cdH06IExheW91dENoYW5nZUV2ZW50KSA9PiB7XG5cdFx0Y29uc3Qge3dyYXBwZXJMYXlvdXR9ID0gdGhpcy5zdGF0ZTtcblx0XHRpZiAod3JhcHBlckxheW91dC53aWR0aCAhPT0gd2lkdGggfHwgd3JhcHBlckxheW91dC5oZWlnaHQgIT09IGhlaWdodCkge1xuXHRcdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdHdyYXBwZXJMYXlvdXQ6IHt3aWR0aCwgaGVpZ2h0fSxcblx0XHRcdH0pO1xuXHRcdH1cblx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvci53cmFwcGVyV2lkdGggPSB3aWR0aDtcblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnVwZGF0ZVdyYXBwZXJXaWR0aCh3aWR0aCk7XG5cdH07XG5cblx0cmVuZGVyKCkge1xuXHRcdGNvbnN0IHN0eWxlID0ge1xuXHRcdFx0b3BhY2l0eTogdGhpcy5zdGF0ZS5yZWFkeSA/IDEgOiAwLFxuXHRcdFx0aGVpZ2h0OiB0aGlzLnN0YXRlLml0ZW1MYXlvdXQuaGVpZ2h0LFxuXHRcdH07XG5cdFx0cmV0dXJuIChcblx0XHRcdDxQYW5HZXN0dXJlSGFuZGxlclxuXHRcdFx0XHRvbkdlc3R1cmVFdmVudD17dGhpcy5hbmltYXRpb25Mb2dpYy5nZXN0dXJlSGFuZGxlcn1cblx0XHRcdFx0b25IYW5kbGVyU3RhdGVDaGFuZ2U9e3RoaXMuYW5pbWF0aW9uTG9naWMuZ2VzdHVyZUhhbmRsZXJ9PlxuXHRcdFx0XHQ8QW5pbWF0ZWQuVmlld1xuXHRcdFx0XHRcdHN0eWxlPXtbdGhpcy5wcm9wcy5zdHlsZSwgc3R5bGVdfVxuXHRcdFx0XHRcdG9uTGF5b3V0PXt0aGlzLm9uV3JhcHBlckxheW91dH0+XG5cdFx0XHRcdFx0PEFuaW1hdGVkLlZpZXdcblx0XHRcdFx0XHRcdHN0eWxlPXt7XG5cdFx0XHRcdFx0XHRcdHRyYW5zZm9ybTogW1xuXHRcdFx0XHRcdFx0XHRcdHt0cmFuc2xhdGVYOiB0aGlzLmFuaW1hdGlvbkxvZ2ljLnh9LFxuXHRcdFx0XHRcdFx0XHRcdHtwZXJzcGVjdGl2ZTogMTAwMH0sIC8vIHdpdGhvdXQgdGhpcyBsaW5lIHRoaXMgQW5pbWF0aW9uIHdpbGwgbm90IHJlbmRlciBvbiBBbmRyb2lkIHdoaWxlIHdvcmtpbmcgZmluZSBvbiBpT1Ncblx0XHRcdFx0XHRcdFx0XSxcblx0XHRcdFx0XHRcdH19PlxuXHRcdFx0XHRcdFx0e3RoaXMuaW5maW5pdGVFbGVtZW50cy5tYXAoKGl0ZW0sIGkpID0+IHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIChcblx0XHRcdFx0XHRcdFx0XHQ8SW5maW5pdGVJdGVtPFQ+XG5cdFx0XHRcdFx0XHRcdFx0XHRyZW5kZXJJdGVtPXt0aGlzLnByb3BzLnJlbmRlckl0ZW19XG5cdFx0XHRcdFx0XHRcdFx0XHRpdGVtPXtpdGVtfVxuXHRcdFx0XHRcdFx0XHRcdFx0a2V5PXtpfVxuXHRcdFx0XHRcdFx0XHRcdFx0b25MYXlvdXQ9e3RoaXMub25JdGVtTGF5b3V0fVxuXHRcdFx0XHRcdFx0XHRcdC8+XG5cdFx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0XHR9KX1cblx0XHRcdFx0XHQ8L0FuaW1hdGVkLlZpZXc+XG5cdFx0XHRcdDwvQW5pbWF0ZWQuVmlldz5cblx0XHRcdDwvUGFuR2VzdHVyZUhhbmRsZXI+XG5cdFx0KTtcblx0fVxufVxuIl19