function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

import React, { Component } from 'react';
import Animated from 'react-native-reanimated';
import { PanGestureHandler } from 'react-native-gesture-handler';
import InfiniteElement from './InfiniteElement';
import InfiniteCalculator from './InfiniteCalculator';
import InfiniteItem from './InfiniteItem';
import AnimationLogic from './AnimationLogic';
export default class InfiniteScroller extends Component {
  constructor(props) {
    super(props);

    _defineProperty(this, "infiniteCalculator", void 0);

    _defineProperty(this, "infiniteElements", []);

    _defineProperty(this, "animationLogic", void 0);

    _defineProperty(this, "currentElement", void 0);

    _defineProperty(this, "panHandlerRef", void 0);

    _defineProperty(this, "onScrollEnd", ({
      x
    }) => {
      this.infiniteCalculator.x = x;

      if (this.props.onScrollEnd) {
        x *= -1;
        console.log('scrollEnd: ' + x);
        this.currentElement = this.infiniteElements.find(element => {
          console.log(element.left, x);
          return element.left === x;
        });
        console.log('scrollEnd: ', this.currentElement);

        if (this.currentElement != null) {
          this.props.onScrollEnd(this.currentElement.phase, this.currentElement.data, this);
        } else {
          console.warn('InfiniteScroller is unable to determine the current item after the scroll ended.');
        }
      }
    });

    _defineProperty(this, "onItemLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        itemLayout
      } = this.state;

      if (itemLayout.width !== width || itemLayout.height !== height) {
        this.setState({
          itemLayout: {
            width,
            height
          }
        });
      }
    });

    _defineProperty(this, "onWrapperLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        wrapperLayout
      } = this.state;

      if (wrapperLayout.width !== width || wrapperLayout.height !== height) {
        this.setState({
          wrapperLayout: {
            width,
            height
          }
        });
      }
    });

    this.state = {
      itemLayout: props.itemDimensions || {
        width: 0,
        height: 0
      },
      wrapperLayout: props.wrapperDimensions || {
        width: 0,
        height: 0
      },
      ready: false
    };
    this.infiniteElements = [];

    for (let i = 0; i < (props.infiniteElementCount || 100); i++) {
      this.infiniteElements.push(new InfiniteElement());
    }

    this.infiniteCalculator = new InfiniteCalculator(_objectSpread({}, props, {
      infiniteLimit: Math.floor(2147483645 / 1000),
      infiniteElements: this.infiniteElements,
      cacheSize: this.infiniteElements.length * 2
    }));
    const startingPosition = props.startingPosition != null ? -1 * props.startingPosition * this.state.itemLayout.width : 0;
    this.animationLogic = AnimationLogic({
      springConfig: props.springConfig || {},
      decayConfig: props.decayConfig || {},
      centerScroll: props.centerInWrapper != null ? props.centerInWrapper : false,
      wrapperWidth: this.state.wrapperLayout.width,
      itemWidth: this.state.itemLayout.width,
      maxScroll: this.state.itemLayout.width !== 0 && props.totalItemCount != null ? -1 * this.state.itemLayout.width * props.totalItemCount : 0,
      startingPosition
    });
    this.animationLogic.on('change', value => {
      this.infiniteCalculator.x = value;
    });
    this.animationLogic.on('scrollEnd', this.onScrollEnd);
    this.panHandlerRef = React.createRef();
    this.onUpdate(false);

    if (startingPosition !== 0) {
      this.onScrollEnd({
        x: startingPosition
      });
    }
  }

  onUpdate(isMounted = true) {
    this.animationLogic.updateCenterScroll(this.props.centerInWrapper != null ? this.props.centerInWrapper : false);

    if (this.state.itemLayout.width !== 0) {
      this.infiniteCalculator.infiniteElementWidth = this.state.itemLayout.width;
      this.animationLogic.updateItemWidth(this.state.itemLayout.width);
    }

    if (this.state.wrapperLayout.width !== 0) {
      this.infiniteCalculator.wrapperWidth = this.state.wrapperLayout.width;
      this.animationLogic.updateWrapperWidth(this.state.wrapperLayout.width);
    }

    if (this.state.itemLayout.width && this.props.totalItemCount != null) {
      this.animationLogic.updateMaxScroll(-1 * this.state.itemLayout.width * this.props.totalItemCount);
    }

    this.infiniteCalculator.reorderInfinite();
    this.onReady(isMounted);
  }

  onReady(isMounted = true) {
    if (this.state.ready === false) {
      if (this.state.itemLayout.width !== 0 && this.state.wrapperLayout.width !== 0) {
        if (isMounted) {
          this.setState({
            ready: true
          });
        } else {
          this.state = _objectSpread({}, this.state, {
            ready: true
          });
        }
      }
    }
  }

  componentDidUpdate(prevProps, prevState) {
    let didChange = false;
    didChange = didChange || prevState.itemLayout.width !== this.state.itemLayout.width;
    didChange = didChange || prevState.wrapperLayout.width !== this.state.wrapperLayout.width;
    didChange = didChange || prevState.ready !== this.state.ready;
    didChange = didChange || prevProps.centerInWrapper !== this.props.centerInWrapper;
    didChange = didChange || prevProps.totalItemCount !== this.props.totalItemCount;

    if (didChange) {
      this.onUpdate();
    }
  }

  componentWillUnmount() {
    this.infiniteCalculator.dispose();
  }

  calculateCurrentIndex(moveXValue) {
    const itemWidth = this.state.itemLayout.width;
    const wrapperWidth = this.state.wrapperLayout.width;
    const centerInWrapper = this.props.centerInWrapper != null ? this.props.centerInWrapper : false;
    const center = centerInWrapper ? wrapperWidth / 2 - itemWidth / 2 : 0;
    /**
     * The value will be slighly off because our snap end threshhold is a
     * bit high to ensure events are triggered in a timley manner.
     **/

    return Math.round((center - moveXValue) / itemWidth);
  }

  getCurrentIndex() {
    return this.calculateCurrentIndex(this.infiniteCalculator.x);
  }

  async goNext(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollToIndex(index + 1, withAnimation);
  }

  async goBack(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollToIndex(index - 1, withAnimation);
  }

  scrollToIndex(itemOffset, withAnimation = true) {
    this.animationLogic.scrollTo(-1 * itemOffset * this.state.itemLayout.width, withAnimation);
  }

  scrollToElement(element, withAnimation) {
    return this.scrollToIndex(element.phase, withAnimation);
  }

  findNearestInfiniteElement(comparator) {
    const x = -1 * this.infiniteCalculator.x;
    let elements = [...this.infiniteElements].sort((a, b) => {
      const aDelta = Math.abs(x - a.left);
      const bDelta = Math.abs(x - b.left);
      return aDelta - bDelta;
    });
    return elements.find(item => comparator(item));
  }

  scrollToItem(comparator, withAnimation) {
    const element = this.findNearestInfiniteElement(elm => elm.data != null ? comparator(elm.data) : false);

    if (element) {
      return this.scrollToElement(element, withAnimation);
    }
  }

  render() {
    const style = {
      height: this.state.itemLayout.height,
      opacity: this.state.ready ? 1 : 0
    };
    return <PanGestureHandler ref={this.panHandlerRef} simultaneousHandlers={this.props.simultaneousHandlers} waitFor={this.props.waitFor} onGestureEvent={this.animationLogic.gestureHandler} onHandlerStateChange={this.animationLogic.gestureHandler}>
				<Animated.View style={[this.props.style, style]} onLayout={this.onWrapperLayout}>
					<Animated.View style={{
          transform: [{
            translateX: this.animationLogic.x
          }, {
            perspective: 1000
          } // without this line this Animation will not render on Android while working fine on iOS
          ]
        }}>
						{this.infiniteElements.map((item, i) => {
            return <InfiniteItem elementIndex={i} renderItem={this.props.renderItem} item={item} key={i} onLayout={i === 0 ? this.onItemLayout : null} />;
          })}
					</Animated.View>
				</Animated.View>
			</PanGestureHandler>;
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9JbmZpbml0ZVNjcm9sbGVyLnRzeCJdLCJuYW1lcyI6WyJSZWFjdCIsIkNvbXBvbmVudCIsIkFuaW1hdGVkIiwiUGFuR2VzdHVyZUhhbmRsZXIiLCJJbmZpbml0ZUVsZW1lbnQiLCJJbmZpbml0ZUNhbGN1bGF0b3IiLCJJbmZpbml0ZUl0ZW0iLCJBbmltYXRpb25Mb2dpYyIsIkluZmluaXRlU2Nyb2xsZXIiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwieCIsImluZmluaXRlQ2FsY3VsYXRvciIsIm9uU2Nyb2xsRW5kIiwiY29uc29sZSIsImxvZyIsImN1cnJlbnRFbGVtZW50IiwiaW5maW5pdGVFbGVtZW50cyIsImZpbmQiLCJlbGVtZW50IiwibGVmdCIsInBoYXNlIiwiZGF0YSIsIndhcm4iLCJuYXRpdmVFdmVudCIsImxheW91dCIsIndpZHRoIiwiaGVpZ2h0IiwiaXRlbUxheW91dCIsInN0YXRlIiwic2V0U3RhdGUiLCJ3cmFwcGVyTGF5b3V0IiwiaXRlbURpbWVuc2lvbnMiLCJ3cmFwcGVyRGltZW5zaW9ucyIsInJlYWR5IiwiaSIsImluZmluaXRlRWxlbWVudENvdW50IiwicHVzaCIsImluZmluaXRlTGltaXQiLCJNYXRoIiwiZmxvb3IiLCJjYWNoZVNpemUiLCJsZW5ndGgiLCJzdGFydGluZ1Bvc2l0aW9uIiwiYW5pbWF0aW9uTG9naWMiLCJzcHJpbmdDb25maWciLCJkZWNheUNvbmZpZyIsImNlbnRlclNjcm9sbCIsImNlbnRlckluV3JhcHBlciIsIndyYXBwZXJXaWR0aCIsIml0ZW1XaWR0aCIsIm1heFNjcm9sbCIsInRvdGFsSXRlbUNvdW50Iiwib24iLCJ2YWx1ZSIsInBhbkhhbmRsZXJSZWYiLCJjcmVhdGVSZWYiLCJvblVwZGF0ZSIsImlzTW91bnRlZCIsInVwZGF0ZUNlbnRlclNjcm9sbCIsImluZmluaXRlRWxlbWVudFdpZHRoIiwidXBkYXRlSXRlbVdpZHRoIiwidXBkYXRlV3JhcHBlcldpZHRoIiwidXBkYXRlTWF4U2Nyb2xsIiwicmVvcmRlckluZmluaXRlIiwib25SZWFkeSIsImNvbXBvbmVudERpZFVwZGF0ZSIsInByZXZQcm9wcyIsInByZXZTdGF0ZSIsImRpZENoYW5nZSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiZGlzcG9zZSIsImNhbGN1bGF0ZUN1cnJlbnRJbmRleCIsIm1vdmVYVmFsdWUiLCJjZW50ZXIiLCJyb3VuZCIsImdldEN1cnJlbnRJbmRleCIsImdvTmV4dCIsIndpdGhBbmltYXRpb24iLCJpbmRleCIsInNjcm9sbFRvSW5kZXgiLCJnb0JhY2siLCJpdGVtT2Zmc2V0Iiwic2Nyb2xsVG8iLCJzY3JvbGxUb0VsZW1lbnQiLCJmaW5kTmVhcmVzdEluZmluaXRlRWxlbWVudCIsImNvbXBhcmF0b3IiLCJlbGVtZW50cyIsInNvcnQiLCJhIiwiYiIsImFEZWx0YSIsImFicyIsImJEZWx0YSIsIml0ZW0iLCJzY3JvbGxUb0l0ZW0iLCJlbG0iLCJyZW5kZXIiLCJzdHlsZSIsIm9wYWNpdHkiLCJzaW11bHRhbmVvdXNIYW5kbGVycyIsIndhaXRGb3IiLCJnZXN0dXJlSGFuZGxlciIsIm9uV3JhcHBlckxheW91dCIsInRyYW5zZm9ybSIsInRyYW5zbGF0ZVgiLCJwZXJzcGVjdGl2ZSIsIm1hcCIsInJlbmRlckl0ZW0iLCJvbkl0ZW1MYXlvdXQiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU9BLEtBQVAsSUFBZUMsU0FBZixRQUErQixPQUEvQjtBQUdBLE9BQU9DLFFBQVAsTUFBcUIseUJBQXJCO0FBQ0EsU0FBUUMsaUJBQVIsUUFBZ0MsOEJBQWhDO0FBQ0EsT0FBT0MsZUFBUCxNQUE0QixtQkFBNUI7QUFDQSxPQUFPQyxrQkFBUCxNQUErQixzQkFBL0I7QUFDQSxPQUFPQyxZQUFQLE1BQXlCLGdCQUF6QjtBQUNBLE9BQU9DLGNBQVAsTUFBMkIsa0JBQTNCO0FBeUNBLGVBQWUsTUFBTUMsZ0JBQU4sU0FBa0NQLFNBQWxDLENBR2I7QUFPRFEsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWtDO0FBQzVDLFVBQU1B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Q29tcG9uZW50fSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge0xheW91dENoYW5nZUV2ZW50LCBTdHlsZVByb3AsIFZpZXdTdHlsZSwgVmlld30gZnJvbSAncmVhY3QtbmF0aXZlJztcblxuaW1wb3J0IEFuaW1hdGVkIGZyb20gJ3JlYWN0LW5hdGl2ZS1yZWFuaW1hdGVkJztcbmltcG9ydCB7UGFuR2VzdHVyZUhhbmRsZXJ9IGZyb20gJ3JlYWN0LW5hdGl2ZS1nZXN0dXJlLWhhbmRsZXInO1xuaW1wb3J0IEluZmluaXRlRWxlbWVudCBmcm9tICcuL0luZmluaXRlRWxlbWVudCc7XG5pbXBvcnQgSW5maW5pdGVDYWxjdWxhdG9yIGZyb20gJy4vSW5maW5pdGVDYWxjdWxhdG9yJztcbmltcG9ydCBJbmZpbml0ZUl0ZW0gZnJvbSAnLi9JbmZpbml0ZUl0ZW0nO1xuaW1wb3J0IEFuaW1hdGlvbkxvZ2ljIGZyb20gJy4vQW5pbWF0aW9uTG9naWMnO1xuXG5pbnRlcmZhY2UgSW5maW5pdGVTY3JvbGxlclByb3BzPFQ+IHtcblx0ZGF0YXNldChzdGFydDogbnVtYmVyLCBjb3VudDogbnVtYmVyKTogUHJvbWlzZTxUW10+O1xuXHRyZW5kZXJJdGVtOiAoZGF0YTogVCB8IG51bGwpID0+IFJlYWN0LlJlYWN0RWxlbWVudDtcblx0c3R5bGU/OiBTdHlsZVByb3A8Vmlld1N0eWxlPjtcblx0dG90YWxJdGVtQ291bnQ/OiBudW1iZXIgfCBudWxsO1xuXHRjZW50ZXJJbldyYXBwZXI/OiBib29sZWFuIHwgbnVsbDtcblx0c3RhcnRpbmdQb3NpdGlvbj86IG51bWJlciB8IG51bGw7XG5cdG9uU2Nyb2xsRW5kPzogKFxuXHRcdHNjcm9sbFBvc2l0aW9uOiBudW1iZXIsXG5cdFx0ZGF0YTogVCB8IG51bGwsXG5cdFx0c2Nyb2xsZXI6IEluZmluaXRlU2Nyb2xsZXI8VD4sXG5cdCkgPT4gdm9pZCB8IG51bGw7XG5cdGluZmluaXRlRWxlbWVudENvdW50PzogbnVtYmVyIHwgbnVsbDtcblx0d2FpdEZvcj86IFJlYWN0LlJlZk9iamVjdDxhbnk+W107XG5cdHNpbXVsdGFuZW91c0hhbmRsZXJzPzogUmVhY3QuUmVmT2JqZWN0PGFueT5bXTtcblx0c3ByaW5nQ29uZmlnPzogT2JqZWN0O1xuXHRkZWNheUNvbmZpZz86IE9iamVjdDtcblx0aXRlbURpbWVuc2lvbnM/OiB7XG5cdFx0d2lkdGg6IG51bWJlcjtcblx0XHRoZWlnaHQ6IG51bWJlcjtcblx0fSB8IG51bGw7XG5cdHdyYXBwZXJEaW1lbnNpb25zPzoge1xuXHRcdHdpZHRoOiBudW1iZXI7XG5cdFx0aGVpZ2h0OiBudW1iZXI7XG5cdH0gfCBudWxsO1xufVxuXG5pbnRlcmZhY2UgSW5maW5pdGVTY3JvbGxlclN0YXRlIHtcblx0aXRlbUxheW91dDoge1xuXHRcdHdpZHRoOiBudW1iZXI7XG5cdFx0aGVpZ2h0OiBudW1iZXI7XG5cdH07XG5cdHdyYXBwZXJMYXlvdXQ6IHtcblx0XHR3aWR0aDogbnVtYmVyO1xuXHRcdGhlaWdodDogbnVtYmVyO1xuXHR9O1xuXHRyZWFkeTogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSW5maW5pdGVTY3JvbGxlcjxUPiBleHRlbmRzIENvbXBvbmVudDxcblx0SW5maW5pdGVTY3JvbGxlclByb3BzPFQ+LFxuXHRJbmZpbml0ZVNjcm9sbGVyU3RhdGVcbj4ge1xuXHRpbmZpbml0ZUNhbGN1bGF0b3I6IEluZmluaXRlQ2FsY3VsYXRvcjxUPjtcblx0aW5maW5pdGVFbGVtZW50czogSW5maW5pdGVFbGVtZW50PFQ+W10gPSBbXTtcblx0YW5pbWF0aW9uTG9naWM6IEFuaW1hdGlvbkxvZ2ljO1xuXHRjdXJyZW50RWxlbWVudD86IEluZmluaXRlRWxlbWVudDxUPiB8IG51bGw7XG5cdHBhbkhhbmRsZXJSZWY6IFJlYWN0LlJlZk9iamVjdDxQYW5HZXN0dXJlSGFuZGxlcj47XG5cblx0Y29uc3RydWN0b3IocHJvcHM6IEluZmluaXRlU2Nyb2xsZXJQcm9wczxUPikge1xuXHRcdHN1cGVyKHByb3BzKTtcblx0XHR0aGlzLnN0YXRlID0ge1xuXHRcdFx0aXRlbUxheW91dDogcHJvcHMuaXRlbURpbWVuc2lvbnMgfHwge1xuXHRcdFx0XHR3aWR0aDogMCxcblx0XHRcdFx0aGVpZ2h0OiAwLFxuXHRcdFx0fSxcblx0XHRcdHdyYXBwZXJMYXlvdXQ6IHByb3BzLndyYXBwZXJEaW1lbnNpb25zIHx8IHtcblx0XHRcdFx0d2lkdGg6IDAsXG5cdFx0XHRcdGhlaWdodDogMCxcblx0XHRcdH0sXG5cdFx0XHRyZWFkeTogZmFsc2UsXG5cdFx0fTtcblx0XHR0aGlzLmluZmluaXRlRWxlbWVudHMgPSBbXTtcblxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgKHByb3BzLmluZmluaXRlRWxlbWVudENvdW50IHx8IDEwMCk7IGkrKykge1xuXHRcdFx0dGhpcy5pbmZpbml0ZUVsZW1lbnRzLnB1c2gobmV3IEluZmluaXRlRWxlbWVudDxUPigpKTtcblx0XHR9XG5cblx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvciA9IG5ldyBJbmZpbml0ZUNhbGN1bGF0b3Ioe1xuXHRcdFx0Li4ucHJvcHMsXG5cdFx0XHRpbmZpbml0ZUxpbWl0OiBNYXRoLmZsb29yKDIxNDc0ODM2NDUgLyAxMDAwKSxcblx0XHRcdGluZmluaXRlRWxlbWVudHM6IHRoaXMuaW5maW5pdGVFbGVtZW50cyxcblx0XHRcdGNhY2hlU2l6ZTogdGhpcy5pbmZpbml0ZUVsZW1lbnRzLmxlbmd0aCAqIDIsXG5cdFx0fSk7XG5cblx0XHRjb25zdCBzdGFydGluZ1Bvc2l0aW9uID1cblx0XHRcdHByb3BzLnN0YXJ0aW5nUG9zaXRpb24gIT0gbnVsbFxuXHRcdFx0XHQ/IC0xICogcHJvcHMuc3RhcnRpbmdQb3NpdGlvbiAqIHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aFxuXHRcdFx0XHQ6IDA7XG5cblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljID0gQW5pbWF0aW9uTG9naWMoe1xuXHRcdFx0c3ByaW5nQ29uZmlnOiBwcm9wcy5zcHJpbmdDb25maWcgfHwge30sXG5cdFx0XHRkZWNheUNvbmZpZzogcHJvcHMuZGVjYXlDb25maWcgfHwge30sXG5cdFx0XHRjZW50ZXJTY3JvbGw6XG5cdFx0XHRcdHByb3BzLmNlbnRlckluV3JhcHBlciAhPSBudWxsID8gcHJvcHMuY2VudGVySW5XcmFwcGVyIDogZmFsc2UsXG5cdFx0XHR3cmFwcGVyV2lkdGg6IHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aCxcblx0XHRcdGl0ZW1XaWR0aDogdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoLFxuXHRcdFx0bWF4U2Nyb2xsOlxuXHRcdFx0XHR0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGggIT09IDAgJiZcblx0XHRcdFx0cHJvcHMudG90YWxJdGVtQ291bnQgIT0gbnVsbFxuXHRcdFx0XHRcdD8gLTEgKiB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGggKiBwcm9wcy50b3RhbEl0ZW1Db3VudFxuXHRcdFx0XHRcdDogMCxcblx0XHRcdHN0YXJ0aW5nUG9zaXRpb24sXG5cdFx0fSk7XG5cblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLm9uKCdjaGFuZ2UnLCB2YWx1ZSA9PiB7XG5cdFx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvci54ID0gdmFsdWU7XG5cdFx0fSk7XG5cdFx0dGhpcy5hbmltYXRpb25Mb2dpYy5vbignc2Nyb2xsRW5kJywgdGhpcy5vblNjcm9sbEVuZCk7XG5cblx0XHR0aGlzLnBhbkhhbmRsZXJSZWYgPSBSZWFjdC5jcmVhdGVSZWYoKTtcblxuXHRcdHRoaXMub25VcGRhdGUoZmFsc2UpO1xuXG5cdFx0aWYgKHN0YXJ0aW5nUG9zaXRpb24gIT09IDApIHtcblx0XHRcdHRoaXMub25TY3JvbGxFbmQoe3g6IHN0YXJ0aW5nUG9zaXRpb259KTtcblx0XHR9XG5cdH1cblxuXHRvblNjcm9sbEVuZCA9ICh7eH06IHt4OiBudW1iZXJ9KSA9PiB7XG5cdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3IueCA9IHg7XG5cdFx0aWYgKHRoaXMucHJvcHMub25TY3JvbGxFbmQpIHtcblx0XHRcdHggKj0gLTE7XG5cdFx0XHRjb25zb2xlLmxvZygnc2Nyb2xsRW5kOiAnICsgeCk7XG5cdFx0XHR0aGlzLmN1cnJlbnRFbGVtZW50ID0gdGhpcy5pbmZpbml0ZUVsZW1lbnRzLmZpbmQoZWxlbWVudCA9PiB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKGVsZW1lbnQubGVmdCwgeCk7XG5cdFx0XHRcdHJldHVybiBlbGVtZW50LmxlZnQgPT09IHg7XG5cdFx0XHR9KTtcblx0XHRcdGNvbnNvbGUubG9nKCdzY3JvbGxFbmQ6ICcsIHRoaXMuY3VycmVudEVsZW1lbnQpO1xuXHRcdFx0aWYgKHRoaXMuY3VycmVudEVsZW1lbnQgIT0gbnVsbCkge1xuXHRcdFx0XHR0aGlzLnByb3BzLm9uU2Nyb2xsRW5kKFxuXHRcdFx0XHRcdHRoaXMuY3VycmVudEVsZW1lbnQucGhhc2UsXG5cdFx0XHRcdFx0dGhpcy5jdXJyZW50RWxlbWVudC5kYXRhLFxuXHRcdFx0XHRcdHRoaXMsXG5cdFx0XHRcdCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXG5cdFx0XHRcdFx0J0luZmluaXRlU2Nyb2xsZXIgaXMgdW5hYmxlIHRvIGRldGVybWluZSB0aGUgY3VycmVudCBpdGVtIGFmdGVyIHRoZSBzY3JvbGwgZW5kZWQuJyxcblx0XHRcdFx0KTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0b25VcGRhdGUoaXNNb3VudGVkOiBib29sZWFuID0gdHJ1ZSkge1xuXHRcdHRoaXMuYW5pbWF0aW9uTG9naWMudXBkYXRlQ2VudGVyU2Nyb2xsKFxuXHRcdFx0dGhpcy5wcm9wcy5jZW50ZXJJbldyYXBwZXIgIT0gbnVsbFxuXHRcdFx0XHQ/IHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyXG5cdFx0XHRcdDogZmFsc2UsXG5cdFx0KTtcblx0XHRpZiAodGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoICE9PSAwKSB7XG5cdFx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvci5pbmZpbml0ZUVsZW1lbnRXaWR0aCA9IHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aDtcblx0XHRcdHRoaXMuYW5pbWF0aW9uTG9naWMudXBkYXRlSXRlbVdpZHRoKHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aCAhPT0gMCkge1xuXHRcdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3Iud3JhcHBlcldpZHRoID0gdGhpcy5zdGF0ZS53cmFwcGVyTGF5b3V0LndpZHRoO1xuXHRcdFx0dGhpcy5hbmltYXRpb25Mb2dpYy51cGRhdGVXcmFwcGVyV2lkdGgoXG5cdFx0XHRcdHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aCxcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aCAmJiB0aGlzLnByb3BzLnRvdGFsSXRlbUNvdW50ICE9IG51bGwpIHtcblx0XHRcdHRoaXMuYW5pbWF0aW9uTG9naWMudXBkYXRlTWF4U2Nyb2xsKFxuXHRcdFx0XHQtMSAqIHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aCAqIHRoaXMucHJvcHMudG90YWxJdGVtQ291bnQsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLnJlb3JkZXJJbmZpbml0ZSgpO1xuXG5cdFx0dGhpcy5vblJlYWR5KGlzTW91bnRlZCk7XG5cdH1cblxuXHRvblJlYWR5KGlzTW91bnRlZDogYm9vbGVhbiA9IHRydWUpIHtcblx0XHRpZiAodGhpcy5zdGF0ZS5yZWFkeSA9PT0gZmFsc2UpIHtcblx0XHRcdGlmIChcblx0XHRcdFx0dGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoICE9PSAwICYmXG5cdFx0XHRcdHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aCAhPT0gMFxuXHRcdFx0KSB7XG5cdFx0XHRcdGlmIChpc01vdW50ZWQpIHtcblx0XHRcdFx0XHR0aGlzLnNldFN0YXRlKHtcblx0XHRcdFx0XHRcdHJlYWR5OiB0cnVlLFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuc3RhdGUgPSB7XG5cdFx0XHRcdFx0XHQuLi50aGlzLnN0YXRlLFxuXHRcdFx0XHRcdFx0cmVhZHk6IHRydWUsXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGNvbXBvbmVudERpZFVwZGF0ZShcblx0XHRwcmV2UHJvcHM6IEluZmluaXRlU2Nyb2xsZXJQcm9wczxUPixcblx0XHRwcmV2U3RhdGU6IEluZmluaXRlU2Nyb2xsZXJTdGF0ZSxcblx0KSB7XG5cdFx0bGV0IGRpZENoYW5nZSA9IGZhbHNlO1xuXHRcdGRpZENoYW5nZSA9XG5cdFx0XHRkaWRDaGFuZ2UgfHxcblx0XHRcdHByZXZTdGF0ZS5pdGVtTGF5b3V0LndpZHRoICE9PSB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGg7XG5cdFx0ZGlkQ2hhbmdlID1cblx0XHRcdGRpZENoYW5nZSB8fFxuXHRcdFx0cHJldlN0YXRlLndyYXBwZXJMYXlvdXQud2lkdGggIT09IHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aDtcblx0XHRkaWRDaGFuZ2UgPSBkaWRDaGFuZ2UgfHwgcHJldlN0YXRlLnJlYWR5ICE9PSB0aGlzLnN0YXRlLnJlYWR5O1xuXHRcdGRpZENoYW5nZSA9XG5cdFx0XHRkaWRDaGFuZ2UgfHxcblx0XHRcdHByZXZQcm9wcy5jZW50ZXJJbldyYXBwZXIgIT09IHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyO1xuXHRcdGRpZENoYW5nZSA9XG5cdFx0XHRkaWRDaGFuZ2UgfHwgcHJldlByb3BzLnRvdGFsSXRlbUNvdW50ICE9PSB0aGlzLnByb3BzLnRvdGFsSXRlbUNvdW50O1xuXHRcdGlmIChkaWRDaGFuZ2UpIHtcblx0XHRcdHRoaXMub25VcGRhdGUoKTtcblx0XHR9XG5cdH1cblxuXHRjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcblx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvci5kaXNwb3NlKCk7XG5cdH1cblxuXHRjYWxjdWxhdGVDdXJyZW50SW5kZXgobW92ZVhWYWx1ZTogbnVtYmVyKSB7XG5cdFx0Y29uc3QgaXRlbVdpZHRoID0gdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoO1xuXHRcdGNvbnN0IHdyYXBwZXJXaWR0aCA9IHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aDtcblx0XHRjb25zdCBjZW50ZXJJbldyYXBwZXIgPVxuXHRcdFx0dGhpcy5wcm9wcy5jZW50ZXJJbldyYXBwZXIgIT0gbnVsbFxuXHRcdFx0XHQ/IHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyXG5cdFx0XHRcdDogZmFsc2U7XG5cdFx0Y29uc3QgY2VudGVyID0gY2VudGVySW5XcmFwcGVyID8gd3JhcHBlcldpZHRoIC8gMiAtIGl0ZW1XaWR0aCAvIDIgOiAwO1xuXHRcdC8qKlxuXHRcdCAqIFRoZSB2YWx1ZSB3aWxsIGJlIHNsaWdobHkgb2ZmIGJlY2F1c2Ugb3VyIHNuYXAgZW5kIHRocmVzaGhvbGQgaXMgYVxuXHRcdCAqIGJpdCBoaWdoIHRvIGVuc3VyZSBldmVudHMgYXJlIHRyaWdnZXJlZCBpbiBhIHRpbWxleSBtYW5uZXIuXG5cdFx0ICoqL1xuXHRcdHJldHVybiBNYXRoLnJvdW5kKChjZW50ZXIgLSBtb3ZlWFZhbHVlKSAvIGl0ZW1XaWR0aCk7XG5cdH1cblxuXHRnZXRDdXJyZW50SW5kZXgoKSB7XG5cdFx0cmV0dXJuIHRoaXMuY2FsY3VsYXRlQ3VycmVudEluZGV4KHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLngpO1xuXHR9XG5cblx0YXN5bmMgZ29OZXh0KHdpdGhBbmltYXRpb246IGJvb2xlYW4gPSB0cnVlKSB7XG5cdFx0Y29uc3QgaW5kZXggPSB0aGlzLmdldEN1cnJlbnRJbmRleCgpO1xuXHRcdHJldHVybiB0aGlzLnNjcm9sbFRvSW5kZXgoaW5kZXggKyAxLCB3aXRoQW5pbWF0aW9uKTtcblx0fVxuXG5cdGFzeW5jIGdvQmFjayh3aXRoQW5pbWF0aW9uOiBib29sZWFuID0gdHJ1ZSkge1xuXHRcdGNvbnN0IGluZGV4ID0gdGhpcy5nZXRDdXJyZW50SW5kZXgoKTtcblx0XHRyZXR1cm4gdGhpcy5zY3JvbGxUb0luZGV4KGluZGV4IC0gMSwgd2l0aEFuaW1hdGlvbik7XG5cdH1cblxuXHRzY3JvbGxUb0luZGV4KGl0ZW1PZmZzZXQ6IG51bWJlciwgd2l0aEFuaW1hdGlvbjogYm9vbGVhbiA9IHRydWUpIHtcblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnNjcm9sbFRvKFxuXHRcdFx0LTEgKiBpdGVtT2Zmc2V0ICogdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoLFxuXHRcdFx0d2l0aEFuaW1hdGlvbixcblx0XHQpO1xuXHR9XG5cblx0c2Nyb2xsVG9FbGVtZW50KGVsZW1lbnQ6IEluZmluaXRlRWxlbWVudDxUPiwgd2l0aEFuaW1hdGlvbj86IGJvb2xlYW4pIHtcblx0XHRyZXR1cm4gdGhpcy5zY3JvbGxUb0luZGV4KGVsZW1lbnQucGhhc2UsIHdpdGhBbmltYXRpb24pO1xuXHR9XG5cblx0ZmluZE5lYXJlc3RJbmZpbml0ZUVsZW1lbnQoXG5cdFx0Y29tcGFyYXRvcjogKGl0ZW06IEluZmluaXRlRWxlbWVudDxUPikgPT4gYm9vbGVhbixcblx0KTogSW5maW5pdGVFbGVtZW50PFQ+IHwgdW5kZWZpbmVkIHtcblx0XHRjb25zdCB4ID0gLTEgKiB0aGlzLmluZmluaXRlQ2FsY3VsYXRvci54O1xuXHRcdGxldCBlbGVtZW50cyA9IFsuLi50aGlzLmluZmluaXRlRWxlbWVudHNdLnNvcnQoKGEsIGIpID0+IHtcblx0XHRcdGNvbnN0IGFEZWx0YSA9IE1hdGguYWJzKHggLSBhLmxlZnQpO1xuXHRcdFx0Y29uc3QgYkRlbHRhID0gTWF0aC5hYnMoeCAtIGIubGVmdCk7XG5cdFx0XHRyZXR1cm4gYURlbHRhIC0gYkRlbHRhO1xuXHRcdH0pO1xuXHRcdHJldHVybiBlbGVtZW50cy5maW5kKGl0ZW0gPT4gY29tcGFyYXRvcihpdGVtKSk7XG5cdH1cblxuXHRzY3JvbGxUb0l0ZW0oXG5cdFx0Y29tcGFyYXRvcjogKGl0ZW06IFQgfCBudWxsKSA9PiBib29sZWFuLFxuXHRcdHdpdGhBbmltYXRpb24/OiBib29sZWFuLFxuXHQpIHtcblx0XHRjb25zdCBlbGVtZW50ID0gdGhpcy5maW5kTmVhcmVzdEluZmluaXRlRWxlbWVudChlbG0gPT5cblx0XHRcdGVsbS5kYXRhICE9IG51bGwgPyBjb21wYXJhdG9yKGVsbS5kYXRhKSA6IGZhbHNlLFxuXHRcdCk7XG5cblx0XHRpZiAoZWxlbWVudCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuc2Nyb2xsVG9FbGVtZW50KGVsZW1lbnQsIHdpdGhBbmltYXRpb24pO1xuXHRcdH1cblx0fVxuXG5cdG9uSXRlbUxheW91dCA9ICh7XG5cdFx0bmF0aXZlRXZlbnQ6IHtcblx0XHRcdGxheW91dDoge3dpZHRoLCBoZWlnaHR9LFxuXHRcdH0sXG5cdH06IExheW91dENoYW5nZUV2ZW50KSA9PiB7XG5cdFx0Y29uc3Qge2l0ZW1MYXlvdXR9ID0gdGhpcy5zdGF0ZTtcblx0XHRpZiAoaXRlbUxheW91dC53aWR0aCAhPT0gd2lkdGggfHwgaXRlbUxheW91dC5oZWlnaHQgIT09IGhlaWdodCkge1xuXHRcdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdGl0ZW1MYXlvdXQ6IHt3aWR0aCwgaGVpZ2h0fSxcblx0XHRcdH0pO1xuXHRcdH1cblx0fTtcblxuXHRvbldyYXBwZXJMYXlvdXQgPSAoe1xuXHRcdG5hdGl2ZUV2ZW50OiB7XG5cdFx0XHRsYXlvdXQ6IHt3aWR0aCwgaGVpZ2h0fSxcblx0XHR9LFxuXHR9OiBMYXlvdXRDaGFuZ2VFdmVudCkgPT4ge1xuXHRcdGNvbnN0IHt3cmFwcGVyTGF5b3V0fSA9IHRoaXMuc3RhdGU7XG5cdFx0aWYgKHdyYXBwZXJMYXlvdXQud2lkdGggIT09IHdpZHRoIHx8IHdyYXBwZXJMYXlvdXQuaGVpZ2h0ICE9PSBoZWlnaHQpIHtcblx0XHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0XHR3cmFwcGVyTGF5b3V0OiB7d2lkdGgsIGhlaWdodH0sXG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0cmVuZGVyKCkge1xuXHRcdGNvbnN0IHN0eWxlID0ge1xuXHRcdFx0aGVpZ2h0OiB0aGlzLnN0YXRlLml0ZW1MYXlvdXQuaGVpZ2h0LFxuXHRcdFx0b3BhY2l0eTogdGhpcy5zdGF0ZS5yZWFkeSA/IDEgOiAwLFxuXHRcdH07XG5cdFx0cmV0dXJuIChcblx0XHRcdDxQYW5HZXN0dXJlSGFuZGxlclxuXHRcdFx0XHRyZWY9e3RoaXMucGFuSGFuZGxlclJlZn1cblx0XHRcdFx0c2ltdWx0YW5lb3VzSGFuZGxlcnM9e3RoaXMucHJvcHMuc2ltdWx0YW5lb3VzSGFuZGxlcnN9XG5cdFx0XHRcdHdhaXRGb3I9e3RoaXMucHJvcHMud2FpdEZvcn1cblx0XHRcdFx0b25HZXN0dXJlRXZlbnQ9e3RoaXMuYW5pbWF0aW9uTG9naWMuZ2VzdHVyZUhhbmRsZXJ9XG5cdFx0XHRcdG9uSGFuZGxlclN0YXRlQ2hhbmdlPXt0aGlzLmFuaW1hdGlvbkxvZ2ljLmdlc3R1cmVIYW5kbGVyfT5cblx0XHRcdFx0PEFuaW1hdGVkLlZpZXdcblx0XHRcdFx0XHRzdHlsZT17W3RoaXMucHJvcHMuc3R5bGUsIHN0eWxlXX1cblx0XHRcdFx0XHRvbkxheW91dD17dGhpcy5vbldyYXBwZXJMYXlvdXR9PlxuXHRcdFx0XHRcdDxBbmltYXRlZC5WaWV3XG5cdFx0XHRcdFx0XHRzdHlsZT17e1xuXHRcdFx0XHRcdFx0XHR0cmFuc2Zvcm06IFtcblx0XHRcdFx0XHRcdFx0XHR7dHJhbnNsYXRlWDogdGhpcy5hbmltYXRpb25Mb2dpYy54fSxcblx0XHRcdFx0XHRcdFx0XHR7cGVyc3BlY3RpdmU6IDEwMDB9LCAvLyB3aXRob3V0IHRoaXMgbGluZSB0aGlzIEFuaW1hdGlvbiB3aWxsIG5vdCByZW5kZXIgb24gQW5kcm9pZCB3aGlsZSB3b3JraW5nIGZpbmUgb24gaU9TXG5cdFx0XHRcdFx0XHRcdF0sXG5cdFx0XHRcdFx0XHR9fT5cblx0XHRcdFx0XHRcdHt0aGlzLmluZmluaXRlRWxlbWVudHMubWFwKChpdGVtLCBpKSA9PiB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiAoXG5cdFx0XHRcdFx0XHRcdFx0PEluZmluaXRlSXRlbTxUPlxuXHRcdFx0XHRcdFx0XHRcdFx0ZWxlbWVudEluZGV4PXtpfVxuXHRcdFx0XHRcdFx0XHRcdFx0cmVuZGVySXRlbT17dGhpcy5wcm9wcy5yZW5kZXJJdGVtfVxuXHRcdFx0XHRcdFx0XHRcdFx0aXRlbT17aXRlbX1cblx0XHRcdFx0XHRcdFx0XHRcdGtleT17aX1cblx0XHRcdFx0XHRcdFx0XHRcdG9uTGF5b3V0PXtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aSA9PT0gMCA/IHRoaXMub25JdGVtTGF5b3V0IDogbnVsbFxuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdC8+XG5cdFx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0XHR9KX1cblx0XHRcdFx0XHQ8L0FuaW1hdGVkLlZpZXc+XG5cdFx0XHRcdDwvQW5pbWF0ZWQuVmlldz5cblx0XHRcdDwvUGFuR2VzdHVyZUhhbmRsZXI+XG5cdFx0KTtcblx0fVxufVxuIl19