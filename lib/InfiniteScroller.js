function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

import React, { Component } from 'react';
import Animated from 'react-native-reanimated';
import { PanGestureHandler } from 'react-native-gesture-handler';
import InfiniteElement from './InfiniteElement';
import InfiniteCalculator from './InfiniteCalculator';
import InfiniteItem from './InfiniteItem';
import AnimationLogic from './AnimationLogic';
export default class InfiniteScroller extends Component {
  constructor(props) {
    super(props);

    _defineProperty(this, "infiniteCalculator", void 0);

    _defineProperty(this, "infiniteElements", []);

    _defineProperty(this, "animationLogic", void 0);

    _defineProperty(this, "currentElement", void 0);

    _defineProperty(this, "panHandlerRef", void 0);

    _defineProperty(this, "onScrollEnd", ({
      x
    }) => {
      this.infiniteCalculator.x = x;

      if (this.props.onScrollEnd) {
        x *= -1;
        this.currentElement = this.infiniteElements.find(element => {
          return element.left === x;
        });

        if (this.currentElement != null) {
          this.props.onScrollEnd(this.currentElement.phase, this.currentElement.data, this);
        } else {
          console.warn('InfiniteScroller is unable to determine the current item after the scroll ended.');
        }
      }
    });

    _defineProperty(this, "onItemLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        itemLayout
      } = this.state;

      if (itemLayout.width !== width || itemLayout.height !== height) {
        this.setState({
          itemLayout: {
            width,
            height
          }
        });
      }
    });

    _defineProperty(this, "onWrapperLayout", ({
      nativeEvent: {
        layout: {
          width,
          height
        }
      }
    }) => {
      const {
        wrapperLayout
      } = this.state;

      if (wrapperLayout.width !== width || wrapperLayout.height !== height) {
        this.setState({
          wrapperLayout: {
            width,
            height
          }
        });
      }
    });

    this.state = {
      itemLayout: props.itemDimensions || {
        width: 0,
        height: 0
      },
      wrapperLayout: props.wrapperDimensions || {
        width: 0,
        height: 0
      },
      ready: false
    };
    this.infiniteElements = [];

    for (let i = 0; i < (props.infiniteElementCount || 100); i++) {
      this.infiniteElements.push(new InfiniteElement());
    }

    this.infiniteCalculator = new InfiniteCalculator(_objectSpread(_objectSpread({}, props), {}, {
      infiniteLimit: Math.floor(2147483645 / 1000),
      infiniteElements: this.infiniteElements,
      cacheSize: this.infiniteElements.length * 2
    }));
    const startingPosition = props.startingPosition != null ? -1 * props.startingPosition * this.state.itemLayout.width : 0;
    this.animationLogic = AnimationLogic({
      springConfig: props.springConfig || {},
      decayConfig: props.decayConfig || {},
      centerScroll: props.centerInWrapper != null ? props.centerInWrapper : false,
      wrapperWidth: this.state.wrapperLayout.width,
      itemWidth: this.state.itemLayout.width,
      maxScroll: this.state.itemLayout.width !== 0 && props.totalItemCount != null ? -1 * this.state.itemLayout.width * (props.totalItemCount - 1) : 0,
      startingPosition
    });
    this.animationLogic.on('change', value => {
      this.infiniteCalculator.x = value;
    });
    this.animationLogic.on('scrollEnd', this.onScrollEnd);
    this.panHandlerRef = React.createRef();
    this.onUpdate(false);

    if (startingPosition !== 0) {
      this.onScrollEnd({
        x: startingPosition
      });
    }
  }

  onUpdate(isMounted = true) {
    this.animationLogic.updateCenterScroll(this.props.centerInWrapper != null ? this.props.centerInWrapper : false);

    if (this.state.itemLayout.width !== 0) {
      this.infiniteCalculator.infiniteElementWidth = this.state.itemLayout.width;
      this.animationLogic.updateItemWidth(this.state.itemLayout.width);
    }

    if (this.state.wrapperLayout.width !== 0) {
      this.infiniteCalculator.wrapperWidth = this.state.wrapperLayout.width;
      this.animationLogic.updateWrapperWidth(this.state.wrapperLayout.width);
    }

    if (this.state.itemLayout.width && this.props.totalItemCount != null) {
      this.animationLogic.updateMaxScroll(-1 * this.state.itemLayout.width * (this.props.totalItemCount - 1));
    }

    this.infiniteCalculator.reorderInfinite();
    this.onReady(isMounted);
  }

  onReady(isMounted = true) {
    if (this.state.ready === false) {
      if (this.state.itemLayout.width !== 0 && this.state.wrapperLayout.width !== 0) {
        if (isMounted) {
          this.setState({
            ready: true
          });
        } else {
          this.state = _objectSpread(_objectSpread({}, this.state), {}, {
            ready: true
          });
        }
      }
    }
  }

  componentDidUpdate(prevProps, prevState) {
    let didChange = false;
    didChange = didChange || prevState.itemLayout.width !== this.state.itemLayout.width;
    didChange = didChange || prevState.wrapperLayout.width !== this.state.wrapperLayout.width;
    didChange = didChange || prevState.ready !== this.state.ready;
    didChange = didChange || prevProps.centerInWrapper !== this.props.centerInWrapper;
    didChange = didChange || prevProps.totalItemCount !== this.props.totalItemCount;

    if (didChange) {
      this.onUpdate();
    }

    if (prevProps.dataset !== this.props.dataset) {
      console.log('refresh dataset');
      this.datasetNeedsRefresh();
    }
  }

  datasetNeedsRefresh() {
    this.infiniteCalculator.updateDataset(this.props.dataset);
  }

  componentWillUnmount() {
    this.infiniteCalculator.dispose();
  }

  calculateCurrentIndex(moveXValue) {
    const itemWidth = this.state.itemLayout.width;
    const wrapperWidth = this.state.wrapperLayout.width;
    const centerInWrapper = this.props.centerInWrapper != null ? this.props.centerInWrapper : false;
    const center = centerInWrapper ? wrapperWidth / 2 - itemWidth / 2 : 0;
    /**
     * The value will be slighly off because our snap end threshhold is a
     * bit high to ensure events are triggered in a timley manner.
     **/

    return Math.round((center - moveXValue) / itemWidth);
  }

  getCurrentIndex() {
    return this.calculateCurrentIndex(this.infiniteCalculator.x);
  }

  async goNext(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollToIndex(index + 1, withAnimation);
  }

  async goBack(withAnimation = true) {
    const index = this.getCurrentIndex();
    return this.scrollToIndex(index - 1, withAnimation);
  }

  scrollToIndex(itemOffset, withAnimation = true) {
    this.animationLogic.scrollTo(-1 * itemOffset * this.state.itemLayout.width, withAnimation);
  }

  scrollToElement(element, withAnimation) {
    return this.scrollToIndex(element.phase, withAnimation);
  }

  findNearestInfiniteElement(comparator) {
    const x = -1 * this.infiniteCalculator.x;
    let elements = [...this.infiniteElements].sort((a, b) => {
      const aDelta = Math.abs(x - a.left);
      const bDelta = Math.abs(x - b.left);
      return aDelta - bDelta;
    });
    return elements.find(item => comparator(item));
  }

  scrollToItem(comparator, withAnimation) {
    const element = this.findNearestInfiniteElement(elm => elm.data != null ? comparator(elm.data) : false);

    if (element) {
      return this.scrollToElement(element, withAnimation);
    }
  }

  render() {
    const style = {
      height: this.state.itemLayout.height,
      opacity: this.state.ready ? 1 : 0
    };
    return <PanGestureHandler ref={this.panHandlerRef} simultaneousHandlers={this.props.simultaneousHandlers} waitFor={this.props.waitFor} onGestureEvent={this.animationLogic.gestureHandler} onHandlerStateChange={this.animationLogic.gestureHandler}>
				<Animated.View style={[this.props.style, style]} onLayout={this.onWrapperLayout}>
					<Animated.View style={{
          transform: [{
            translateX: this.animationLogic.x
          }, {
            perspective: 1000
          } // without this line this Animation will not render on Android while working fine on iOS
          ]
        }}>
						{this.infiniteElements.map((item, i) => {
            return <InfiniteItem elementIndex={i} renderItem={this.props.renderItem} item={item} key={i} onLayout={i === 0 ? this.onItemLayout : null} />;
          })}
					</Animated.View>
				</Animated.View>
			</PanGestureHandler>;
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9JbmZpbml0ZVNjcm9sbGVyLnRzeCJdLCJuYW1lcyI6WyJSZWFjdCIsIkNvbXBvbmVudCIsIkFuaW1hdGVkIiwiUGFuR2VzdHVyZUhhbmRsZXIiLCJJbmZpbml0ZUVsZW1lbnQiLCJJbmZpbml0ZUNhbGN1bGF0b3IiLCJJbmZpbml0ZUl0ZW0iLCJBbmltYXRpb25Mb2dpYyIsIkluZmluaXRlU2Nyb2xsZXIiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwieCIsImluZmluaXRlQ2FsY3VsYXRvciIsIm9uU2Nyb2xsRW5kIiwiY3VycmVudEVsZW1lbnQiLCJpbmZpbml0ZUVsZW1lbnRzIiwiZmluZCIsImVsZW1lbnQiLCJsZWZ0IiwicGhhc2UiLCJkYXRhIiwiY29uc29sZSIsIndhcm4iLCJuYXRpdmVFdmVudCIsImxheW91dCIsIndpZHRoIiwiaGVpZ2h0IiwiaXRlbUxheW91dCIsInN0YXRlIiwic2V0U3RhdGUiLCJ3cmFwcGVyTGF5b3V0IiwiaXRlbURpbWVuc2lvbnMiLCJ3cmFwcGVyRGltZW5zaW9ucyIsInJlYWR5IiwiaSIsImluZmluaXRlRWxlbWVudENvdW50IiwicHVzaCIsImluZmluaXRlTGltaXQiLCJNYXRoIiwiZmxvb3IiLCJjYWNoZVNpemUiLCJsZW5ndGgiLCJzdGFydGluZ1Bvc2l0aW9uIiwiYW5pbWF0aW9uTG9naWMiLCJzcHJpbmdDb25maWciLCJkZWNheUNvbmZpZyIsImNlbnRlclNjcm9sbCIsImNlbnRlckluV3JhcHBlciIsIndyYXBwZXJXaWR0aCIsIml0ZW1XaWR0aCIsIm1heFNjcm9sbCIsInRvdGFsSXRlbUNvdW50Iiwib24iLCJ2YWx1ZSIsInBhbkhhbmRsZXJSZWYiLCJjcmVhdGVSZWYiLCJvblVwZGF0ZSIsImlzTW91bnRlZCIsInVwZGF0ZUNlbnRlclNjcm9sbCIsImluZmluaXRlRWxlbWVudFdpZHRoIiwidXBkYXRlSXRlbVdpZHRoIiwidXBkYXRlV3JhcHBlcldpZHRoIiwidXBkYXRlTWF4U2Nyb2xsIiwicmVvcmRlckluZmluaXRlIiwib25SZWFkeSIsImNvbXBvbmVudERpZFVwZGF0ZSIsInByZXZQcm9wcyIsInByZXZTdGF0ZSIsImRpZENoYW5nZSIsImRhdGFzZXQiLCJsb2ciLCJkYXRhc2V0TmVlZHNSZWZyZXNoIiwidXBkYXRlRGF0YXNldCIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiZGlzcG9zZSIsImNhbGN1bGF0ZUN1cnJlbnRJbmRleCIsIm1vdmVYVmFsdWUiLCJjZW50ZXIiLCJyb3VuZCIsImdldEN1cnJlbnRJbmRleCIsImdvTmV4dCIsIndpdGhBbmltYXRpb24iLCJpbmRleCIsInNjcm9sbFRvSW5kZXgiLCJnb0JhY2siLCJpdGVtT2Zmc2V0Iiwic2Nyb2xsVG8iLCJzY3JvbGxUb0VsZW1lbnQiLCJmaW5kTmVhcmVzdEluZmluaXRlRWxlbWVudCIsImNvbXBhcmF0b3IiLCJlbGVtZW50cyIsInNvcnQiLCJhIiwiYiIsImFEZWx0YSIsImFicyIsImJEZWx0YSIsIml0ZW0iLCJzY3JvbGxUb0l0ZW0iLCJlbG0iLCJyZW5kZXIiLCJzdHlsZSIsIm9wYWNpdHkiLCJzaW11bHRhbmVvdXNIYW5kbGVycyIsIndhaXRGb3IiLCJnZXN0dXJlSGFuZGxlciIsIm9uV3JhcHBlckxheW91dCIsInRyYW5zZm9ybSIsInRyYW5zbGF0ZVgiLCJwZXJzcGVjdGl2ZSIsIm1hcCIsInJlbmRlckl0ZW0iLCJvbkl0ZW1MYXlvdXQiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU9BLEtBQVAsSUFBZUMsU0FBZixRQUErQixPQUEvQjtBQUdBLE9BQU9DLFFBQVAsTUFBcUIseUJBQXJCO0FBQ0EsU0FBUUMsaUJBQVIsUUFBZ0MsOEJBQWhDO0FBQ0EsT0FBT0MsZUFBUCxNQUE0QixtQkFBNUI7QUFDQSxPQUFPQyxrQkFBUCxNQUErQixzQkFBL0I7QUFDQSxPQUFPQyxZQUFQLE1BQXlCLGdCQUF6QjtBQUNBLE9BQU9DLGNBQVAsTUFBMkIsa0JBQTNCO0FBeUNBLGVBQWUsTUFBTUMsZ0JBQU4sU0FBa0NQLFNBQWxDLENB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S0FBSzhFLFlBQWYsR0FBOEIsSUFEdEIsQ0FMVixHQUREO0FBV0EsV0FaQSxDQUFEO0FBYU4sS0FBSyxFQUFFLFNBQVMsSUFBWDtBQUNMLElBQUksRUFBRSxTQUFTLElBQVg7QUFDSixHQUFHLEVBQUUsaUJBQUYsQ0FoQ0Q7QUFrQ0E7O0FBN1NBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7Q29tcG9uZW50fSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge0xheW91dENoYW5nZUV2ZW50LCBTdHlsZVByb3AsIFZpZXdTdHlsZSwgVmlld30gZnJvbSAncmVhY3QtbmF0aXZlJztcblxuaW1wb3J0IEFuaW1hdGVkIGZyb20gJ3JlYWN0LW5hdGl2ZS1yZWFuaW1hdGVkJztcbmltcG9ydCB7UGFuR2VzdHVyZUhhbmRsZXJ9IGZyb20gJ3JlYWN0LW5hdGl2ZS1nZXN0dXJlLWhhbmRsZXInO1xuaW1wb3J0IEluZmluaXRlRWxlbWVudCBmcm9tICcuL0luZmluaXRlRWxlbWVudCc7XG5pbXBvcnQgSW5maW5pdGVDYWxjdWxhdG9yIGZyb20gJy4vSW5maW5pdGVDYWxjdWxhdG9yJztcbmltcG9ydCBJbmZpbml0ZUl0ZW0gZnJvbSAnLi9JbmZpbml0ZUl0ZW0nO1xuaW1wb3J0IEFuaW1hdGlvbkxvZ2ljIGZyb20gJy4vQW5pbWF0aW9uTG9naWMnO1xuXG5pbnRlcmZhY2UgSW5maW5pdGVTY3JvbGxlclByb3BzPFQ+IHtcblx0ZGF0YXNldChzdGFydDogbnVtYmVyLCBjb3VudDogbnVtYmVyKTogUHJvbWlzZTxUW10+O1xuXHRyZW5kZXJJdGVtOiAoZGF0YTogVCB8IG51bGwpID0+IFJlYWN0LlJlYWN0RWxlbWVudDtcblx0c3R5bGU/OiBTdHlsZVByb3A8Vmlld1N0eWxlPjtcblx0dG90YWxJdGVtQ291bnQ/OiBudW1iZXIgfCBudWxsO1xuXHRjZW50ZXJJbldyYXBwZXI/OiBib29sZWFuIHwgbnVsbDtcblx0c3RhcnRpbmdQb3NpdGlvbj86IG51bWJlciB8IG51bGw7XG5cdG9uU2Nyb2xsRW5kPzogKFxuXHRcdHNjcm9sbFBvc2l0aW9uOiBudW1iZXIsXG5cdFx0ZGF0YTogVCB8IG51bGwsXG5cdFx0c2Nyb2xsZXI6IEluZmluaXRlU2Nyb2xsZXI8VD4sXG5cdCkgPT4gdm9pZCB8IG51bGw7XG5cdGluZmluaXRlRWxlbWVudENvdW50PzogbnVtYmVyIHwgbnVsbDtcblx0d2FpdEZvcj86IFJlYWN0LlJlZk9iamVjdDxhbnk+W107XG5cdHNpbXVsdGFuZW91c0hhbmRsZXJzPzogUmVhY3QuUmVmT2JqZWN0PGFueT5bXTtcblx0c3ByaW5nQ29uZmlnPzogT2JqZWN0O1xuXHRkZWNheUNvbmZpZz86IE9iamVjdDtcblx0aXRlbURpbWVuc2lvbnM/OiB7XG5cdFx0d2lkdGg6IG51bWJlcjtcblx0XHRoZWlnaHQ6IG51bWJlcjtcblx0fSB8IG51bGw7XG5cdHdyYXBwZXJEaW1lbnNpb25zPzoge1xuXHRcdHdpZHRoOiBudW1iZXI7XG5cdFx0aGVpZ2h0OiBudW1iZXI7XG5cdH0gfCBudWxsO1xufVxuXG5pbnRlcmZhY2UgSW5maW5pdGVTY3JvbGxlclN0YXRlIHtcblx0aXRlbUxheW91dDoge1xuXHRcdHdpZHRoOiBudW1iZXI7XG5cdFx0aGVpZ2h0OiBudW1iZXI7XG5cdH07XG5cdHdyYXBwZXJMYXlvdXQ6IHtcblx0XHR3aWR0aDogbnVtYmVyO1xuXHRcdGhlaWdodDogbnVtYmVyO1xuXHR9O1xuXHRyZWFkeTogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSW5maW5pdGVTY3JvbGxlcjxUPiBleHRlbmRzIENvbXBvbmVudDxcblx0SW5maW5pdGVTY3JvbGxlclByb3BzPFQ+LFxuXHRJbmZpbml0ZVNjcm9sbGVyU3RhdGVcbj4ge1xuXHRpbmZpbml0ZUNhbGN1bGF0b3I6IEluZmluaXRlQ2FsY3VsYXRvcjxUPjtcblx0aW5maW5pdGVFbGVtZW50czogSW5maW5pdGVFbGVtZW50PFQ+W10gPSBbXTtcblx0YW5pbWF0aW9uTG9naWM6IEFuaW1hdGlvbkxvZ2ljO1xuXHRjdXJyZW50RWxlbWVudD86IEluZmluaXRlRWxlbWVudDxUPiB8IG51bGw7XG5cdHBhbkhhbmRsZXJSZWY6IFJlYWN0LlJlZk9iamVjdDxQYW5HZXN0dXJlSGFuZGxlcj47XG5cblx0Y29uc3RydWN0b3IocHJvcHM6IEluZmluaXRlU2Nyb2xsZXJQcm9wczxUPikge1xuXHRcdHN1cGVyKHByb3BzKTtcblx0XHR0aGlzLnN0YXRlID0ge1xuXHRcdFx0aXRlbUxheW91dDogcHJvcHMuaXRlbURpbWVuc2lvbnMgfHwge1xuXHRcdFx0XHR3aWR0aDogMCxcblx0XHRcdFx0aGVpZ2h0OiAwLFxuXHRcdFx0fSxcblx0XHRcdHdyYXBwZXJMYXlvdXQ6IHByb3BzLndyYXBwZXJEaW1lbnNpb25zIHx8IHtcblx0XHRcdFx0d2lkdGg6IDAsXG5cdFx0XHRcdGhlaWdodDogMCxcblx0XHRcdH0sXG5cdFx0XHRyZWFkeTogZmFsc2UsXG5cdFx0fTtcblx0XHR0aGlzLmluZmluaXRlRWxlbWVudHMgPSBbXTtcblxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgKHByb3BzLmluZmluaXRlRWxlbWVudENvdW50IHx8IDEwMCk7IGkrKykge1xuXHRcdFx0dGhpcy5pbmZpbml0ZUVsZW1lbnRzLnB1c2gobmV3IEluZmluaXRlRWxlbWVudDxUPigpKTtcblx0XHR9XG5cblx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvciA9IG5ldyBJbmZpbml0ZUNhbGN1bGF0b3Ioe1xuXHRcdFx0Li4ucHJvcHMsXG5cdFx0XHRpbmZpbml0ZUxpbWl0OiBNYXRoLmZsb29yKDIxNDc0ODM2NDUgLyAxMDAwKSxcblx0XHRcdGluZmluaXRlRWxlbWVudHM6IHRoaXMuaW5maW5pdGVFbGVtZW50cyxcblx0XHRcdGNhY2hlU2l6ZTogdGhpcy5pbmZpbml0ZUVsZW1lbnRzLmxlbmd0aCAqIDIsXG5cdFx0fSk7XG5cblx0XHRjb25zdCBzdGFydGluZ1Bvc2l0aW9uID1cblx0XHRcdHByb3BzLnN0YXJ0aW5nUG9zaXRpb24gIT0gbnVsbFxuXHRcdFx0XHQ/IC0xICogcHJvcHMuc3RhcnRpbmdQb3NpdGlvbiAqIHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aFxuXHRcdFx0XHQ6IDA7XG5cblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljID0gQW5pbWF0aW9uTG9naWMoe1xuXHRcdFx0c3ByaW5nQ29uZmlnOiBwcm9wcy5zcHJpbmdDb25maWcgfHwge30sXG5cdFx0XHRkZWNheUNvbmZpZzogcHJvcHMuZGVjYXlDb25maWcgfHwge30sXG5cdFx0XHRjZW50ZXJTY3JvbGw6XG5cdFx0XHRcdHByb3BzLmNlbnRlckluV3JhcHBlciAhPSBudWxsID8gcHJvcHMuY2VudGVySW5XcmFwcGVyIDogZmFsc2UsXG5cdFx0XHR3cmFwcGVyV2lkdGg6IHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aCxcblx0XHRcdGl0ZW1XaWR0aDogdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoLFxuXHRcdFx0bWF4U2Nyb2xsOlxuXHRcdFx0XHR0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGggIT09IDAgJiZcblx0XHRcdFx0cHJvcHMudG90YWxJdGVtQ291bnQgIT0gbnVsbFxuXHRcdFx0XHRcdD8gLTEgKiB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGggKiAocHJvcHMudG90YWxJdGVtQ291bnQgLSAxKVxuXHRcdFx0XHRcdDogMCxcblx0XHRcdHN0YXJ0aW5nUG9zaXRpb24sXG5cdFx0fSk7XG5cblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLm9uKCdjaGFuZ2UnLCB2YWx1ZSA9PiB7XG5cdFx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvci54ID0gdmFsdWU7XG5cdFx0fSk7XG5cdFx0dGhpcy5hbmltYXRpb25Mb2dpYy5vbignc2Nyb2xsRW5kJywgdGhpcy5vblNjcm9sbEVuZCk7XG5cblx0XHR0aGlzLnBhbkhhbmRsZXJSZWYgPSBSZWFjdC5jcmVhdGVSZWYoKTtcblxuXHRcdHRoaXMub25VcGRhdGUoZmFsc2UpO1xuXG5cdFx0aWYgKHN0YXJ0aW5nUG9zaXRpb24gIT09IDApIHtcblx0XHRcdHRoaXMub25TY3JvbGxFbmQoe3g6IHN0YXJ0aW5nUG9zaXRpb259KTtcblx0XHR9XG5cdH1cblxuXHRvblNjcm9sbEVuZCA9ICh7eH06IHt4OiBudW1iZXJ9KSA9PiB7XG5cdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3IueCA9IHg7XG5cdFx0aWYgKHRoaXMucHJvcHMub25TY3JvbGxFbmQpIHtcblx0XHRcdHggKj0gLTE7XG5cdFx0XHR0aGlzLmN1cnJlbnRFbGVtZW50ID0gdGhpcy5pbmZpbml0ZUVsZW1lbnRzLmZpbmQoZWxlbWVudCA9PiB7XG5cdFx0XHRcdHJldHVybiBlbGVtZW50LmxlZnQgPT09IHg7XG5cdFx0XHR9KTtcblx0XHRcdGlmICh0aGlzLmN1cnJlbnRFbGVtZW50ICE9IG51bGwpIHtcblx0XHRcdFx0dGhpcy5wcm9wcy5vblNjcm9sbEVuZChcblx0XHRcdFx0XHR0aGlzLmN1cnJlbnRFbGVtZW50LnBoYXNlLFxuXHRcdFx0XHRcdHRoaXMuY3VycmVudEVsZW1lbnQuZGF0YSxcblx0XHRcdFx0XHR0aGlzLFxuXHRcdFx0XHQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFxuXHRcdFx0XHRcdCdJbmZpbml0ZVNjcm9sbGVyIGlzIHVuYWJsZSB0byBkZXRlcm1pbmUgdGhlIGN1cnJlbnQgaXRlbSBhZnRlciB0aGUgc2Nyb2xsIGVuZGVkLicsXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdG9uVXBkYXRlKGlzTW91bnRlZDogYm9vbGVhbiA9IHRydWUpIHtcblx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnVwZGF0ZUNlbnRlclNjcm9sbChcblx0XHRcdHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyICE9IG51bGxcblx0XHRcdFx0PyB0aGlzLnByb3BzLmNlbnRlckluV3JhcHBlclxuXHRcdFx0XHQ6IGZhbHNlLFxuXHRcdCk7XG5cdFx0aWYgKHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aCAhPT0gMCkge1xuXHRcdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3IuaW5maW5pdGVFbGVtZW50V2lkdGggPSB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGg7XG5cdFx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnVwZGF0ZUl0ZW1XaWR0aCh0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGgpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnN0YXRlLndyYXBwZXJMYXlvdXQud2lkdGggIT09IDApIHtcblx0XHRcdHRoaXMuaW5maW5pdGVDYWxjdWxhdG9yLndyYXBwZXJXaWR0aCA9IHRoaXMuc3RhdGUud3JhcHBlckxheW91dC53aWR0aDtcblx0XHRcdHRoaXMuYW5pbWF0aW9uTG9naWMudXBkYXRlV3JhcHBlcldpZHRoKFxuXHRcdFx0XHR0aGlzLnN0YXRlLndyYXBwZXJMYXlvdXQud2lkdGgsXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGggJiYgdGhpcy5wcm9wcy50b3RhbEl0ZW1Db3VudCAhPSBudWxsKSB7XG5cdFx0XHR0aGlzLmFuaW1hdGlvbkxvZ2ljLnVwZGF0ZU1heFNjcm9sbChcblx0XHRcdFx0LTEgKiB0aGlzLnN0YXRlLml0ZW1MYXlvdXQud2lkdGggKiAodGhpcy5wcm9wcy50b3RhbEl0ZW1Db3VudCAtIDEpLFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHR0aGlzLmluZmluaXRlQ2FsY3VsYXRvci5yZW9yZGVySW5maW5pdGUoKTtcblxuXHRcdHRoaXMub25SZWFkeShpc01vdW50ZWQpO1xuXHR9XG5cblx0b25SZWFkeShpc01vdW50ZWQ6IGJvb2xlYW4gPSB0cnVlKSB7XG5cdFx0aWYgKHRoaXMuc3RhdGUucmVhZHkgPT09IGZhbHNlKSB7XG5cdFx0XHRpZiAoXG5cdFx0XHRcdHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aCAhPT0gMCAmJlxuXHRcdFx0XHR0aGlzLnN0YXRlLndyYXBwZXJMYXlvdXQud2lkdGggIT09IDBcblx0XHRcdCkge1xuXHRcdFx0XHRpZiAoaXNNb3VudGVkKSB7XG5cdFx0XHRcdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdFx0XHRyZWFkeTogdHJ1ZSxcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLnN0YXRlID0ge1xuXHRcdFx0XHRcdFx0Li4udGhpcy5zdGF0ZSxcblx0XHRcdFx0XHRcdHJlYWR5OiB0cnVlLFxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRjb21wb25lbnREaWRVcGRhdGUoXG5cdFx0cHJldlByb3BzOiBJbmZpbml0ZVNjcm9sbGVyUHJvcHM8VD4sXG5cdFx0cHJldlN0YXRlOiBJbmZpbml0ZVNjcm9sbGVyU3RhdGUsXG5cdCkge1xuXHRcdGxldCBkaWRDaGFuZ2UgPSBmYWxzZTtcblx0XHRkaWRDaGFuZ2UgPVxuXHRcdFx0ZGlkQ2hhbmdlIHx8XG5cdFx0XHRwcmV2U3RhdGUuaXRlbUxheW91dC53aWR0aCAhPT0gdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LndpZHRoO1xuXHRcdGRpZENoYW5nZSA9XG5cdFx0XHRkaWRDaGFuZ2UgfHxcblx0XHRcdHByZXZTdGF0ZS53cmFwcGVyTGF5b3V0LndpZHRoICE9PSB0aGlzLnN0YXRlLndyYXBwZXJMYXlvdXQud2lkdGg7XG5cdFx0ZGlkQ2hhbmdlID0gZGlkQ2hhbmdlIHx8IHByZXZTdGF0ZS5yZWFkeSAhPT0gdGhpcy5zdGF0ZS5yZWFkeTtcblx0XHRkaWRDaGFuZ2UgPVxuXHRcdFx0ZGlkQ2hhbmdlIHx8XG5cdFx0XHRwcmV2UHJvcHMuY2VudGVySW5XcmFwcGVyICE9PSB0aGlzLnByb3BzLmNlbnRlckluV3JhcHBlcjtcblx0XHRkaWRDaGFuZ2UgPVxuXHRcdFx0ZGlkQ2hhbmdlIHx8IHByZXZQcm9wcy50b3RhbEl0ZW1Db3VudCAhPT0gdGhpcy5wcm9wcy50b3RhbEl0ZW1Db3VudDtcblx0XHRpZiAoZGlkQ2hhbmdlKSB7XG5cdFx0XHR0aGlzLm9uVXBkYXRlKCk7XG5cdFx0fVxuXHRcdGlmKHByZXZQcm9wcy5kYXRhc2V0ICE9PSB0aGlzLnByb3BzLmRhdGFzZXQpe1xuXHRcdFx0Y29uc29sZS5sb2coJ3JlZnJlc2ggZGF0YXNldCcpO1xuXHRcdFx0dGhpcy5kYXRhc2V0TmVlZHNSZWZyZXNoKCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRkYXRhc2V0TmVlZHNSZWZyZXNoKCl7XG5cdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3IudXBkYXRlRGF0YXNldCh0aGlzLnByb3BzLmRhdGFzZXQpO1xuXHR9XG5cblx0Y29tcG9uZW50V2lsbFVubW91bnQoKSB7XG5cdFx0dGhpcy5pbmZpbml0ZUNhbGN1bGF0b3IuZGlzcG9zZSgpO1xuXHR9XG5cblx0Y2FsY3VsYXRlQ3VycmVudEluZGV4KG1vdmVYVmFsdWU6IG51bWJlcikge1xuXHRcdGNvbnN0IGl0ZW1XaWR0aCA9IHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aDtcblx0XHRjb25zdCB3cmFwcGVyV2lkdGggPSB0aGlzLnN0YXRlLndyYXBwZXJMYXlvdXQud2lkdGg7XG5cdFx0Y29uc3QgY2VudGVySW5XcmFwcGVyID1cblx0XHRcdHRoaXMucHJvcHMuY2VudGVySW5XcmFwcGVyICE9IG51bGxcblx0XHRcdFx0PyB0aGlzLnByb3BzLmNlbnRlckluV3JhcHBlclxuXHRcdFx0XHQ6IGZhbHNlO1xuXHRcdGNvbnN0IGNlbnRlciA9IGNlbnRlckluV3JhcHBlciA/IHdyYXBwZXJXaWR0aCAvIDIgLSBpdGVtV2lkdGggLyAyIDogMDtcblx0XHQvKipcblx0XHQgKiBUaGUgdmFsdWUgd2lsbCBiZSBzbGlnaGx5IG9mZiBiZWNhdXNlIG91ciBzbmFwIGVuZCB0aHJlc2hob2xkIGlzIGFcblx0XHQgKiBiaXQgaGlnaCB0byBlbnN1cmUgZXZlbnRzIGFyZSB0cmlnZ2VyZWQgaW4gYSB0aW1sZXkgbWFubmVyLlxuXHRcdCAqKi9cblx0XHRyZXR1cm4gTWF0aC5yb3VuZCgoY2VudGVyIC0gbW92ZVhWYWx1ZSkgLyBpdGVtV2lkdGgpO1xuXHR9XG5cblx0Z2V0Q3VycmVudEluZGV4KCkge1xuXHRcdHJldHVybiB0aGlzLmNhbGN1bGF0ZUN1cnJlbnRJbmRleCh0aGlzLmluZmluaXRlQ2FsY3VsYXRvci54KTtcblx0fVxuXG5cdGFzeW5jIGdvTmV4dCh3aXRoQW5pbWF0aW9uOiBib29sZWFuID0gdHJ1ZSkge1xuXHRcdGNvbnN0IGluZGV4ID0gdGhpcy5nZXRDdXJyZW50SW5kZXgoKTtcblx0XHRyZXR1cm4gdGhpcy5zY3JvbGxUb0luZGV4KGluZGV4ICsgMSwgd2l0aEFuaW1hdGlvbik7XG5cdH1cblxuXHRhc3luYyBnb0JhY2sod2l0aEFuaW1hdGlvbjogYm9vbGVhbiA9IHRydWUpIHtcblx0XHRjb25zdCBpbmRleCA9IHRoaXMuZ2V0Q3VycmVudEluZGV4KCk7XG5cdFx0cmV0dXJuIHRoaXMuc2Nyb2xsVG9JbmRleChpbmRleCAtIDEsIHdpdGhBbmltYXRpb24pO1xuXHR9XG5cblx0c2Nyb2xsVG9JbmRleChpdGVtT2Zmc2V0OiBudW1iZXIsIHdpdGhBbmltYXRpb246IGJvb2xlYW4gPSB0cnVlKSB7XG5cdFx0dGhpcy5hbmltYXRpb25Mb2dpYy5zY3JvbGxUbyhcblx0XHRcdC0xICogaXRlbU9mZnNldCAqIHRoaXMuc3RhdGUuaXRlbUxheW91dC53aWR0aCxcblx0XHRcdHdpdGhBbmltYXRpb24sXG5cdFx0KTtcblx0fVxuXG5cdHNjcm9sbFRvRWxlbWVudChlbGVtZW50OiBJbmZpbml0ZUVsZW1lbnQ8VD4sIHdpdGhBbmltYXRpb24/OiBib29sZWFuKSB7XG5cdFx0cmV0dXJuIHRoaXMuc2Nyb2xsVG9JbmRleChlbGVtZW50LnBoYXNlLCB3aXRoQW5pbWF0aW9uKTtcblx0fVxuXG5cdGZpbmROZWFyZXN0SW5maW5pdGVFbGVtZW50KFxuXHRcdGNvbXBhcmF0b3I6IChpdGVtOiBJbmZpbml0ZUVsZW1lbnQ8VD4pID0+IGJvb2xlYW4sXG5cdCk6IEluZmluaXRlRWxlbWVudDxUPiB8IHVuZGVmaW5lZCB7XG5cdFx0Y29uc3QgeCA9IC0xICogdGhpcy5pbmZpbml0ZUNhbGN1bGF0b3IueDtcblx0XHRsZXQgZWxlbWVudHMgPSBbLi4udGhpcy5pbmZpbml0ZUVsZW1lbnRzXS5zb3J0KChhLCBiKSA9PiB7XG5cdFx0XHRjb25zdCBhRGVsdGEgPSBNYXRoLmFicyh4IC0gYS5sZWZ0KTtcblx0XHRcdGNvbnN0IGJEZWx0YSA9IE1hdGguYWJzKHggLSBiLmxlZnQpO1xuXHRcdFx0cmV0dXJuIGFEZWx0YSAtIGJEZWx0YTtcblx0XHR9KTtcblx0XHRyZXR1cm4gZWxlbWVudHMuZmluZChpdGVtID0+IGNvbXBhcmF0b3IoaXRlbSkpO1xuXHR9XG5cblx0c2Nyb2xsVG9JdGVtKFxuXHRcdGNvbXBhcmF0b3I6IChpdGVtOiBUIHwgbnVsbCkgPT4gYm9vbGVhbixcblx0XHR3aXRoQW5pbWF0aW9uPzogYm9vbGVhbixcblx0KSB7XG5cdFx0Y29uc3QgZWxlbWVudCA9IHRoaXMuZmluZE5lYXJlc3RJbmZpbml0ZUVsZW1lbnQoZWxtID0+XG5cdFx0XHRlbG0uZGF0YSAhPSBudWxsID8gY29tcGFyYXRvcihlbG0uZGF0YSkgOiBmYWxzZSxcblx0XHQpO1xuXG5cdFx0aWYgKGVsZW1lbnQpIHtcblx0XHRcdHJldHVybiB0aGlzLnNjcm9sbFRvRWxlbWVudChlbGVtZW50LCB3aXRoQW5pbWF0aW9uKTtcblx0XHR9XG5cdH1cblxuXHRvbkl0ZW1MYXlvdXQgPSAoe1xuXHRcdG5hdGl2ZUV2ZW50OiB7XG5cdFx0XHRsYXlvdXQ6IHt3aWR0aCwgaGVpZ2h0fSxcblx0XHR9LFxuXHR9OiBMYXlvdXRDaGFuZ2VFdmVudCkgPT4ge1xuXHRcdGNvbnN0IHtpdGVtTGF5b3V0fSA9IHRoaXMuc3RhdGU7XG5cdFx0aWYgKGl0ZW1MYXlvdXQud2lkdGggIT09IHdpZHRoIHx8IGl0ZW1MYXlvdXQuaGVpZ2h0ICE9PSBoZWlnaHQpIHtcblx0XHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0XHRpdGVtTGF5b3V0OiB7d2lkdGgsIGhlaWdodH0sXG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0b25XcmFwcGVyTGF5b3V0ID0gKHtcblx0XHRuYXRpdmVFdmVudDoge1xuXHRcdFx0bGF5b3V0OiB7d2lkdGgsIGhlaWdodH0sXG5cdFx0fSxcblx0fTogTGF5b3V0Q2hhbmdlRXZlbnQpID0+IHtcblx0XHRjb25zdCB7d3JhcHBlckxheW91dH0gPSB0aGlzLnN0YXRlO1xuXHRcdGlmICh3cmFwcGVyTGF5b3V0LndpZHRoICE9PSB3aWR0aCB8fCB3cmFwcGVyTGF5b3V0LmhlaWdodCAhPT0gaGVpZ2h0KSB7XG5cdFx0XHR0aGlzLnNldFN0YXRlKHtcblx0XHRcdFx0d3JhcHBlckxheW91dDoge3dpZHRoLCBoZWlnaHR9LFxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xuXG5cdHJlbmRlcigpIHtcblx0XHRjb25zdCBzdHlsZSA9IHtcblx0XHRcdGhlaWdodDogdGhpcy5zdGF0ZS5pdGVtTGF5b3V0LmhlaWdodCxcblx0XHRcdG9wYWNpdHk6IHRoaXMuc3RhdGUucmVhZHkgPyAxIDogMCxcblx0XHR9O1xuXHRcdHJldHVybiAoXG5cdFx0XHQ8UGFuR2VzdHVyZUhhbmRsZXJcblx0XHRcdFx0cmVmPXt0aGlzLnBhbkhhbmRsZXJSZWZ9XG5cdFx0XHRcdHNpbXVsdGFuZW91c0hhbmRsZXJzPXt0aGlzLnByb3BzLnNpbXVsdGFuZW91c0hhbmRsZXJzfVxuXHRcdFx0XHR3YWl0Rm9yPXt0aGlzLnByb3BzLndhaXRGb3J9XG5cdFx0XHRcdG9uR2VzdHVyZUV2ZW50PXt0aGlzLmFuaW1hdGlvbkxvZ2ljLmdlc3R1cmVIYW5kbGVyfVxuXHRcdFx0XHRvbkhhbmRsZXJTdGF0ZUNoYW5nZT17dGhpcy5hbmltYXRpb25Mb2dpYy5nZXN0dXJlSGFuZGxlcn0+XG5cdFx0XHRcdDxBbmltYXRlZC5WaWV3XG5cdFx0XHRcdFx0c3R5bGU9e1t0aGlzLnByb3BzLnN0eWxlLCBzdHlsZV19XG5cdFx0XHRcdFx0b25MYXlvdXQ9e3RoaXMub25XcmFwcGVyTGF5b3V0fT5cblx0XHRcdFx0XHQ8QW5pbWF0ZWQuVmlld1xuXHRcdFx0XHRcdFx0c3R5bGU9e3tcblx0XHRcdFx0XHRcdFx0dHJhbnNmb3JtOiBbXG5cdFx0XHRcdFx0XHRcdFx0e3RyYW5zbGF0ZVg6IHRoaXMuYW5pbWF0aW9uTG9naWMueH0sXG5cdFx0XHRcdFx0XHRcdFx0e3BlcnNwZWN0aXZlOiAxMDAwfSwgLy8gd2l0aG91dCB0aGlzIGxpbmUgdGhpcyBBbmltYXRpb24gd2lsbCBub3QgcmVuZGVyIG9uIEFuZHJvaWQgd2hpbGUgd29ya2luZyBmaW5lIG9uIGlPU1xuXHRcdFx0XHRcdFx0XHRdLFxuXHRcdFx0XHRcdFx0fX0+XG5cdFx0XHRcdFx0XHR7dGhpcy5pbmZpbml0ZUVsZW1lbnRzLm1hcCgoaXRlbSwgaSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gKFxuXHRcdFx0XHRcdFx0XHRcdDxJbmZpbml0ZUl0ZW08VD5cblx0XHRcdFx0XHRcdFx0XHRcdGVsZW1lbnRJbmRleD17aX1cblx0XHRcdFx0XHRcdFx0XHRcdHJlbmRlckl0ZW09e3RoaXMucHJvcHMucmVuZGVySXRlbX1cblx0XHRcdFx0XHRcdFx0XHRcdGl0ZW09e2l0ZW19XG5cdFx0XHRcdFx0XHRcdFx0XHRrZXk9e2l9XG5cdFx0XHRcdFx0XHRcdFx0XHRvbkxheW91dD17XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGkgPT09IDAgPyB0aGlzLm9uSXRlbUxheW91dCA6IG51bGxcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHQvPlxuXHRcdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0fSl9XG5cdFx0XHRcdFx0PC9BbmltYXRlZC5WaWV3PlxuXHRcdFx0XHQ8L0FuaW1hdGVkLlZpZXc+XG5cdFx0XHQ8L1Bhbkdlc3R1cmVIYW5kbGVyPlxuXHRcdCk7XG5cdH1cbn1cbiJdfQ==